<html><head><meta charset="UTF-8"></head><body><pre>
ovn-northd(8)                     OVN Manual                     ovn-northd(8)



<b>N</b><b>A</b><b>M</b><b>E</b>
       ovn-northd  and ovn-northd-ddlog - Open Virtual Network central control
       daemon

<b>S</b><b>Y</b><b>N</b><b>O</b><b>P</b><b>S</b><b>I</b><b>S</b>
       <b>o</b><b>v</b><b>n</b><b>-</b><b>n</b><b>o</b><b>r</b><b>t</b><b>h</b><b>d</b> [<u>o</u><u>p</u><u>t</u><u>i</u><u>o</u><u>n</u><u>s</u>]

<b>D</b><b>E</b><b>S</b><b>C</b><b>R</b><b>I</b><b>P</b><b>T</b><b>I</b><b>O</b><b>N</b>
       <b>o</b><b>v</b><b>n</b><b>-</b><b>n</b><b>o</b><b>r</b><b>t</b><b>h</b><b>d</b> is a centralized  daemon  responsible  for  translating  the
       high-level  OVN  configuration into logical configuration consumable by
       daemons such as <b>o</b><b>v</b><b>n</b><b>-</b><b>c</b><b>o</b><b>n</b><b>t</b><b>r</b><b>o</b><b>l</b><b>l</b><b>e</b><b>r</b>. It translates the logical network  con‐
       figuration  in  terms  of conventional network concepts, taken from the
       OVN Northbound Database (see <b>o</b><b>v</b><b>n</b><b>-</b><b>n</b><b>b</b>(5)), into logical datapath flows in
       the OVN Southbound Database (see <b>o</b><b>v</b><b>n</b><b>-</b><b>s</b><b>b</b>(5)) below it.

       <b>o</b><b>v</b><b>n</b><b>-</b><b>n</b><b>o</b><b>r</b><b>t</b><b>h</b><b>d</b> is implemented in C. <b>o</b><b>v</b><b>n</b><b>-</b><b>n</b><b>o</b><b>r</b><b>t</b><b>h</b><b>d</b><b>-</b><b>d</b><b>d</b><b>l</b><b>o</b><b>g</b> is a compatible imple‐
       mentation written in DDlog, a language for  incremental  database  pro‐
       cessing.  This documentation applies to both implementations, with dif‐
       ferences indicated where relevant.

<b>O</b><b>P</b><b>T</b><b>I</b><b>O</b><b>N</b><b>S</b>
       <b>-</b><b>-</b><b>o</b><b>v</b><b>n</b><b>n</b><b>b</b><b>-</b><b>d</b><b>b</b><b>=</b><u>d</u><u>a</u><u>t</u><u>a</u><u>b</u><u>a</u><u>s</u><u>e</u>
              The OVSDB database containing the OVN  Northbound  Database.  If
              the  <b>O</b><b>V</b><b>N</b><b>_</b><b>N</b><b>B</b><b>_</b><b>D</b><b>B</b> environment variable is set, its value is used as
              the default. Otherwise, the default is <b>u</b><b>n</b><b>i</b><b>x</b><b>:</b><b>/</b><b>o</b><b>v</b><b>n</b><b>n</b><b>b</b><b>_</b><b>d</b><b>b</b><b>.</b><b>s</b><b>o</b><b>c</b><b>k</b>.

       <b>-</b><b>-</b><b>o</b><b>v</b><b>n</b><b>s</b><b>b</b><b>-</b><b>d</b><b>b</b><b>=</b><u>d</u><u>a</u><u>t</u><u>a</u><u>b</u><u>a</u><u>s</u><u>e</u>
              The OVSDB database containing the OVN  Southbound  Database.  If
              the  <b>O</b><b>V</b><b>N</b><b>_</b><b>S</b><b>B</b><b>_</b><b>D</b><b>B</b> environment variable is set, its value is used as
              the default. Otherwise, the default is <b>u</b><b>n</b><b>i</b><b>x</b><b>:</b><b>/</b><b>o</b><b>v</b><b>n</b><b>s</b><b>b</b><b>_</b><b>d</b><b>b</b><b>.</b><b>s</b><b>o</b><b>c</b><b>k</b>.

       <b>-</b><b>-</b><b>d</b><b>d</b><b>l</b><b>o</b><b>g</b><b>-</b><b>r</b><b>e</b><b>c</b><b>o</b><b>r</b><b>d</b><b>=</b><u>f</u><u>i</u><u>l</u><u>e</u>
              This option is for <b>o</b><b>v</b><b>n</b><b>-</b><b>n</b><b>o</b><b>r</b><b>t</b><b>h</b><b>-</b><b>d</b><b>d</b><b>l</b><b>o</b><b>g</b> only. It causes the daemon to
              record  the  initial database state and later changes to <u>f</u><u>i</u><u>l</u><u>e</u> in
              the text-based DDlog command format. The <b>o</b><b>v</b><b>n</b><b>_</b><b>n</b><b>o</b><b>r</b><b>t</b><b>h</b><b>d</b><b>_</b><b>c</b><b>l</b><b>i</b>  program
              can  later  replay  these  changes  for debugging purposes. This
              option has a performance impact. See <b>d</b><b>e</b><b>b</b><b>u</b><b>g</b><b>g</b><b>i</b><b>n</b><b>g</b><b>-</b><b>d</b><b>d</b><b>l</b><b>o</b><b>g</b><b>.</b><b>r</b><b>s</b><b>t</b> in  the
              OVN documentation for more details.

       <b>-</b><b>-</b><b>d</b><b>r</b><b>y</b><b>-</b><b>r</b><b>u</b><b>n</b>
              Causes   <b>o</b><b>v</b><b>n</b><b>-</b><b>n</b><b>o</b><b>r</b><b>t</b><b>h</b><b>d</b>  to  start  paused.  In  the  paused  state,
              <b>o</b><b>v</b><b>n</b><b>-</b><b>n</b><b>o</b><b>r</b><b>t</b><b>h</b><b>d</b> does not apply any changes to the databases, although
              it  continues  to  monitor  them.  For more information, see the
              <b>p</b><b>a</b><b>u</b><b>s</b><b>e</b> command, under <b>R</b><b>u</b><b>n</b><b>t</b><b>i</b><b>m</b><b>e</b> <b>M</b><b>a</b><b>n</b><b>a</b><b>g</b><b>e</b><b>m</b><b>e</b><b>n</b><b>t</b> <b>C</b><b>o</b><b>m</b><b>m</b><b>a</b><b>n</b><b>d</b><b>s</b> below.

              For  <b>o</b><b>v</b><b>n</b><b>-</b><b>n</b><b>o</b><b>r</b><b>t</b><b>h</b><b>d</b><b>-</b><b>d</b><b>d</b><b>l</b><b>o</b><b>g</b>,  one   could   use   this   option   with
              <b>-</b><b>-</b><b>d</b><b>d</b><b>l</b><b>o</b><b>g</b><b>-</b><b>r</b><b>e</b><b>c</b><b>o</b><b>r</b><b>d</b>  to  generate  a  replay log without restarting a
              process or disturbing a running system.

       <u>d</u><u>a</u><u>t</u><u>a</u><u>b</u><u>a</u><u>s</u><u>e</u> in the above options must be an OVSDB active or  passive  con‐
       nection method, as described in <b>o</b><b>v</b><b>s</b><b>d</b><b>b</b>(7).

   <b>D</b><b>a</b><b>e</b><b>m</b><b>o</b><b>n</b> <b>O</b><b>p</b><b>t</b><b>i</b><b>o</b><b>n</b><b>s</b>
       <b>-</b><b>-</b><b>p</b><b>i</b><b>d</b><b>f</b><b>i</b><b>l</b><b>e</b>[<b>=</b><u>p</u><u>i</u><u>d</u><u>f</u><u>i</u><u>l</u><u>e</u>]
              Causes a file (by default, <u>p</u><u>r</u><u>o</u><u>g</u><u>r</u><u>a</u><u>m</u><b>.</b><b>p</b><b>i</b><b>d</b>) to be created indicating
              the PID of the running process. If the <u>p</u><u>i</u><u>d</u><u>f</u><u>i</u><u>l</u><u>e</u> argument  is  not
              specified, or if it does not begin with <b>/</b>, then it is created in
              .

              If <b>-</b><b>-</b><b>p</b><b>i</b><b>d</b><b>f</b><b>i</b><b>l</b><b>e</b> is not specified, no pidfile is created.

       <b>-</b><b>-</b><b>o</b><b>v</b><b>e</b><b>r</b><b>w</b><b>r</b><b>i</b><b>t</b><b>e</b><b>-</b><b>p</b><b>i</b><b>d</b><b>f</b><b>i</b><b>l</b><b>e</b>
              By default, when <b>-</b><b>-</b><b>p</b><b>i</b><b>d</b><b>f</b><b>i</b><b>l</b><b>e</b> is specified and the  specified  pid‐
              file already exists and is locked by a running process, the dae‐
              mon refuses to start. Specify <b>-</b><b>-</b><b>o</b><b>v</b><b>e</b><b>r</b><b>w</b><b>r</b><b>i</b><b>t</b><b>e</b><b>-</b><b>p</b><b>i</b><b>d</b><b>f</b><b>i</b><b>l</b><b>e</b> to cause it to
              instead overwrite the pidfile.

              When <b>-</b><b>-</b><b>p</b><b>i</b><b>d</b><b>f</b><b>i</b><b>l</b><b>e</b> is not specified, this option has no effect.

       <b>-</b><b>-</b><b>d</b><b>e</b><b>t</b><b>a</b><b>c</b><b>h</b>
              Runs  this  program  as a background process. The process forks,
              and in the child it starts a new session,  closes  the  standard
              file descriptors (which has the side effect of disabling logging
              to the console), and changes its current directory to  the  root
              (unless  <b>-</b><b>-</b><b>n</b><b>o</b><b>-</b><b>c</b><b>h</b><b>d</b><b>i</b><b>r</b> is specified). After the child completes its
              initialization, the parent exits.

       <b>-</b><b>-</b><b>m</b><b>o</b><b>n</b><b>i</b><b>t</b><b>o</b><b>r</b>
              Creates an additional process to monitor  this  program.  If  it
              dies  due  to a signal that indicates a programming error (<b>S</b><b>I</b><b>G</b><b>A</b><b>‐</b>
              <b>B</b><b>R</b><b>T</b>, <b>S</b><b>I</b><b>G</b><b>A</b><b>L</b><b>R</b><b>M</b>, <b>S</b><b>I</b><b>G</b><b>B</b><b>U</b><b>S</b>, <b>S</b><b>I</b><b>G</b><b>F</b><b>P</b><b>E</b>, <b>S</b><b>I</b><b>G</b><b>I</b><b>L</b><b>L</b>, <b>S</b><b>I</b><b>G</b><b>P</b><b>I</b><b>P</b><b>E</b>, <b>S</b><b>I</b><b>G</b><b>S</b><b>E</b><b>G</b><b>V</b>, <b>S</b><b>I</b><b>G</b><b>X</b><b>C</b><b>P</b><b>U</b>,
              or <b>S</b><b>I</b><b>G</b><b>X</b><b>F</b><b>S</b><b>Z</b>) then the monitor process starts a new copy of it. If
              the daemon dies or exits for another reason, the monitor process
              exits.

              This  option  is  normally used with <b>-</b><b>-</b><b>d</b><b>e</b><b>t</b><b>a</b><b>c</b><b>h</b>, but it also func‐
              tions without it.

       <b>-</b><b>-</b><b>n</b><b>o</b><b>-</b><b>c</b><b>h</b><b>d</b><b>i</b><b>r</b>
              By default, when <b>-</b><b>-</b><b>d</b><b>e</b><b>t</b><b>a</b><b>c</b><b>h</b> is specified, the daemon  changes  its
              current  working  directory  to  the  root  directory  after  it
              detaches. Otherwise, invoking the daemon from a carelessly  cho‐
              sen  directory  would  prevent the administrator from unmounting
              the file system that holds that directory.

              Specifying <b>-</b><b>-</b><b>n</b><b>o</b><b>-</b><b>c</b><b>h</b><b>d</b><b>i</b><b>r</b> suppresses this behavior,  preventing  the
              daemon  from changing its current working directory. This may be
              useful for collecting core files, since it is common behavior to
              write core dumps into the current working directory and the root
              directory is not a good directory to use.

              This option has no effect when <b>-</b><b>-</b><b>d</b><b>e</b><b>t</b><b>a</b><b>c</b><b>h</b> is not specified.

       <b>-</b><b>-</b><b>n</b><b>o</b><b>-</b><b>s</b><b>e</b><b>l</b><b>f</b><b>-</b><b>c</b><b>o</b><b>n</b><b>f</b><b>i</b><b>n</b><b>e</b><b>m</b><b>e</b><b>n</b><b>t</b>
              By default this daemon will try to self-confine itself  to  work
              with  files  under  well-known  directories  determined at build
              time. It is better to stick with this default behavior  and  not
              to  use  this  flag  unless some other Access Control is used to
              confine daemon. Note that in contrast to  other  access  control
              implementations  that  are  typically enforced from kernel-space
              (e.g. DAC or MAC), self-confinement is imposed  from  the  user-
              space daemon itself and hence should not be considered as a full
              confinement strategy, but instead should be viewed as  an  addi‐
              tional layer of security.

       <b>-</b><b>-</b><b>u</b><b>s</b><b>e</b><b>r</b><b>=</b><u>u</u><u>s</u><u>e</u><u>r</u><b>:</b><u>g</u><u>r</u><u>o</u><u>u</u><u>p</u>
              Causes  this  program  to  run  as a different user specified in
              <u>u</u><u>s</u><u>e</u><u>r</u><b>:</b><u>g</u><u>r</u><u>o</u><u>u</u><u>p</u>, thus dropping most of  the  root  privileges.  Short
              forms  <u>u</u><u>s</u><u>e</u><u>r</u>  and  <b>:</b><u>g</u><u>r</u><u>o</u><u>u</u><u>p</u>  are also allowed, with current user or
              group assumed, respectively. Only daemons started  by  the  root
              user accepts this argument.

              On   Linux,   daemons   will   be   granted   <b>C</b><b>A</b><b>P</b><b>_</b><b>I</b><b>P</b><b>C</b><b>_</b><b>L</b><b>O</b><b>C</b><b>K</b>   and
              <b>C</b><b>A</b><b>P</b><b>_</b><b>N</b><b>E</b><b>T</b><b>_</b><b>B</b><b>I</b><b>N</b><b>D</b><b>_</b><b>S</b><b>E</b><b>R</b><b>V</b><b>I</b><b>C</b><b>E</b><b>S</b> before dropping root  privileges.  Daemons
              that  interact  with  a  datapath, such as <b>o</b><b>v</b><b>s</b><b>-</b><b>v</b><b>s</b><b>w</b><b>i</b><b>t</b><b>c</b><b>h</b><b>d</b>, will be
              granted three  additional  capabilities,  namely  <b>C</b><b>A</b><b>P</b><b>_</b><b>N</b><b>E</b><b>T</b><b>_</b><b>A</b><b>D</b><b>M</b><b>I</b><b>N</b>,
              <b>C</b><b>A</b><b>P</b><b>_</b><b>N</b><b>E</b><b>T</b><b>_</b><b>B</b><b>R</b><b>O</b><b>A</b><b>D</b><b>C</b><b>A</b><b>S</b><b>T</b>  and  <b>C</b><b>A</b><b>P</b><b>_</b><b>N</b><b>E</b><b>T</b><b>_</b><b>R</b><b>A</b><b>W</b>.  The capability change will
              apply even if the new user is root.

              On Windows, this option is not currently supported. For security
              reasons,  specifying  this  option will cause the daemon process
              not to start.

   <b>L</b><b>o</b><b>g</b><b>g</b><b>i</b><b>n</b><b>g</b> <b>O</b><b>p</b><b>t</b><b>i</b><b>o</b><b>n</b><b>s</b>
       <b>-</b><b>v</b>[<u>s</u><u>p</u><u>e</u><u>c</u>]
       <b>-</b><b>-</b><b>v</b><b>e</b><b>r</b><b>b</b><b>o</b><b>s</b><b>e</b><b>=</b>[<u>s</u><u>p</u><u>e</u><u>c</u>]
            Sets logging levels. Without any <u>s</u><u>p</u><u>e</u><u>c</u>,  sets  the  log  level  for
            every  module and destination to <b>d</b><b>b</b><b>g</b>. Otherwise, <u>s</u><u>p</u><u>e</u><u>c</u> is a list of
            words separated by spaces or commas or colons, up to one from each
            category below:

            ·      A  valid module name, as displayed by the <b>v</b><b>l</b><b>o</b><b>g</b><b>/</b><b>l</b><b>i</b><b>s</b><b>t</b> command
                   on <b>o</b><b>v</b><b>s</b><b>-</b><b>a</b><b>p</b><b>p</b><b>c</b><b>t</b><b>l</b>(8), limits the log level change to the speci‐
                   fied module.

            ·      <b>s</b><b>y</b><b>s</b><b>l</b><b>o</b><b>g</b>,  <b>c</b><b>o</b><b>n</b><b>s</b><b>o</b><b>l</b><b>e</b>, or <b>f</b><b>i</b><b>l</b><b>e</b>, to limit the log level change to
                   only to the system log, to  the  console,  or  to  a  file,
                   respectively.  (If <b>-</b><b>-</b><b>d</b><b>e</b><b>t</b><b>a</b><b>c</b><b>h</b> is specified, the daemon closes
                   its standard file descriptors, so logging  to  the  console
                   will have no effect.)

                   On  Windows  platform,  <b>s</b><b>y</b><b>s</b><b>l</b><b>o</b><b>g</b> is accepted as a word and is
                   only useful along with the <b>-</b><b>-</b><b>s</b><b>y</b><b>s</b><b>l</b><b>o</b><b>g</b><b>-</b><b>t</b><b>a</b><b>r</b><b>g</b><b>e</b><b>t</b> option (the word
                   has no effect otherwise).

            ·      <b>o</b><b>f</b><b>f</b>,  <b>e</b><b>m</b><b>e</b><b>r</b>,  <b>e</b><b>r</b><b>r</b>,  <b>w</b><b>a</b><b>r</b><b>n</b>,  <b>i</b><b>n</b><b>f</b><b>o</b>,  or <b>d</b><b>b</b><b>g</b>, to control the log
                   level. Messages of the given severity  or  higher  will  be
                   logged,  and  messages  of  lower severity will be filtered
                   out. <b>o</b><b>f</b><b>f</b> filters out all messages. See <b>o</b><b>v</b><b>s</b><b>-</b><b>a</b><b>p</b><b>p</b><b>c</b><b>t</b><b>l</b>(8) for  a
                   definition of each log level.

            Case is not significant within <u>s</u><u>p</u><u>e</u><u>c</u>.

            Regardless  of the log levels set for <b>f</b><b>i</b><b>l</b><b>e</b>, logging to a file will
            not take place unless <b>-</b><b>-</b><b>l</b><b>o</b><b>g</b><b>-</b><b>f</b><b>i</b><b>l</b><b>e</b> is also specified (see below).

            For compatibility with older versions of OVS, <b>a</b><b>n</b><b>y</b> is accepted as a
            word but has no effect.

       <b>-</b><b>v</b>
       <b>-</b><b>-</b><b>v</b><b>e</b><b>r</b><b>b</b><b>o</b><b>s</b><b>e</b>
            Sets  the  maximum  logging  verbosity level, equivalent to <b>-</b><b>-</b><b>v</b><b>e</b><b>r</b><b>‐</b>
            <b>b</b><b>o</b><b>s</b><b>e</b><b>=</b><b>d</b><b>b</b><b>g</b>.

       <b>-</b><b>v</b><b>P</b><b>A</b><b>T</b><b>T</b><b>E</b><b>R</b><b>N</b><b>:</b><u>d</u><u>e</u><u>s</u><u>t</u><u>i</u><u>n</u><u>a</u><u>t</u><u>i</u><u>o</u><u>n</u><b>:</b><u>p</u><u>a</u><u>t</u><u>t</u><u>e</u><u>r</u><u>n</u>
       <b>-</b><b>-</b><b>v</b><b>e</b><b>r</b><b>b</b><b>o</b><b>s</b><b>e</b><b>=</b><b>P</b><b>A</b><b>T</b><b>T</b><b>E</b><b>R</b><b>N</b><b>:</b><u>d</u><u>e</u><u>s</u><u>t</u><u>i</u><u>n</u><u>a</u><u>t</u><u>i</u><u>o</u><u>n</u><b>:</b><u>p</u><u>a</u><u>t</u><u>t</u><u>e</u><u>r</u><u>n</u>
            Sets  the  log  pattern  for  <u>d</u><u>e</u><u>s</u><u>t</u><u>i</u><u>n</u><u>a</u><u>t</u><u>i</u><u>o</u><u>n</u>  to  <u>p</u><u>a</u><u>t</u><u>t</u><u>e</u><u>r</u><u>n</u>.  Refer  to
            <b>o</b><b>v</b><b>s</b><b>-</b><b>a</b><b>p</b><b>p</b><b>c</b><b>t</b><b>l</b>(8) for a description of the valid syntax for <u>p</u><u>a</u><u>t</u><u>t</u><u>e</u><u>r</u><u>n</u>.

       <b>-</b><b>v</b><b>F</b><b>A</b><b>C</b><b>I</b><b>L</b><b>I</b><b>T</b><b>Y</b><b>:</b><u>f</u><u>a</u><u>c</u><u>i</u><u>l</u><u>i</u><u>t</u><u>y</u>
       <b>-</b><b>-</b><b>v</b><b>e</b><b>r</b><b>b</b><b>o</b><b>s</b><b>e</b><b>=</b><b>F</b><b>A</b><b>C</b><b>I</b><b>L</b><b>I</b><b>T</b><b>Y</b><b>:</b><u>f</u><u>a</u><u>c</u><u>i</u><u>l</u><u>i</u><u>t</u><u>y</u>
            Sets  the RFC5424 facility of the log message. <u>f</u><u>a</u><u>c</u><u>i</u><u>l</u><u>i</u><u>t</u><u>y</u> can be one
            of <b>k</b><b>e</b><b>r</b><b>n</b>, <b>u</b><b>s</b><b>e</b><b>r</b>, <b>m</b><b>a</b><b>i</b><b>l</b>, <b>d</b><b>a</b><b>e</b><b>m</b><b>o</b><b>n</b>, <b>a</b><b>u</b><b>t</b><b>h</b>, <b>s</b><b>y</b><b>s</b><b>l</b><b>o</b><b>g</b>, <b>l</b><b>p</b><b>r</b>, <b>n</b><b>e</b><b>w</b><b>s</b>, <b>u</b><b>u</b><b>c</b><b>p</b>, <b>c</b><b>l</b><b>o</b><b>c</b><b>k</b>,
            <b>f</b><b>t</b><b>p</b>,  <b>n</b><b>t</b><b>p</b>,  <b>a</b><b>u</b><b>d</b><b>i</b><b>t</b>,  <b>a</b><b>l</b><b>e</b><b>r</b><b>t</b>, <b>c</b><b>l</b><b>o</b><b>c</b><b>k</b><b>2</b>, <b>l</b><b>o</b><b>c</b><b>a</b><b>l</b><b>0</b>, <b>l</b><b>o</b><b>c</b><b>a</b><b>l</b><b>1</b>, <b>l</b><b>o</b><b>c</b><b>a</b><b>l</b><b>2</b>, <b>l</b><b>o</b><b>c</b><b>a</b><b>l</b><b>3</b>,
            <b>l</b><b>o</b><b>c</b><b>a</b><b>l</b><b>4</b>, <b>l</b><b>o</b><b>c</b><b>a</b><b>l</b><b>5</b>, <b>l</b><b>o</b><b>c</b><b>a</b><b>l</b><b>6</b> or <b>l</b><b>o</b><b>c</b><b>a</b><b>l</b><b>7</b>. If this option is not specified,
            <b>d</b><b>a</b><b>e</b><b>m</b><b>o</b><b>n</b>  is  used  as  the  default for the local system syslog and
            <b>l</b><b>o</b><b>c</b><b>a</b><b>l</b><b>0</b> is used while sending a message to the target provided  via
            the <b>-</b><b>-</b><b>s</b><b>y</b><b>s</b><b>l</b><b>o</b><b>g</b><b>-</b><b>t</b><b>a</b><b>r</b><b>g</b><b>e</b><b>t</b> option.

       <b>-</b><b>-</b><b>l</b><b>o</b><b>g</b><b>-</b><b>f</b><b>i</b><b>l</b><b>e</b>[<b>=</b><u>f</u><u>i</u><u>l</u><u>e</u>]
            Enables  logging  to a file. If <u>f</u><u>i</u><u>l</u><u>e</u> is specified, then it is used
            as the exact name for the log file. The default log file name used
            if <u>f</u><u>i</u><u>l</u><u>e</u> is omitted is <b>/</b><b>u</b><b>s</b><b>r</b><b>/</b><b>l</b><b>o</b><b>c</b><b>a</b><b>l</b><b>/</b><b>v</b><b>a</b><b>r</b><b>/</b><b>l</b><b>o</b><b>g</b><b>/</b><b>o</b><b>v</b><b>n</b><b>/</b><u>p</u><u>r</u><u>o</u><u>g</u><u>r</u><u>a</u><u>m</u><b>.</b><b>l</b><b>o</b><b>g</b>.

       <b>-</b><b>-</b><b>s</b><b>y</b><b>s</b><b>l</b><b>o</b><b>g</b><b>-</b><b>t</b><b>a</b><b>r</b><b>g</b><b>e</b><b>t</b><b>=</b><u>h</u><u>o</u><u>s</u><u>t</u><b>:</b><u>p</u><u>o</u><u>r</u><u>t</u>
            Send  syslog messages to UDP <u>p</u><u>o</u><u>r</u><u>t</u> on <u>h</u><u>o</u><u>s</u><u>t</u>, in addition to the sys‐
            tem syslog. The <u>h</u><u>o</u><u>s</u><u>t</u> must be a numerical IP address, not  a  host‐
            name.

       <b>-</b><b>-</b><b>s</b><b>y</b><b>s</b><b>l</b><b>o</b><b>g</b><b>-</b><b>m</b><b>e</b><b>t</b><b>h</b><b>o</b><b>d</b><b>=</b><u>m</u><u>e</u><u>t</u><u>h</u><u>o</u><u>d</u>
            Specify  <u>m</u><u>e</u><u>t</u><u>h</u><u>o</u><u>d</u>  as  how  syslog messages should be sent to syslog
            daemon. The following forms are supported:

            ·      <b>l</b><b>i</b><b>b</b><b>c</b>, to use the libc <b>s</b><b>y</b><b>s</b><b>l</b><b>o</b><b>g</b><b>(</b><b>)</b> function. Downside of  using
                   this  options  is that libc adds fixed prefix to every mes‐
                   sage before it is actually sent to the syslog  daemon  over
                   <b>/</b><b>d</b><b>e</b><b>v</b><b>/</b><b>l</b><b>o</b><b>g</b> UNIX domain socket.

            ·      <b>u</b><b>n</b><b>i</b><b>x</b><b>:</b><u>f</u><u>i</u><u>l</u><u>e</u>, to use a UNIX domain socket directly. It is pos‐
                   sible to specify arbitrary message format with this option.
                   However,  <b>r</b><b>s</b><b>y</b><b>s</b><b>l</b><b>o</b><b>g</b><b>d</b>  <b>8</b><b>.</b><b>9</b>  and  older versions use hard coded
                   parser function anyway that limits UNIX domain socket  use.
                   If  you  want  to  use  arbitrary message format with older
                   <b>r</b><b>s</b><b>y</b><b>s</b><b>l</b><b>o</b><b>g</b><b>d</b> versions, then use  UDP  socket  to  localhost  IP
                   address instead.

            ·      <b>u</b><b>d</b><b>p</b><b>:</b><u>i</u><u>p</u><b>:</b><u>p</u><u>o</u><u>r</u><u>t</u>,  to  use  a UDP socket. With this method it is
                   possible to use arbitrary message format  also  with  older
                   <b>r</b><b>s</b><b>y</b><b>s</b><b>l</b><b>o</b><b>g</b><b>d</b>.  When  sending  syslog  messages  over UDP socket
                   extra precaution needs to be taken into account, for  exam‐
                   ple,  syslog daemon needs to be configured to listen on the
                   specified UDP port,  accidental  iptables  rules  could  be
                   interfering  with  local  syslog traffic and there are some
                   security considerations that apply to UDP sockets,  but  do
                   not apply to UNIX domain sockets.

            ·      <b>n</b><b>u</b><b>l</b><b>l</b>, to discard all messages logged to syslog.

            The  default is taken from the <b>O</b><b>V</b><b>S</b><b>_</b><b>S</b><b>Y</b><b>S</b><b>L</b><b>O</b><b>G</b><b>_</b><b>M</b><b>E</b><b>T</b><b>H</b><b>O</b><b>D</b> environment vari‐
            able; if it is unset, the default is <b>l</b><b>i</b><b>b</b><b>c</b>.

   <b>P</b><b>K</b><b>I</b> <b>O</b><b>p</b><b>t</b><b>i</b><b>o</b><b>n</b><b>s</b>
       PKI configuration is required in order to use SSL for  the  connections
       to the Northbound and Southbound databases.

              <b>-</b><b>p</b> <u>p</u><u>r</u><u>i</u><u>v</u><u>k</u><u>e</u><u>y</u><u>.</u><u>p</u><u>e</u><u>m</u>
              <b>-</b><b>-</b><b>p</b><b>r</b><b>i</b><b>v</b><b>a</b><b>t</b><b>e</b><b>-</b><b>k</b><b>e</b><b>y</b><b>=</b><u>p</u><u>r</u><u>i</u><u>v</u><u>k</u><u>e</u><u>y</u><u>.</u><u>p</u><u>e</u><u>m</u>
                   Specifies  a  PEM  file  containing the private key used as
                   identity for outgoing SSL connections.

              <b>-</b><b>c</b> <u>c</u><u>e</u><u>r</u><u>t</u><u>.</u><u>p</u><u>e</u><u>m</u>
              <b>-</b><b>-</b><b>c</b><b>e</b><b>r</b><b>t</b><b>i</b><b>f</b><b>i</b><b>c</b><b>a</b><b>t</b><b>e</b><b>=</b><u>c</u><u>e</u><u>r</u><u>t</u><u>.</u><u>p</u><u>e</u><u>m</u>
                   Specifies a PEM file containing a certificate  that  certi‐
                   fies the private key specified on <b>-</b><b>p</b> or <b>-</b><b>-</b><b>p</b><b>r</b><b>i</b><b>v</b><b>a</b><b>t</b><b>e</b><b>-</b><b>k</b><b>e</b><b>y</b> to be
                   trustworthy. The certificate must be signed by the certifi‐
                   cate  authority  (CA) that the peer in SSL connections will
                   use to verify it.

              <b>-</b><b>C</b> <u>c</u><u>a</u><u>c</u><u>e</u><u>r</u><u>t</u><u>.</u><u>p</u><u>e</u><u>m</u>
              <b>-</b><b>-</b><b>c</b><b>a</b><b>-</b><b>c</b><b>e</b><b>r</b><b>t</b><b>=</b><u>c</u><u>a</u><u>c</u><u>e</u><u>r</u><u>t</u><u>.</u><u>p</u><u>e</u><u>m</u>
                   Specifies a PEM file containing the CA certificate for ver‐
                   ifying certificates presented to this program by SSL peers.
                   (This may be the same certificate that  SSL  peers  use  to
                   verify the certificate specified on <b>-</b><b>c</b> or <b>-</b><b>-</b><b>c</b><b>e</b><b>r</b><b>t</b><b>i</b><b>f</b><b>i</b><b>c</b><b>a</b><b>t</b><b>e</b>, or
                   it may be a different one, depending on the PKI  design  in
                   use.)

              <b>-</b><b>C</b> <b>n</b><b>o</b><b>n</b><b>e</b>
              <b>-</b><b>-</b><b>c</b><b>a</b><b>-</b><b>c</b><b>e</b><b>r</b><b>t</b><b>=</b><b>n</b><b>o</b><b>n</b><b>e</b>
                   Disables  verification  of  certificates  presented  by SSL
                   peers. This introduces a security risk,  because  it  means
                   that  certificates  cannot be verified to be those of known
                   trusted hosts.

   <b>O</b><b>t</b><b>h</b><b>e</b><b>r</b> <b>O</b><b>p</b><b>t</b><b>i</b><b>o</b><b>n</b><b>s</b>
       <b>-</b><b>-</b><b>u</b><b>n</b><b>i</b><b>x</b><b>c</b><b>t</b><b>l</b><b>=</b><u>s</u><u>o</u><u>c</u><u>k</u><u>e</u><u>t</u>
              Sets the name of the control socket on which <u>p</u><u>r</u><u>o</u><u>g</u><u>r</u><u>a</u><u>m</u> listens for
              runtime  management  commands  (see <u>R</u><u>U</u><u>N</u><u>T</u><u>I</u><u>M</u><u>E</u> <u>M</u><u>A</u><u>N</u><u>A</u><u>G</u><u>E</u><u>M</u><u>E</u><u>N</u><u>T</u> <u>C</u><u>O</u><u>M</u><u>M</u><u>A</u><u>N</u><u>D</u><u>S</u><u>,</u>
              below). If <u>s</u><u>o</u><u>c</u><u>k</u><u>e</u><u>t</u> does not begin with <b>/</b>, it  is  interpreted  as
              relative  to  .  If  <b>-</b><b>-</b><b>u</b><b>n</b><b>i</b><b>x</b><b>c</b><b>t</b><b>l</b>  is  not used at all, the default
              socket is <b>/</b><u>p</u><u>r</u><u>o</u><u>g</u><u>r</u><u>a</u><u>m</u><b>.</b><u>p</u><u>i</u><u>d</u><b>.</b><b>c</b><b>t</b><b>l</b>, where <u>p</u><u>i</u><u>d</u> is <u>p</u><u>r</u><u>o</u><u>g</u><u>r</u><u>a</u><u>m</u>’s process ID.

              On Windows a local named pipe is used to listen for runtime man‐
              agement  commands.  A  file  is  created in the absolute path as
              pointed by <u>s</u><u>o</u><u>c</u><u>k</u><u>e</u><u>t</u> or if <b>-</b><b>-</b><b>u</b><b>n</b><b>i</b><b>x</b><b>c</b><b>t</b><b>l</b> is not used at all, a file  is
              created  as  <u>p</u><u>r</u><u>o</u><u>g</u><u>r</u><u>a</u><u>m</u> in the configured <u>O</u><u>V</u><u>S</u><b>_</b><u>R</u><u>U</u><u>N</u><u>D</u><u>I</u><u>R</u> directory. The
              file exists just to mimic the behavior of a Unix domain socket.

              Specifying <b>n</b><b>o</b><b>n</b><b>e</b> for <u>s</u><u>o</u><u>c</u><u>k</u><u>e</u><u>t</u> disables the control socket feature.



       <b>-</b><b>h</b>
       <b>-</b><b>-</b><b>h</b><b>e</b><b>l</b><b>p</b>
            Prints a brief help message to the console.

       <b>-</b><b>V</b>
       <b>-</b><b>-</b><b>v</b><b>e</b><b>r</b><b>s</b><b>i</b><b>o</b><b>n</b>
            Prints version information to the console.

<b>R</b><b>U</b><b>N</b><b>T</b><b>I</b><b>M</b><b>E</b> <b>M</b><b>A</b><b>N</b><b>A</b><b>G</b><b>E</b><b>M</b><b>E</b><b>N</b><b>T</b> <b>C</b><b>O</b><b>M</b><b>M</b><b>A</b><b>N</b><b>D</b><b>S</b>
       <b>o</b><b>v</b><b>s</b><b>-</b><b>a</b><b>p</b><b>p</b><b>c</b><b>t</b><b>l</b> can send commands to a running <b>o</b><b>v</b><b>n</b><b>-</b><b>n</b><b>o</b><b>r</b><b>t</b><b>h</b><b>d</b> process. The  cur‐
       rently supported commands are described below.

              <b>e</b><b>x</b><b>i</b><b>t</b>   Causes <b>o</b><b>v</b><b>n</b><b>-</b><b>n</b><b>o</b><b>r</b><b>t</b><b>h</b><b>d</b> to gracefully terminate.

              <b>p</b><b>a</b><b>u</b><b>s</b><b>e</b>  Pauses <b>o</b><b>v</b><b>n</b><b>-</b><b>n</b><b>o</b><b>r</b><b>t</b><b>h</b><b>d</b>. When it is paused, <b>o</b><b>v</b><b>n</b><b>-</b><b>n</b><b>o</b><b>r</b><b>t</b><b>h</b><b>d</b> receives
                     changes  from  the  Northbound  and  Southbound  database
                     changes  as  usual,  but  it does not send any updates. A
                     paused <b>o</b><b>v</b><b>n</b><b>-</b><b>n</b><b>o</b><b>r</b><b>t</b><b>h</b><b>d</b> also drops database locks, which allows
                     any other non-paused instance of <b>o</b><b>v</b><b>n</b><b>-</b><b>n</b><b>o</b><b>r</b><b>t</b><b>h</b><b>d</b> to take over.

              <b>r</b><b>e</b><b>s</b><b>u</b><b>m</b><b>e</b> Resumes  the  ovn-northd  operation to process Northbound
                     and Southbound database  contents  and  generate  logical
                     flows.  This  will also instruct ovn-northd to aspire for
                     the lock on SB DB.

              <b>i</b><b>s</b><b>-</b><b>p</b><b>a</b><b>u</b><b>s</b><b>e</b><b>d</b>
                     Returns "true" if ovn-northd is currently paused, "false"
                     otherwise.

              <b>s</b><b>t</b><b>a</b><b>t</b><b>u</b><b>s</b> Prints  this  server’s status. Status will be "active" if
                     ovn-northd has acquired OVSDB lock on SB DB, "standby" if
                     it has not or "paused" if this instance is paused.

              <b>s</b><b>b</b><b>-</b><b>c</b><b>l</b><b>u</b><b>s</b><b>t</b><b>e</b><b>r</b><b>-</b><b>s</b><b>t</b><b>a</b><b>t</b><b>e</b><b>-</b><b>r</b><b>e</b><b>s</b><b>e</b><b>t</b>
                     Reset  southbound  database cluster status when databases
                     are destroyed and rebuilt.

                     If all databases in a clustered southbound  database  are
                     removed from disk, then the stored index of all databases
                     will be reset to zero. This will cause ovn-northd  to  be
                     unable  to  read  or  write  to  the southbound database,
                     because it will always detect the data as stale. In  such
                     a  case,  run  this command so that ovn-northd will reset
                     its local index so that it can interact with  the  south‐
                     bound database again.

              <b>n</b><b>b</b><b>-</b><b>c</b><b>l</b><b>u</b><b>s</b><b>t</b><b>e</b><b>r</b><b>-</b><b>s</b><b>t</b><b>a</b><b>t</b><b>e</b><b>-</b><b>r</b><b>e</b><b>s</b><b>e</b><b>t</b>
                     Reset  northbound  database cluster status when databases
                     are destroyed and rebuilt.

                     This performs the  same  task  as  <b>s</b><b>b</b><b>-</b><b>c</b><b>l</b><b>u</b><b>s</b><b>t</b><b>e</b><b>r</b><b>-</b><b>s</b><b>t</b><b>a</b><b>t</b><b>e</b><b>-</b><b>r</b><b>e</b><b>s</b><b>e</b><b>t</b>
                     except for the northbound database client.

       Only <b>o</b><b>v</b><b>n</b><b>-</b><b>n</b><b>o</b><b>r</b><b>t</b><b>h</b><b>d</b><b>-</b><b>d</b><b>d</b><b>l</b><b>o</b><b>g</b> supports the following commands:

              <b>e</b><b>n</b><b>a</b><b>b</b><b>l</b><b>e</b><b>-</b><b>c</b><b>p</b><b>u</b><b>-</b><b>p</b><b>r</b><b>o</b><b>f</b><b>i</b><b>l</b><b>i</b><b>n</b><b>g</b>
              <b>d</b><b>i</b><b>s</b><b>a</b><b>b</b><b>l</b><b>e</b><b>-</b><b>c</b><b>p</b><b>u</b><b>-</b><b>p</b><b>r</b><b>o</b><b>f</b><b>i</b><b>l</b><b>i</b><b>n</b><b>g</b>
                   Enables or disables profiling of CPU time used by the DDlog
                   engine. When CPU profiling is enabled, the <b>p</b><b>r</b><b>o</b><b>f</b><b>i</b><b>l</b><b>e</b>  command
                   (see  below) will include DDlog CPU usage statistics in its
                   output. Enabling CPU profiling will slow  <b>o</b><b>v</b><b>n</b><b>-</b><b>n</b><b>o</b><b>r</b><b>t</b><b>h</b><b>d</b><b>-</b><b>d</b><b>d</b><b>l</b><b>o</b><b>g</b>.
                   Disabling  CPU  profiling  does  not  clear  any previously
                   recorded statistics.

              <b>p</b><b>r</b><b>o</b><b>f</b><b>i</b><b>l</b><b>e</b>
                   Outputs a profile of the current and peak sizes of arrange‐
                   ments  inside  DDlog. This profiling data can be useful for
                   optimizing DDlog code.  If  CPU  profiling  was  previously
                   enabled  (even  if  it was later disabled), the output also
                   includes a CPU time profile. See <b>P</b><b>r</b><b>o</b><b>f</b><b>i</b><b>l</b><b>i</b><b>n</b><b>g</b> inside the tuto‐
                   rial in the DDlog repository for an introduction to profil‐
                   ing DDlog.

<b>A</b><b>C</b><b>T</b><b>I</b><b>V</b><b>E</b><b>-</b><b>S</b><b>T</b><b>A</b><b>N</b><b>D</b><b>B</b><b>Y</b> <b>F</b><b>O</b><b>R</b> <b>H</b><b>I</b><b>G</b><b>H</b> <b>A</b><b>V</b><b>A</b><b>I</b><b>L</b><b>A</b><b>B</b><b>I</b><b>L</b><b>I</b><b>T</b><b>Y</b>
       You may run <b>o</b><b>v</b><b>n</b><b>-</b><b>n</b><b>o</b><b>r</b><b>t</b><b>h</b><b>d</b> more than once in an OVN deployment.  When  con‐
       nected  to  a  standalone or clustered DB setup, OVN will automatically
       ensure that only one of them is active at a time. If multiple instances
       of  <b>o</b><b>v</b><b>n</b><b>-</b><b>n</b><b>o</b><b>r</b><b>t</b><b>h</b><b>d</b>  are running and the active <b>o</b><b>v</b><b>n</b><b>-</b><b>n</b><b>o</b><b>r</b><b>t</b><b>h</b><b>d</b> fails, one of the
       hot standby instances of <b>o</b><b>v</b><b>n</b><b>-</b><b>n</b><b>o</b><b>r</b><b>t</b><b>h</b><b>d</b> will automatically take over.

   <b>A</b><b>c</b><b>t</b><b>i</b><b>v</b><b>e</b><b>-</b><b>S</b><b>t</b><b>a</b><b>n</b><b>d</b><b>b</b><b>y</b> <b>w</b><b>i</b><b>t</b><b>h</b> <b>m</b><b>u</b><b>l</b><b>t</b><b>i</b><b>p</b><b>l</b><b>e</b> <b>O</b><b>V</b><b>N</b> <b>D</b><b>B</b> <b>s</b><b>e</b><b>r</b><b>v</b><b>e</b><b>r</b><b>s</b>
       You may run multiple OVN DB servers in an OVN deployment with:

              ·      OVN DB servers deployed in active/passive mode  with  one
                     active and multiple passive ovsdb-servers.

              ·      <b>o</b><b>v</b><b>n</b><b>-</b><b>n</b><b>o</b><b>r</b><b>t</b><b>h</b><b>d</b>  also  deployed on all these nodes, using unix
                     ctl sockets to connect to the local OVN DB servers.

       In such deployments, the ovn-northds on the passive nodes will  process
       the  DB  changes  and  compute  logical  flows  to be thrown out later,
       because write transactions  are  not  allowed  by  the  passive  ovsdb-
       servers. It results in unnecessary CPU usage.

       With  the  help  of  runtime  management  command  <b>p</b><b>a</b><b>u</b><b>s</b><b>e</b>, you can pause
       <b>o</b><b>v</b><b>n</b><b>-</b><b>n</b><b>o</b><b>r</b><b>t</b><b>h</b><b>d</b> on these nodes. When a passive node becomes master, you  can
       use  the  runtime management command <b>r</b><b>e</b><b>s</b><b>u</b><b>m</b><b>e</b> to resume the <b>o</b><b>v</b><b>n</b><b>-</b><b>n</b><b>o</b><b>r</b><b>t</b><b>h</b><b>d</b> to
       process the DB changes.

<b>L</b><b>O</b><b>G</b><b>I</b><b>C</b><b>A</b><b>L</b> <b>F</b><b>L</b><b>O</b><b>W</b> <b>T</b><b>A</b><b>B</b><b>L</b><b>E</b> <b>S</b><b>T</b><b>R</b><b>U</b><b>C</b><b>T</b><b>U</b><b>R</b><b>E</b>
       One of the main purposes of <b>o</b><b>v</b><b>n</b><b>-</b><b>n</b><b>o</b><b>r</b><b>t</b><b>h</b><b>d</b> is to populate the  <b>L</b><b>o</b><b>g</b><b>i</b><b>c</b><b>a</b><b>l</b><b>_</b><b>F</b><b>l</b><b>o</b><b>w</b>
       table  in  the  <b>O</b><b>V</b><b>N</b><b>_</b><b>S</b><b>o</b><b>u</b><b>t</b><b>h</b><b>b</b><b>o</b><b>u</b><b>n</b><b>d</b>  database.  This  section  describes how
       <b>o</b><b>v</b><b>n</b><b>-</b><b>n</b><b>o</b><b>r</b><b>t</b><b>h</b><b>d</b> does this for switch and router logical datapaths.

   <b>L</b><b>o</b><b>g</b><b>i</b><b>c</b><b>a</b><b>l</b> <b>S</b><b>w</b><b>i</b><b>t</b><b>c</b><b>h</b> <b>D</b><b>a</b><b>t</b><b>a</b><b>p</b><b>a</b><b>t</b><b>h</b><b>s</b>
     <u>I</u><u>n</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>0</u><u>:</u> <u>A</u><u>d</u><u>m</u><u>i</u><u>s</u><u>s</u><u>i</u><u>o</u><u>n</u> <u>C</u><u>o</u><u>n</u><u>t</u><u>r</u><u>o</u><u>l</u> <u>a</u><u>n</u><u>d</u> <u>I</u><u>n</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>P</u><u>o</u><u>r</u><u>t</u> <u>S</u><u>e</u><u>c</u><u>u</u><u>r</u><u>i</u><u>t</u><u>y</u> <u>-</u> <u>L</u><u>2</u>

       Ingress table 0 contains these logical flows:

              ·      Priority 100 flows to drop packets with VLAN tags or mul‐
                     ticast Ethernet source addresses.

              ·      Priority  50  flows  that implement ingress port security
                     for each enabled logical port. For logical ports on which
                     port  security is enabled, these match the <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b> and the
                     valid <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b> address(es) and advance only those  packets
                     to  the  next flow table. For logical ports on which port
                     security is not enabled, these advance all  packets  that
                     match the <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b>.

       There  are no flows for disabled logical ports because the default-drop
       behavior of logical flow tables causes packets that ingress  from  them
       to be dropped.

     <u>I</u><u>n</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>1</u><u>:</u> <u>I</u><u>n</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>P</u><u>o</u><u>r</u><u>t</u> <u>S</u><u>e</u><u>c</u><u>u</u><u>r</u><u>i</u><u>t</u><u>y</u> <u>-</u> <u>I</u><u>P</u>

       Ingress table 1 contains these logical flows:

              ·      For  each  element in the port security set having one or
                     more IPv4 or IPv6 addresses (or both),

                     ·      Priority 90 flow to allow IPv4 traffic if  it  has
                            IPv4  addresses  which  match  the  <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b>,  valid
                            <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b> and valid <b>i</b><b>p</b><b>4</b><b>.</b><b>s</b><b>r</b><b>c</b> address(es).

                     ·      Priority 90 flow  to  allow  IPv4  DHCP  discovery
                            traffic  if it has a valid <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b>. This is neces‐
                            sary since DHCP discovery messages are  sent  from
                            the  unspecified  IPv4 address (0.0.0.0) since the
                            IPv4 address has not yet been assigned.

                     ·      Priority 90 flow to allow IPv6 traffic if  it  has
                            IPv6  addresses  which  match  the  <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b>,  valid
                            <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b> and valid <b>i</b><b>p</b><b>6</b><b>.</b><b>s</b><b>r</b><b>c</b> address(es).

                     ·      Priority 90 flow  to  allow  IPv6  DAD  (Duplicate
                            Address  Detection)  traffic  if  it  has  a valid
                            <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b>. This is is necessary  since  DAD  include
                            requires  joining  an  multicast group and sending
                            neighbor  solicitations  for  the  newly  assigned
                            address.  Since  no address is yet assigned, these
                            are sent from the unspecified IPv6 address (::).

                     ·      Priority 80 flow to drop IP (both IPv4  and  IPv6)
                            traffic which match the <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b> and valid <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b>.

              ·      One priority-0 fallback flow that matches all packets and
                     advances to the next table.

     <u>I</u><u>n</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>2</u><u>:</u> <u>I</u><u>n</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>P</u><u>o</u><u>r</u><u>t</u> <u>S</u><u>e</u><u>c</u><u>u</u><u>r</u><u>i</u><u>t</u><u>y</u> <u>-</u> <u>N</u><u>e</u><u>i</u><u>g</u><u>h</u><u>b</u><u>o</u><u>r</u> <u>d</u><u>i</u><u>s</u><u>c</u><u>o</u><u>v</u><u>e</u><u>r</u><u>y</u>

       Ingress table 2 contains these logical flows:

              ·      For each element in the port security set,

                     ·      Priority 90 flow to allow ARP traffic which  match
                            the  <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b>  and valid <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b> and <b>a</b><b>r</b><b>p</b><b>.</b><b>s</b><b>h</b><b>a</b>. If the
                            element has one or more IPv4  addresses,  then  it
                            also matches the valid <b>a</b><b>r</b><b>p</b><b>.</b><b>s</b><b>p</b><b>a</b>.

                     ·      Priority  90 flow to allow IPv6 Neighbor Solicita‐
                            tion and Advertisement  traffic  which  match  the
                            <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b>,  valid  <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b>  and <b>n</b><b>d</b><b>.</b><b>s</b><b>l</b><b>l</b>/<b>n</b><b>d</b><b>.</b><b>t</b><b>l</b><b>l</b>. If the
                            element has one or more IPv6  addresses,  then  it
                            also  matches  the valid <b>n</b><b>d</b><b>.</b><b>t</b><b>a</b><b>r</b><b>g</b><b>e</b><b>t</b> address(es) for
                            Neighbor Advertisement traffic.

                     ·      Priority 80 flow to drop  ARP  and  IPv6  Neighbor
                            Solicitation and Advertisement traffic which match
                            the <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b> and valid <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b>.

              ·      One priority-0 fallback flow that matches all packets and
                     advances to the next table.

     <u>I</u><u>n</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>3</u><u>:</u> <u>L</u><u>o</u><u>o</u><u>k</u><u>u</u><u>p</u> <u>M</u><u>A</u><u>C</u> <u>a</u><u>d</u><u>d</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>l</u><u>e</u><u>a</u><u>r</u><u>n</u><u>i</u><u>n</u><u>g</u> <u>t</u><u>a</u><u>b</u><u>l</u><u>e</u>

       This  table looks up the MAC learning table of the logical switch data‐
       path to check if the <b>p</b><b>o</b><b>r</b><b>t</b><b>-</b><b>m</b><b>a</b><b>c</b> pair is present or  not.  MAC  is  learnt
       only  for  logical switch VIF ports whose port security is disabled and
       ’unknown’ address set.

              ·      For each such logical port <u>p</u> whose port security is  dis‐
                     abled and ’unknown’ address set following flow is added.

                     ·      Priority  100  flow with the match <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b> <b>=</b><b>=</b> <u>p</u> and
                            action  <b>r</b><b>e</b><b>g</b><b>0</b><b>[</b><b>1</b><b>1</b><b>]</b>  <b>=</b>  <b>l</b><b>o</b><b>o</b><b>k</b><b>u</b><b>p</b><b>_</b><b>f</b><b>d</b><b>b</b><b>(</b><b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b><b>,</b>  <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b><b>)</b><b>;</b>
                            <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>

              ·      One priority-0 fallback flow that matches all packets and
                     advances to the next table.

     <u>I</u><u>n</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>4</u><u>:</u> <u>L</u><u>e</u><u>a</u><u>r</u><u>n</u> <u>M</u><u>A</u><u>C</u> <u>o</u><u>f</u> <u>’</u><u>u</u><u>n</u><u>k</u><u>n</u><u>o</u><u>w</u><u>n</u><u>’</u> <u>p</u><u>o</u><u>r</u><u>t</u><u>s</u><u>.</u>

       This table learns the MAC addresses seen on  the  logical  ports  whose
       port  security  is disabled and ’unknown’ address set if the <b>l</b><b>o</b><b>o</b><b>k</b><b>u</b><b>p</b><b>_</b><b>f</b><b>d</b><b>b</b>
       action returned false in the previous table.

              ·      For each such logical port <u>p</u> whose port security is  dis‐
                     abled and ’unknown’ address set following flow is added.

                     ·      Priority  100  flow  with the match <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b> <b>=</b><b>=</b> <u>p</u> &amp;&amp;&amp;&amp;
                            <b>r</b><b>e</b><b>g</b><b>0</b><b>[</b><b>1</b><b>1</b><b>]</b> <b>=</b><b>=</b> <b>0</b> and action <b>p</b><b>u</b><b>t</b><b>_</b><b>f</b><b>d</b><b>b</b><b>(</b><b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b><b>,</b> <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b><b>)</b><b>;</b>
                            <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>  which stores the <b>p</b><b>o</b><b>r</b><b>t</b><b>-</b><b>m</b><b>a</b><b>c</b> in the mac learn‐
                            ing table  of  the  logical  switch  datapath  and
                            advances the packet to the next table.

              ·      One priority-0 fallback flow that matches all packets and
                     advances to the next table.

     <u>I</u><u>n</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>5</u><u>:</u> <b>f</b><b>r</b><b>o</b><b>m</b><b>-</b><b>l</b><b>p</b><b>o</b><b>r</b><b>t</b> <u>P</u><u>r</u><u>e</u><u>-</u><u>A</u><u>C</u><u>L</u><u>s</u>

       This table prepares flows  for  possible  stateful  ACL  processing  in
       ingress  table  <b>A</b><b>C</b><b>L</b><b>s</b>.  It  contains a priority-0 flow that simply moves
       traffic to the next table. If stateful ACLs are  used  in  the  logical
       datapath, a priority-100 flow is added that sets a hint (with <b>r</b><b>e</b><b>g</b><b>0</b><b>[</b><b>0</b><b>]</b> <b>=</b>
       <b>1</b><b>;</b> <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>) for table <b>P</b><b>r</b><b>e</b><b>-</b><b>s</b><b>t</b><b>a</b><b>t</b><b>e</b><b>f</b><b>u</b><b>l</b> to send IP packets to  the  connection
       tracker  before  eventually advancing to ingress table <b>A</b><b>C</b><b>L</b><b>s</b>. If special
       ports such as route ports or localnet ports can’t use  ct(),  a  prior‐
       ity-110 flow is added to skip over stateful ACLs. IPv6 Neighbor Discov‐
       ery and MLD traffic also skips  stateful  ACLs.  For  "allow-stateless"
       ACLs, a flow is added to bypass setting the hint for connection tracker
       processing.

       This table also has a priority-110 flow with the match <b>e</b><b>t</b><b>h</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b><b>=</b> <u>E</u> for
       all logical switch datapaths to move traffic to the next table. Where <u>E</u>
       is the service monitor mac defined in the <b>o</b><b>p</b><b>t</b><b>i</b><b>o</b><b>n</b><b>s</b><b>:</b><b>s</b><b>v</b><b>c</b><b>_</b><b>m</b><b>o</b><b>n</b><b>i</b><b>t</b><b>o</b><b>r</b><b>_</b><b>m</b><b>a</b><b>c</b> colum
       of <b>N</b><b>B</b><b>_</b><b>G</b><b>l</b><b>o</b><b>b</b><b>a</b><b>l</b> table.

     <u>I</u><u>n</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>6</u><u>:</u> <u>P</u><u>r</u><u>e</u><u>-</u><u>L</u><u>B</u>

       This table prepares flows for possible stateful load balancing process‐
       ing in ingress table <b>L</b><b>B</b> and <b>S</b><b>t</b><b>a</b><b>t</b><b>e</b><b>f</b><b>u</b><b>l</b>. It  contains  a  priority-0  flow
       that  simply  moves  traffic  to the next table. Moreover it contains a
       priority-110 flow to move IPv6 Neighbor Discovery and  MLD  traffic  to
       the  next table. If load balancing rules with virtual IP addresses (and
       ports) are configured in <b>O</b><b>V</b><b>N</b><b>_</b><b>N</b><b>o</b><b>r</b><b>t</b><b>h</b><b>b</b><b>o</b><b>u</b><b>n</b><b>d</b> database for a  logical  switch
       datapath, a priority-100 flow is added with the match <b>i</b><b>p</b> to match on IP
       packets and sets the action <b>r</b><b>e</b><b>g</b><b>0</b><b>[</b><b>2</b><b>]</b> <b>=</b> <b>1</b><b>;</b> <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b> to act as a hint for ta‐
       ble  <b>P</b><b>r</b><b>e</b><b>-</b><b>s</b><b>t</b><b>a</b><b>t</b><b>e</b><b>f</b><b>u</b><b>l</b>  to  send  IP  packets  to the connection tracker for
       packet de-fragmentation (and to possibly do  DNAT  for  already  estab‐
       lished  load  balanced  traffic) before eventually advancing to ingress
       table <b>S</b><b>t</b><b>a</b><b>t</b><b>e</b><b>f</b><b>u</b><b>l</b>. If controller_event has been enabled and load balancing
       rules with empty backends have been added in <b>O</b><b>V</b><b>N</b><b>_</b><b>N</b><b>o</b><b>r</b><b>t</b><b>h</b><b>b</b><b>o</b><b>u</b><b>n</b><b>d</b>, a 130 flow
       is added to trigger ovn-controller events whenever the chassis receives
       a  packet  for  that particular VIP. If <b>e</b><b>v</b><b>e</b><b>n</b><b>t</b><b>-</b><b>e</b><b>l</b><b>b</b> meter has been previ‐
       ously created, it will be associated to the empty_lb logical flow

       Prior to <b>O</b><b>V</b><b>N</b> <b>2</b><b>0</b><b>.</b><b>0</b><b>9</b> we were setting the <b>r</b><b>e</b><b>g</b><b>0</b><b>[</b><b>0</b><b>]</b> <b>=</b> <b>1</b> only if the IP  des‐
       tination  matches  the  load  balancer VIP. However this had few issues
       cases where a logical switch doesn’t have any ACLs  with  <b>a</b><b>l</b><b>l</b><b>o</b><b>w</b><b>-</b><b>r</b><b>e</b><b>l</b><b>a</b><b>t</b><b>e</b><b>d</b>
       action.  To  understand  the  issue  lets  a take a TCP load balancer -
       <b>1</b><b>0</b><b>.</b><b>0</b><b>.</b><b>0</b><b>.</b><b>1</b><b>0</b><b>:</b><b>8</b><b>0</b><b>=</b><b>1</b><b>0</b><b>.</b><b>0</b><b>.</b><b>0</b><b>.</b><b>3</b><b>:</b><b>8</b><b>0</b>. If a logical port - p1  with  IP  -  10.0.0.5
       opens a TCP connection with the VIP - 10.0.0.10, then the packet in the
       ingress pipeline of ’p1’ is sent to the p1’s conntrack zone id and  the
       packet is load balanced to the backend - 10.0.0.3. For the reply packet
       from the backend lport, it is not sent  to  the  conntrack  of  backend
       lport’s  zone  id. This is fine as long as the packet is valid. Suppose
       the backend lport sends an invalid TCP packet (like incorrect  sequence
       number),  the packet gets delivered to the lport ’p1’ without unDNATing
       the packet to the VIP - 10.0.0.10. And this causes the connection to be
       reset by the lport p1’s VIF.

       We can’t fix this issue by adding a logical flow to drop ct.inv packets
       in the egress pipeline since it will drop  all  other  connections  not
       destined  to  the  load  balancers.  To fix this issue, we send all the
       packets to the conntrack in the ingress pipeline if a load balancer  is
       configured. We can now add a lflow to drop ct.inv packets.

       This table also has a priority-110 flow with the match <b>e</b><b>t</b><b>h</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b><b>=</b> <u>E</u> for
       all logical switch datapaths to move traffic to the next table. Where <u>E</u>
       is the service monitor mac defined in the <b>o</b><b>p</b><b>t</b><b>i</b><b>o</b><b>n</b><b>s</b><b>:</b><b>s</b><b>v</b><b>c</b><b>_</b><b>m</b><b>o</b><b>n</b><b>i</b><b>t</b><b>o</b><b>r</b><b>_</b><b>m</b><b>a</b><b>c</b> colum
       of <b>N</b><b>B</b><b>_</b><b>G</b><b>l</b><b>o</b><b>b</b><b>a</b><b>l</b> table.

       This table also has a priority-110 flow with the match <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b> <b>=</b><b>=</b> <u>I</u>  for
       all logical switch datapaths to move traffic to the next table. Where <u>I</u>
       is the peer of a logical router port. This flow is added  to  skip  the
       connection tracking of packets which enter from logical router datapath
       to logical switch datapath.

     <u>I</u><u>n</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>7</u><u>:</u> <u>P</u><u>r</u><u>e</u><u>-</u><u>s</u><u>t</u><u>a</u><u>t</u><u>e</u><u>f</u><u>u</u><u>l</u>

       This table prepares flows for all possible stateful processing in  next
       tables.  It contains a priority-0 flow that simply moves traffic to the
       next table.

              ·      Priority-120 flows that send the  packets  to  connection
                     tracker  using  <b>c</b><b>t</b><b>_</b><b>l</b><b>b</b><b>;</b>  as the action so that the already
                     established traffic destined to  the  load  balancer  VIP
                     gets  DNATted  based  on  a hint provided by the previous
                     tables (with a match for <b>r</b><b>e</b><b>g</b><b>0</b><b>[</b><b>2</b><b>]</b> <b>=</b><b>=</b> <b>1</b>  and  on  supported
                     load  balancer  protocols and address families). For IPv4
                     traffic the flows also load the original  destination  IP
                     and  transport  port in registers <b>r</b><b>e</b><b>g</b><b>1</b> and <b>r</b><b>e</b><b>g</b><b>2</b>. For IPv6
                     traffic the flows also load the original  destination  IP
                     and transport port in registers <b>x</b><b>x</b><b>r</b><b>e</b><b>g</b><b>1</b> and <b>r</b><b>e</b><b>g</b><b>2</b>.

              ·      A  priority-110  flow  sends  the  packets  to connection
                     tracker based on a hint provided by the  previous  tables
                     (with  a  match  for  <b>r</b><b>e</b><b>g</b><b>0</b><b>[</b><b>2</b><b>]</b>  <b>=</b><b>=</b>  <b>1</b>) by using the <b>c</b><b>t</b><b>_</b><b>l</b><b>b</b><b>;</b>
                     action. This flow is added to handle the traffic for load
                     balancer  VIPs  whose protocol is not defined (mainly for
                     ICMP traffic).

              ·      A priority-100  flow  sends  the  packets  to  connection
                     tracker  based  on a hint provided by the previous tables
                     (with a match for <b>r</b><b>e</b><b>g</b><b>0</b><b>[</b><b>0</b><b>]</b> <b>=</b><b>=</b> <b>1</b>)  by  using  the  <b>c</b><b>t</b><b>_</b><b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>
                     action.

     <u>I</u><u>n</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>8</u><u>:</u> <b>f</b><b>r</b><b>o</b><b>m</b><b>-</b><b>l</b><b>p</b><b>o</b><b>r</b><b>t</b> <u>A</u><u>C</u><u>L</u> <u>h</u><u>i</u><u>n</u><u>t</u><u>s</u>

       This  table  consists of logical flows that set hints (<b>r</b><b>e</b><b>g</b><b>0</b> bits) to be
       used in the next stage, in the ACL processing table, if  stateful  ACLs
       or  load  balancers  are  configured. Multiple hints can be set for the
       same packet. The possible hints are:

              ·      <b>r</b><b>e</b><b>g</b><b>0</b><b>[</b><b>7</b><b>]</b>: the packet might match an <b>a</b><b>l</b><b>l</b><b>o</b><b>w</b><b>-</b><b>r</b><b>e</b><b>l</b><b>a</b><b>t</b><b>e</b><b>d</b> ACL  and
                     might have to commit the connection to conntrack.

              ·      <b>r</b><b>e</b><b>g</b><b>0</b><b>[</b><b>8</b><b>]</b>:  the packet might match an <b>a</b><b>l</b><b>l</b><b>o</b><b>w</b><b>-</b><b>r</b><b>e</b><b>l</b><b>a</b><b>t</b><b>e</b><b>d</b> ACL but
                     there will be no need to commit the  connection  to  con‐
                     ntrack because it already exists.

              ·      <b>r</b><b>e</b><b>g</b><b>0</b><b>[</b><b>9</b><b>]</b>: the packet might match a <b>d</b><b>r</b><b>o</b><b>p</b><b>/</b><b>r</b><b>e</b><b>j</b><b>e</b><b>c</b><b>t</b>.

              ·      <b>r</b><b>e</b><b>g</b><b>0</b><b>[</b><b>1</b><b>0</b><b>]</b>:  the  packet  might match a <b>d</b><b>r</b><b>o</b><b>p</b><b>/</b><b>r</b><b>e</b><b>j</b><b>e</b><b>c</b><b>t</b> ACL but
                     the connection was previously allowed so it might have to
                     be committed again with <b>c</b><b>t</b><b>_</b><b>l</b><b>a</b><b>b</b><b>e</b><b>l</b><b>=</b><b>1</b><b>/</b><b>1</b>.

       The table contains the following flows:

              ·      A priority-65535 flow to advance to the next table if the
                     logical switch has <b>n</b><b>o</b> ACLs configured, otherwise a prior‐
                     ity-0 flow to advance to the next table.

              ·      A priority-7 flow that matches on packets that initiate a
                     new session. This flow sets <b>r</b><b>e</b><b>g</b><b>0</b><b>[</b><b>7</b><b>]</b> and <b>r</b><b>e</b><b>g</b><b>0</b><b>[</b><b>9</b><b>]</b> and  then
                     advances to the next table.

              ·      A priority-6 flow that matches on packets that are in the
                     request direction of an already existing session that has
                     been  marked  as  blocked.  This  flow  sets  <b>r</b><b>e</b><b>g</b><b>0</b><b>[</b><b>7</b><b>]</b> and
                     <b>r</b><b>e</b><b>g</b><b>0</b><b>[</b><b>9</b><b>]</b> and then advances to the next table.

              ·      A priority-5 flow that matches  untracked  packets.  This
                     flow  sets  <b>r</b><b>e</b><b>g</b><b>0</b><b>[</b><b>8</b><b>]</b>  and <b>r</b><b>e</b><b>g</b><b>0</b><b>[</b><b>9</b><b>]</b> and then advances to the
                     next table.

              ·      A priority-4 flow that matches on packets that are in the
                     request direction of an already existing session that has
                     not been marked as blocked. This flow  sets  <b>r</b><b>e</b><b>g</b><b>0</b><b>[</b><b>8</b><b>]</b>  and
                     <b>r</b><b>e</b><b>g</b><b>0</b><b>[</b><b>1</b><b>0</b><b>]</b> and then advances to the next table.

              ·      A priority-3 flow that matches on packets that are in not
                     part of established sessions. This flow sets <b>r</b><b>e</b><b>g</b><b>0</b><b>[</b><b>9</b><b>]</b>  and
                     then advances to the next table.

              ·      A  priority-2  flow that matches on packets that are part
                     of  an  established  session  that  has  been  marked  as
                     blocked.  This flow sets <b>r</b><b>e</b><b>g</b><b>0</b><b>[</b><b>9</b><b>]</b> and then advances to the
                     next table.

              ·      A priority-1 flow that matches on packets that  are  part
                     of  an  established  session  that has not been marked as
                     blocked. This flow sets <b>r</b><b>e</b><b>g</b><b>0</b><b>[</b><b>1</b><b>0</b><b>]</b> and then advances to the
                     next table.

     <u>I</u><u>n</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>t</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>9</u><u>:</u> <b>f</b><b>r</b><b>o</b><b>m</b><b>-</b><b>l</b><b>p</b><b>o</b><b>r</b><b>t</b> <u>A</u><u>C</u><u>L</u><u>s</u>

       Logical flows in this table closely reproduce those in the <b>A</b><b>C</b><b>L</b> table in
       the <b>O</b><b>V</b><b>N</b><b>_</b><b>N</b><b>o</b><b>r</b><b>t</b><b>h</b><b>b</b><b>o</b><b>u</b><b>n</b><b>d</b> database for the <b>f</b><b>r</b><b>o</b><b>m</b><b>-</b><b>l</b><b>p</b><b>o</b><b>r</b><b>t</b> direction. The  <b>p</b><b>r</b><b>i</b><b>o</b><b>r</b><b>i</b><b>t</b><b>y</b>
       values  from  the <b>A</b><b>C</b><b>L</b> table have a limited range and have 1000 added to
       them to leave room for OVN default flows at both higher and lower  pri‐
       orities.

              ·      <b>a</b><b>l</b><b>l</b><b>o</b><b>w</b>  ACLs  translate  into logical flows with the <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>
                     action. If there are any stateful ACLs on this  datapath,
                     then <b>a</b><b>l</b><b>l</b><b>o</b><b>w</b> ACLs translate to <b>c</b><b>t</b><b>_</b><b>c</b><b>o</b><b>m</b><b>m</b><b>i</b><b>t</b><b>;</b> <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b> (which acts
                     as a hint for the next tables to commit the connection to
                     conntrack),

              ·      <b>a</b><b>l</b><b>l</b><b>o</b><b>w</b><b>-</b><b>r</b><b>e</b><b>l</b><b>a</b><b>t</b><b>e</b><b>d</b>  ACLs translate into logical flows with the
                     <b>c</b><b>t</b><b>_</b><b>c</b><b>o</b><b>m</b><b>m</b><b>i</b><b>t</b><b>(</b><b>c</b><b>t</b><b>_</b><b>l</b><b>a</b><b>b</b><b>e</b><b>l</b><b>=</b><b>0</b><b>/</b><b>1</b><b>)</b><b>;</b> <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b> actions  for  new  connec‐
                     tions and <b>r</b><b>e</b><b>g</b><b>0</b><b>[</b><b>1</b><b>]</b> <b>=</b> <b>1</b><b>;</b> <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b> for existing connections.

              ·      <b>a</b><b>l</b><b>l</b><b>o</b><b>w</b><b>-</b><b>s</b><b>t</b><b>a</b><b>t</b><b>e</b><b>l</b><b>e</b><b>s</b><b>s</b>  ACLs  translate  into logical flows with
                     the <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b> action.

              ·      <b>r</b><b>e</b><b>j</b><b>e</b><b>c</b><b>t</b>  ACLs  translate  into  logical  flows  with   the
                     <b>t</b><b>c</b><b>p</b><b>_</b><b>r</b><b>e</b><b>s</b><b>e</b><b>t</b>  <b>{</b>  <b>o</b><b>u</b><b>t</b><b>p</b><b>u</b><b>t</b> <lt;<lt;<b>-</b>>gt;>gt; <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b><b>;</b> <b>n</b><b>e</b><b>x</b><b>t</b><b>(</b><b>p</b><b>i</b><b>p</b><b>e</b><b>l</b><b>i</b><b>n</b><b>e</b><b>=</b><b>e</b><b>g</b><b>r</b><b>e</b><b>s</b><b>s</b><b>,</b><b>t</b><b>a</b><b>‐</b>
                     <b>b</b><b>l</b><b>e</b><b>=</b><b>5</b><b>)</b><b>;</b><b>}</b> action for  TCP  connections,<b>i</b><b>c</b><b>m</b><b>p</b><b>4</b><b>/</b><b>i</b><b>c</b><b>m</b><b>p</b><b>6</b>  action
                     for   UDP  connections,  and  <b>s</b><b>c</b><b>t</b><b>p</b><b>_</b><b>a</b><b>b</b><b>o</b><b>r</b><b>t</b>  <b>{</b><b>o</b><b>u</b><b>t</b><b>p</b><b>u</b><b>t</b>  <lt;<lt;<b>-</b><b>%</b><b>g</b><b>t</b><b>;</b>
                     <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b><b>;</b> <b>n</b><b>e</b><b>x</b><b>t</b><b>(</b><b>p</b><b>i</b><b>p</b><b>e</b><b>l</b><b>i</b><b>n</b><b>e</b><b>=</b><b>e</b><b>g</b><b>r</b><b>e</b><b>s</b><b>s</b><b>,</b><b>t</b><b>a</b><b>b</b><b>l</b><b>e</b><b>=</b><b>5</b><b>)</b><b>;</b><b>}</b> action  for  SCTP
                     associations.

              ·      Other  ACLs  translate to <b>d</b><b>r</b><b>o</b><b>p</b><b>;</b> for new or untracked con‐
                     nections and <b>c</b><b>t</b><b>_</b><b>c</b><b>o</b><b>m</b><b>m</b><b>i</b><b>t</b><b>(</b><b>c</b><b>t</b><b>_</b><b>l</b><b>a</b><b>b</b><b>e</b><b>l</b><b>=</b><b>1</b><b>/</b><b>1</b><b>)</b><b>;</b> for  known  connec‐
                     tions.  Setting  <b>c</b><b>t</b><b>_</b><b>l</b><b>a</b><b>b</b><b>e</b><b>l</b>  marks a connection as one that
                     was previously allowed, but should no longer  be  allowed
                     due to a policy change.

       This  table contains a priority-65535 flow to advance to the next table
       if the logical switch has <b>n</b><b>o</b> ACLs configured,  otherwise  a  priority-0
       flow  to  advance  to  the  next  table  so  that ACLs allow packets by
       default.

       If the logical datapath has a stateful ACL or a load balancer with  VIP
       configured, the following flows will also be added:

              ·      A priority-1 flow that sets the hint to commit IP traffic
                     to the connection  tracker  (with  action  <b>r</b><b>e</b><b>g</b><b>0</b><b>[</b><b>1</b><b>]</b>  <b>=</b>  <b>1</b><b>;</b>
                     <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>).  This  is  needed  for  the  default allow policy
                     because, while the initiator’s direction may not have any
                     stateful  rules,  the  server’s  may  and then its return
                     traffic would not be known and marked as invalid.

              ·      A priority-65532 flow that  allows  any  traffic  in  the
                     reply  direction for a connection that has been committed
                     to the connection tracker (i.e., established  flows),  as
                     long as the committed flow does not have <b>c</b><b>t</b><b>_</b><b>l</b><b>a</b><b>b</b><b>e</b><b>l</b><b>.</b><b>b</b><b>l</b><b>o</b><b>c</b><b>k</b><b>e</b><b>d</b>
                     set. We only handle traffic in the reply  direction  here
                     because  we  want all packets going in the request direc‐
                     tion to still go through the  flows  that  implement  the
                     currently  defined  policy based on ACLs. If a connection
                     is no longer allowed by policy, <b>c</b><b>t</b><b>_</b><b>l</b><b>a</b><b>b</b><b>e</b><b>l</b><b>.</b><b>b</b><b>l</b><b>o</b><b>c</b><b>k</b><b>e</b><b>d</b> will get
                     set  and packets in the reply direction will no longer be
                     allowed, either.

              ·      A priority-65532 flow that allows  any  traffic  that  is
                     considered  related to a committed flow in the connection
                     tracker (e.g., an ICMP Port Unreachable from  a  non-lis‐
                     tening  UDP port), as long as the committed flow does not
                     have <b>c</b><b>t</b><b>_</b><b>l</b><b>a</b><b>b</b><b>e</b><b>l</b><b>.</b><b>b</b><b>l</b><b>o</b><b>c</b><b>k</b><b>e</b><b>d</b> set.

              ·      A priority-65532 flow that drops all  traffic  marked  by
                     the connection tracker as invalid.

              ·      A priority-65532 flow that drops all traffic in the reply
                     direction with <b>c</b><b>t</b><b>_</b><b>l</b><b>a</b><b>b</b><b>e</b><b>l</b><b>.</b><b>b</b><b>l</b><b>o</b><b>c</b><b>k</b><b>e</b><b>d</b> set meaning that the con‐
                     nection  should  no  longer  be  allowed  due to a policy
                     change. Packets in the request direction are skipped here
                     to let a newly created ACL re-allow this connection.

              ·      A priority-65532 flow that allows IPv6 Neighbor solicita‐
                     tion,  Neighbor  discover,  Router  solicitation,  Router
                     advertisement and MLD packets.

       If the logical datapath has any ACL or a load balancer with VIP config‐
       ured, the following flow will also be added:

              ·      A priority 34000 logical flow is added for  each  logical
                     switch  datapath  with the match <b>e</b><b>t</b><b>h</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b> <u>E</u> to allow the
                     service monitor reply packet destined  to  <b>o</b><b>v</b><b>n</b><b>-</b><b>c</b><b>o</b><b>n</b><b>t</b><b>r</b><b>o</b><b>l</b><b>l</b><b>e</b><b>r</b>
                     with  the action <b>n</b><b>e</b><b>x</b><b>t</b>, where <u>E</u> is the service monitor mac
                     defined in the <b>o</b><b>p</b><b>t</b><b>i</b><b>o</b><b>n</b><b>s</b><b>:</b><b>s</b><b>v</b><b>c</b><b>_</b><b>m</b><b>o</b><b>n</b><b>i</b><b>t</b><b>o</b><b>r</b><b>_</b><b>m</b><b>a</b><b>c</b> colum of <b>N</b><b>B</b><b>_</b><b>G</b><b>l</b><b>o</b><b>b</b><b>a</b><b>l</b>
                     table.

     <u>I</u><u>n</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>1</u><u>0</u><u>:</u> <b>f</b><b>r</b><b>o</b><b>m</b><b>-</b><b>l</b><b>p</b><b>o</b><b>r</b><b>t</b> <u>Q</u><u>o</u><u>S</u> <u>M</u><u>a</u><u>r</u><u>k</u><u>i</u><u>n</u><u>g</u>

       Logical  flows  in  this table closely reproduce those in the <b>Q</b><b>o</b><b>S</b> table
       with the <b>a</b><b>c</b><b>t</b><b>i</b><b>o</b><b>n</b> column set  in  the  <b>O</b><b>V</b><b>N</b><b>_</b><b>N</b><b>o</b><b>r</b><b>t</b><b>h</b><b>b</b><b>o</b><b>u</b><b>n</b><b>d</b>  database  for  the
       <b>f</b><b>r</b><b>o</b><b>m</b><b>-</b><b>l</b><b>p</b><b>o</b><b>r</b><b>t</b> direction.

              ·      For  every  qos_rules entry in a logical switch with DSCP
                     marking enabled, a flow will be  added  at  the  priority
                     mentioned in the QoS table.

              ·      One priority-0 fallback flow that matches all packets and
                     advances to the next table.

     <u>I</u><u>n</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>1</u><u>1</u><u>:</u> <b>f</b><b>r</b><b>o</b><b>m</b><b>-</b><b>l</b><b>p</b><b>o</b><b>r</b><b>t</b> <u>Q</u><u>o</u><u>S</u> <u>M</u><u>e</u><u>t</u><u>e</u><u>r</u>

       Logical flows in this table closely reproduce those in  the  <b>Q</b><b>o</b><b>S</b>  table
       with  the  <b>b</b><b>a</b><b>n</b><b>d</b><b>w</b><b>i</b><b>d</b><b>t</b><b>h</b>  column set in the <b>O</b><b>V</b><b>N</b><b>_</b><b>N</b><b>o</b><b>r</b><b>t</b><b>h</b><b>b</b><b>o</b><b>u</b><b>n</b><b>d</b> database for the
       <b>f</b><b>r</b><b>o</b><b>m</b><b>-</b><b>l</b><b>p</b><b>o</b><b>r</b><b>t</b> direction.

              ·      For every qos_rules entry in a logical switch with meter‐
                     ing  enabled,  a  flow will be added at the priority men‐
                     tioned in the QoS table.

              ·      One priority-0 fallback flow that matches all packets and
                     advances to the next table.

     <u>I</u><u>n</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>1</u><u>2</u><u>:</u> <u>S</u><u>t</u><u>a</u><u>t</u><u>e</u><u>f</u><u>u</u><u>l</u>

              ·      For  all the configured load balancing rules for a switch
                     in <b>O</b><b>V</b><b>N</b><b>_</b><b>N</b><b>o</b><b>r</b><b>t</b><b>h</b><b>b</b><b>o</b><b>u</b><b>n</b><b>d</b> database that includes a L4  port  <u>P</u><u>O</u><u>R</u><u>T</u>
                     of  protocol <u>P</u> and IP address <u>V</u><u>I</u><u>P</u>, a priority-120 flow is
                     added. For IPv4 <u>V</u><u>I</u><u>P</u><u>s</u> , the flow matches <b>c</b><b>t</b><b>.</b><b>n</b><b>e</b><b>w</b> &amp;&amp;&amp;&amp;  <b>i</b><b>p</b>  &amp;&amp;&amp;&amp;
                     <b>i</b><b>p</b><b>4</b><b>.</b><b>d</b><b>s</b><b>t</b>  <b>=</b><b>=</b> <u>V</u><u>I</u><u>P</u> &amp;&amp;&amp;&amp; <u>P</u> &amp;&amp;&amp;&amp; <u>P</u><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b><b>=</b> <u>P</u><u>O</u><u>R</u><u>T</u>. For IPv6 <u>V</u><u>I</u><u>P</u><u>s</u>, the
                     flow matches <b>c</b><b>t</b><b>.</b><b>n</b><b>e</b><b>w</b> &amp;&amp;&amp;&amp; <b>i</b><b>p</b> &amp;&amp;&amp;&amp; <b>i</b><b>p</b><b>6</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b><b>=</b> <u>V</u><u>I</u><u>P</u> &amp;&amp;&amp;&amp; <u>P</u> &amp;&amp;&amp;&amp; <u>P</u><b>.</b><b>d</b><b>s</b><b>t</b>
                     <b>=</b><b>=</b>  <u>P</u><u>O</u><u>R</u><u>T</u>.  The  flow’s action is <b>c</b><b>t</b><b>_</b><b>l</b><b>b</b><b>(</b><u>a</u><u>r</u><u>g</u><u>s</u><b>)</b> , where <u>a</u><u>r</u><u>g</u><u>s</u>
                     contains comma separated IP addresses (and optional  port
                     numbers) to load balance to. The address family of the IP
                     addresses of <u>a</u><u>r</u><u>g</u><u>s</u> is the same as the  address  family  of
                     <u>V</u><u>I</u><u>P</u>. If health check is enabled, then <u>a</u><u>r</u><u>g</u><u>s</u> will only con‐
                     tain those endpoints whose service monitor  status  entry
                     in  <b>O</b><b>V</b><b>N</b><b>_</b><b>S</b><b>o</b><b>u</b><b>t</b><b>h</b><b>b</b><b>o</b><b>u</b><b>n</b><b>d</b> db is either <b>o</b><b>n</b><b>l</b><b>i</b><b>n</b><b>e</b> or empty. For IPv4
                     traffic the flow also loads the original  destination  IP
                     and  transport  port in registers <b>r</b><b>e</b><b>g</b><b>1</b> and <b>r</b><b>e</b><b>g</b><b>2</b>. For IPv6
                     traffic the flow also loads the original  destination  IP
                     and transport port in registers <b>x</b><b>x</b><b>r</b><b>e</b><b>g</b><b>1</b> and <b>r</b><b>e</b><b>g</b><b>2</b>.

              ·      For  all the configured load balancing rules for a switch
                     in <b>O</b><b>V</b><b>N</b><b>_</b><b>N</b><b>o</b><b>r</b><b>t</b><b>h</b><b>b</b><b>o</b><b>u</b><b>n</b><b>d</b>  database  that  includes  just  an  IP
                     address  <u>V</u><u>I</u><u>P</u>  to  match on, OVN adds a priority-110 flow.
                     For IPv4 <u>V</u><u>I</u><u>P</u><u>s</u>, the flow matches <b>c</b><b>t</b><b>.</b><b>n</b><b>e</b><b>w</b> &amp;&amp;&amp;&amp; <b>i</b><b>p</b>  &amp;&amp;&amp;&amp;  <b>i</b><b>p</b><b>4</b><b>.</b><b>d</b><b>s</b><b>t</b>
                     <b>=</b><b>=</b>  <u>V</u><u>I</u><u>P</u>.  For IPv6 <u>V</u><u>I</u><u>P</u><u>s</u>, the flow matches <b>c</b><b>t</b><b>.</b><b>n</b><b>e</b><b>w</b> &amp;&amp;&amp;&amp; <b>i</b><b>p</b> &amp;&amp;&amp;&amp;
                     <b>i</b><b>p</b><b>6</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b><b>=</b> <u>V</u><u>I</u><u>P</u>. The action on this flow  is  <b>c</b><b>t</b><b>_</b><b>l</b><b>b</b><b>(</b><u>a</u><u>r</u><u>g</u><u>s</u><b>)</b>,
                     where  <u>a</u><u>r</u><u>g</u><u>s</u>  contains comma separated IP addresses of the
                     same address family as <u>V</u><u>I</u><u>P</u>. For  IPv4  traffic  the  flow
                     also loads the original destination IP and transport port
                     in registers <b>r</b><b>e</b><b>g</b><b>1</b> and <b>r</b><b>e</b><b>g</b><b>2</b>. For  IPv6  traffic  the  flow
                     also loads the original destination IP and transport port
                     in registers <b>x</b><b>x</b><b>r</b><b>e</b><b>g</b><b>1</b> and <b>r</b><b>e</b><b>g</b><b>2</b>.

              ·      If the load balancer is created with <b>-</b><b>-</b><b>r</b><b>e</b><b>j</b><b>e</b><b>c</b><b>t</b> option  and
                     it  has no active backends, a TCP reset segment (for tcp)
                     or an ICMP port unreachable packet (for all other kind of
                     traffic)  will  be  sent  whenever  an incoming packet is
                     received  for  this  load-balancer.  Please  note   using
                     <b>-</b><b>-</b><b>r</b><b>e</b><b>j</b><b>e</b><b>c</b><b>t</b> option will disable empty_lb SB controller event
                     for this load balancer.

              ·      A priority-100 flow commits packets to connection tracker
                     using <b>c</b><b>t</b><b>_</b><b>c</b><b>o</b><b>m</b><b>m</b><b>i</b><b>t</b><b>;</b> <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b> action based on a hint provided by
                     the previous tables (with a match for <b>r</b><b>e</b><b>g</b><b>0</b><b>[</b><b>1</b><b>]</b> <b>=</b><b>=</b> <b>1</b>).

              ·      A priority-0 flow that simply moves traffic to  the  next
                     table.

     <u>I</u><u>n</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>1</u><u>3</u><u>:</u> <u>P</u><u>r</u><u>e</u><u>-</u><u>H</u><u>a</u><u>i</u><u>r</u><u>p</u><u>i</u><u>n</u>

              ·      If  the  logical  switch has load balancer(s) configured,
                     then a priority-100 flow is added with the  match  <b>i</b><b>p</b>  &amp;&amp;&amp;&amp;
                     <b>c</b><b>t</b><b>.</b><b>t</b><b>r</b><b>k</b>  to check if the packet needs to be hairpinned (if
                     after load  balancing  the  destination  IP  matches  the
                     source  IP)  or  not  by  executing the actions <b>r</b><b>e</b><b>g</b><b>0</b><b>[</b><b>6</b><b>]</b> <b>=</b>
                     <b>c</b><b>h</b><b>k</b><b>_</b><b>l</b><b>b</b><b>_</b><b>h</b><b>a</b><b>i</b><b>r</b><b>p</b><b>i</b><b>n</b><b>(</b><b>)</b><b>;</b> and <b>r</b><b>e</b><b>g</b><b>0</b><b>[</b><b>1</b><b>2</b><b>]</b> <b>=</b>  <b>c</b><b>h</b><b>k</b><b>_</b><b>l</b><b>b</b><b>_</b><b>h</b><b>a</b><b>i</b><b>r</b><b>p</b><b>i</b><b>n</b><b>_</b><b>r</b><b>e</b><b>p</b><b>l</b><b>y</b><b>(</b><b>)</b><b>;</b>
                     and advances the packet to the next table.

              ·      A  priority-0  flow that simply moves traffic to the next
                     table.

     <u>I</u><u>n</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>1</u><u>4</u><u>:</u> <u>N</u><u>a</u><u>t</u><u>-</u><u>H</u><u>a</u><u>i</u><u>r</u><u>p</u><u>i</u><u>n</u>

              ·      If the logical switch has  load  balancer(s)  configured,
                     then  a  priority-100  flow is added with the match <b>i</b><b>p</b> &amp;&amp;&amp;&amp;
                     <b>c</b><b>t</b><b>.</b><b>n</b><b>e</b><b>w</b> &amp;&amp;&amp;&amp; <b>c</b><b>t</b><b>.</b><b>t</b><b>r</b><b>k</b> &amp;&amp;&amp;&amp; <b>r</b><b>e</b><b>g</b><b>0</b><b>[</b><b>6</b><b>]</b> <b>=</b><b>=</b> <b>1</b> which hairpins the traf‐
                     fic by NATting source IP to the load balancer VIP by exe‐
                     cuting the action <b>c</b><b>t</b><b>_</b><b>s</b><b>n</b><b>a</b><b>t</b><b>_</b><b>t</b><b>o</b><b>_</b><b>v</b><b>i</b><b>p</b> and advances the  packet
                     to the next table.

              ·      If  the  logical  switch has load balancer(s) configured,
                     then a priority-100 flow is added with the  match  <b>i</b><b>p</b>  &amp;&amp;&amp;&amp;
                     <b>c</b><b>t</b><b>.</b><b>e</b><b>s</b><b>t</b> &amp;&amp;&amp;&amp; <b>c</b><b>t</b><b>.</b><b>t</b><b>r</b><b>k</b> &amp;&amp;&amp;&amp; <b>r</b><b>e</b><b>g</b><b>0</b><b>[</b><b>6</b><b>]</b> <b>=</b><b>=</b> <b>1</b> which hairpins the traf‐
                     fic by NATting source IP to the load balancer VIP by exe‐
                     cuting  the action <b>c</b><b>t</b><b>_</b><b>s</b><b>n</b><b>a</b><b>t</b> and advances the packet to the
                     next table.

              ·      If the logical switch has  load  balancer(s)  configured,
                     then  a  priority-90  flow  is added with the match <b>i</b><b>p</b> &amp;&amp;&amp;&amp;
                     <b>r</b><b>e</b><b>g</b><b>0</b><b>[</b><b>1</b><b>2</b><b>]</b> <b>=</b><b>=</b> <b>1</b> which matches on the replies of  hairpinned
                     traffic  (i.e.,  destination  IP is VIP, source IP is the
                     backend IP and source L4 port is backend port for L4 load
                     balancers)  and  executes <b>c</b><b>t</b><b>_</b><b>s</b><b>n</b><b>a</b><b>t</b> and advances the packet
                     to the next table.

              ·      A priority-0 flow that simply moves traffic to  the  next
                     table.

     <u>I</u><u>n</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>1</u><u>5</u><u>:</u> <u>H</u><u>a</u><u>i</u><u>r</u><u>p</u><u>i</u><u>n</u>

              ·      A  priority-1  flow that hairpins traffic matched by non-
                     default flows in the Pre-Hairpin  table.  Hairpinning  is
                     done  at L2, Ethernet addresses are swapped and the pack‐
                     ets are looped back on the input port.

              ·      A priority-0 flow that simply moves traffic to  the  next
                     table.

     <u>I</u><u>n</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>1</u><u>6</u><u>:</u> <u>A</u><u>R</u><u>P</u><u>/</u><u>N</u><u>D</u> <u>r</u><u>e</u><u>s</u><u>p</u><u>o</u><u>n</u><u>d</u><u>e</u><u>r</u>

       This  table  implements  ARP/ND responder in a logical switch for known
       IPs. The advantage of the ARP responder flow is to limit ARP broadcasts
       by locally responding to ARP requests without the need to send to other
       hypervisors. One common case is when the inport is a logical port asso‐
       ciated with a VIF and the broadcast is responded to on the local hyper‐
       visor rather than broadcast across the whole network and  responded  to
       by the destination VM. This behavior is proxy ARP.

       ARP  requests  arrive  from  VMs  from  a logical switch inport of type
       default. For this case, the logical switch proxy ARP rules can  be  for
       other  VMs  or logical router ports. Logical switch proxy ARP rules may
       be programmed both for mac binding of IP  addresses  on  other  logical
       switch  VIF  ports  (which are of the default logical switch port type,
       representing connectivity to VMs or containers), and for mac binding of
       IP  addresses  on  logical switch router type ports, representing their
       logical router port peers. In order to support proxy  ARP  for  logical
       router  ports,  an  IP address must be configured on the logical switch
       router type port, with the same value as the peer logical router  port.
       The configured MAC addresses must match as well. When a VM sends an ARP
       request for a distributed logical router port and if  the  peer  router
       type  port  of  the attached logical switch does not have an IP address
       configured, the ARP request will be broadcast on  the  logical  switch.
       One of the copies of the ARP request will go through the logical switch
       router type port to the logical  router  datapath,  where  the  logical
       router  ARP  responder will generate a reply. The MAC binding of a dis‐
       tributed logical router, once learned by an associated VM, is used  for
       all  that VM’s communication needing routing. Hence, the action of a VM
       re-arping for the mac binding of the  logical  router  port  should  be
       rare.

       Logical  switch  ARP  responder  proxy  ARP  rules can also be hit when
       receiving ARP requests externally on a L2 gateway port. In  this  case,
       the  hypervisor acting as an L2 gateway, responds to the ARP request on
       behalf of a destination VM.

       Note that ARP requests received from <b>l</b><b>o</b><b>c</b><b>a</b><b>l</b><b>n</b><b>e</b><b>t</b> or <b>v</b><b>t</b><b>e</b><b>p</b>  logical  inports
       can either go directly to VMs, in which case the VM responds or can hit
       an ARP responder for a logical router port if the  packet  is  used  to
       resolve a logical router port next hop address. In either case, logical
       switch ARP responder rules will not be hit. It contains  these  logical
       flows:

              ·      Priority-100 flows to skip the ARP responder if inport is
                     of type <b>l</b><b>o</b><b>c</b><b>a</b><b>l</b><b>n</b><b>e</b><b>t</b> or <b>v</b><b>t</b><b>e</b><b>p</b> and  advances  directly  to  the
                     next  table.  ARP requests sent to <b>l</b><b>o</b><b>c</b><b>a</b><b>l</b><b>n</b><b>e</b><b>t</b> or <b>v</b><b>t</b><b>e</b><b>p</b> ports
                     can be received by multiple hypervisors. Now, because the
                     same mac binding rules are downloaded to all hypervisors,
                     each of the multiple hypervisors will respond. This  will
                     confuse  L2  learning  on the source of the ARP requests.
                     ARP requests received on an inport of type <b>r</b><b>o</b><b>u</b><b>t</b><b>e</b><b>r</b> are not
                     expected  to  hit any logical switch ARP responder flows.
                     However, no skip flows are installed for  these  packets,
                     as  there would be some additional flow cost for this and
                     the value appears limited.

              ·      If inport <b>V</b> is of type <b>v</b><b>i</b><b>r</b><b>t</b><b>u</b><b>a</b><b>l</b> adds a priority-100  logi‐
                     cal  flow  for  each <u>P</u> configured in the <b>o</b><b>p</b><b>t</b><b>i</b><b>o</b><b>n</b><b>s</b><b>:</b><b>v</b><b>i</b><b>r</b><b>t</b><b>u</b><b>a</b><b>l</b><b>-</b>
                     <b>p</b><b>a</b><b>r</b><b>e</b><b>n</b><b>t</b><b>s</b> column with the match

                     <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b> <b>=</b><b>=</b> <u>P</u> &amp;&amp;&amp;&amp; &amp;&amp;&amp;&amp; <b>(</b><b>(</b><b>a</b><b>r</b><b>p</b><b>.</b><b>o</b><b>p</b> <b>=</b><b>=</b> <b>1</b> &amp;&amp;&amp;&amp; <b>a</b><b>r</b><b>p</b><b>.</b><b>s</b><b>p</b><b>a</b> <b>=</b><b>=</b> <u>V</u><u>I</u><u>P</u> &amp;&amp;&amp;&amp; <b>a</b><b>r</b><b>p</b><b>.</b><b>t</b><b>p</b><b>a</b> <b>=</b><b>=</b> <u>V</u><u>I</u><u>P</u><b>)</b> <b>|</b><b>|</b> <b>(</b><b>a</b><b>r</b><b>p</b><b>.</b><b>o</b><b>p</b> <b>=</b><b>=</b> <b>2</b> &amp;&amp;&amp;&amp; <b>a</b><b>r</b><b>p</b><b>.</b><b>s</b><b>p</b><b>a</b> <b>=</b><b>=</b> <u>V</u><u>I</u><u>P</u><b>)</b><b>)</b>


                     and applies the action

                     <b>b</b><b>i</b><b>n</b><b>d</b><b>_</b><b>v</b><b>p</b><b>o</b><b>r</b><b>t</b><b>(</b><u>V</u><b>,</b> <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b><b>)</b><b>;</b>


                     and advances the packet to the next table.

                     Where <u>V</u><u>I</u><u>P</u> is the virtual  ip  configured  in  the  column
                     <b>o</b><b>p</b><b>t</b><b>i</b><b>o</b><b>n</b><b>s</b><b>:</b><b>v</b><b>i</b><b>r</b><b>t</b><b>u</b><b>a</b><b>l</b><b>-</b><b>i</b><b>p</b>.

              ·      Priority-50  flows  that match ARP requests to each known
                     IP address <u>A</u> of every logical switch  port,  and  respond
                     with  ARP  replies  directly  with corresponding Ethernet
                     address <u>E</u>:

                     <b>e</b><b>t</b><b>h</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b> <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b><b>;</b>
                     <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b> <b>=</b> <u>E</u>;
                     <b>a</b><b>r</b><b>p</b><b>.</b><b>o</b><b>p</b> <b>=</b> <b>2</b><b>;</b> <b>/</b><b>*</b> <b>A</b><b>R</b><b>P</b> <b>r</b><b>e</b><b>p</b><b>l</b><b>y</b><b>.</b> <b>*</b><b>/</b>
                     <b>a</b><b>r</b><b>p</b><b>.</b><b>t</b><b>h</b><b>a</b> <b>=</b> <b>a</b><b>r</b><b>p</b><b>.</b><b>s</b><b>h</b><b>a</b><b>;</b>
                     <b>a</b><b>r</b><b>p</b><b>.</b><b>s</b><b>h</b><b>a</b> <b>=</b> <u>E</u>;
                     <b>a</b><b>r</b><b>p</b><b>.</b><b>t</b><b>p</b><b>a</b> <b>=</b> <b>a</b><b>r</b><b>p</b><b>.</b><b>s</b><b>p</b><b>a</b><b>;</b>
                     <b>a</b><b>r</b><b>p</b><b>.</b><b>s</b><b>p</b><b>a</b> <b>=</b> <u>A</u>;
                     <b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b> <b>=</b> <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b><b>;</b>
                     <b>f</b><b>l</b><b>a</b><b>g</b><b>s</b><b>.</b><b>l</b><b>o</b><b>o</b><b>p</b><b>b</b><b>a</b><b>c</b><b>k</b> <b>=</b> <b>1</b><b>;</b>
                     <b>o</b><b>u</b><b>t</b><b>p</b><b>u</b><b>t</b><b>;</b>


                     These flows are omitted for  logical  ports  (other  than
                     router  ports  or  <b>l</b><b>o</b><b>c</b><b>a</b><b>l</b><b>p</b><b>o</b><b>r</b><b>t</b> ports) that are down (unless
                     <b>i</b><b>g</b><b>n</b><b>o</b><b>r</b><b>e</b><b>_</b><b>l</b><b>s</b><b>p</b><b>_</b><b>d</b><b>o</b><b>w</b><b>n</b> is configured as true in  <b>o</b><b>p</b><b>t</b><b>i</b><b>o</b><b>n</b><b>s</b>  column
                     of <b>N</b><b>B</b><b>_</b><b>G</b><b>l</b><b>o</b><b>b</b><b>a</b><b>l</b> table of the <b>N</b><b>o</b><b>r</b><b>t</b><b>h</b><b>b</b><b>o</b><b>u</b><b>n</b><b>d</b> database), for logi‐
                     cal  ports  of  type  <b>v</b><b>i</b><b>r</b><b>t</b><b>u</b><b>a</b><b>l</b>,  for  logical  ports  with
                     ’unknown’  address set and for logical ports of a logical
                     switch configured with <b>o</b><b>t</b><b>h</b><b>e</b><b>r</b><b>_</b><b>c</b><b>o</b><b>n</b><b>f</b><b>i</b><b>g</b><b>:</b><b>v</b><b>l</b><b>a</b><b>n</b><b>-</b><b>p</b><b>a</b><b>s</b><b>s</b><b>t</b><b>h</b><b>r</b><b>u</b><b>=</b><b>t</b><b>r</b><b>u</b><b>e</b>.

              ·      Priority-50 flows that match IPv6 ND  neighbor  solicita‐
                     tions  to each known IP address <u>A</u> (and <u>A</u>’s solicited node
                     address) of every logical  switch  port  except  of  type
                     router, and respond with neighbor advertisements directly
                     with corresponding Ethernet address <u>E</u>:

                     <b>n</b><b>d</b><b>_</b><b>n</b><b>a</b> <b>{</b>
                         <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b> <b>=</b> <u>E</u>;
                         <b>i</b><b>p</b><b>6</b><b>.</b><b>s</b><b>r</b><b>c</b> <b>=</b> <u>A</u>;
                         <b>n</b><b>d</b><b>.</b><b>t</b><b>a</b><b>r</b><b>g</b><b>e</b><b>t</b> <b>=</b> <u>A</u>;
                         <b>n</b><b>d</b><b>.</b><b>t</b><b>l</b><b>l</b> <b>=</b> <u>E</u>;
                         <b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b> <b>=</b> <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b><b>;</b>
                         <b>f</b><b>l</b><b>a</b><b>g</b><b>s</b><b>.</b><b>l</b><b>o</b><b>o</b><b>p</b><b>b</b><b>a</b><b>c</b><b>k</b> <b>=</b> <b>1</b><b>;</b>
                         <b>o</b><b>u</b><b>t</b><b>p</b><b>u</b><b>t</b><b>;</b>
                     <b>}</b><b>;</b>


                     Priority-50 flows that match IPv6 ND  neighbor  solicita‐
                     tions  to each known IP address <u>A</u> (and <u>A</u>’s solicited node
                     address) of logical  switch  port  of  type  router,  and
                     respond with neighbor advertisements directly with corre‐
                     sponding Ethernet address <u>E</u>:

                     <b>n</b><b>d</b><b>_</b><b>n</b><b>a</b><b>_</b><b>r</b><b>o</b><b>u</b><b>t</b><b>e</b><b>r</b> <b>{</b>
                         <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b> <b>=</b> <u>E</u>;
                         <b>i</b><b>p</b><b>6</b><b>.</b><b>s</b><b>r</b><b>c</b> <b>=</b> <u>A</u>;
                         <b>n</b><b>d</b><b>.</b><b>t</b><b>a</b><b>r</b><b>g</b><b>e</b><b>t</b> <b>=</b> <u>A</u>;
                         <b>n</b><b>d</b><b>.</b><b>t</b><b>l</b><b>l</b> <b>=</b> <u>E</u>;
                         <b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b> <b>=</b> <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b><b>;</b>
                         <b>f</b><b>l</b><b>a</b><b>g</b><b>s</b><b>.</b><b>l</b><b>o</b><b>o</b><b>p</b><b>b</b><b>a</b><b>c</b><b>k</b> <b>=</b> <b>1</b><b>;</b>
                         <b>o</b><b>u</b><b>t</b><b>p</b><b>u</b><b>t</b><b>;</b>
                     <b>}</b><b>;</b>


                     These flows are omitted for  logical  ports  (other  than
                     router  ports  or  <b>l</b><b>o</b><b>c</b><b>a</b><b>l</b><b>p</b><b>o</b><b>r</b><b>t</b> ports) that are down (unless
                     <b>i</b><b>g</b><b>n</b><b>o</b><b>r</b><b>e</b><b>_</b><b>l</b><b>s</b><b>p</b><b>_</b><b>d</b><b>o</b><b>w</b><b>n</b> is configured as true in  <b>o</b><b>p</b><b>t</b><b>i</b><b>o</b><b>n</b><b>s</b>  column
                     of <b>N</b><b>B</b><b>_</b><b>G</b><b>l</b><b>o</b><b>b</b><b>a</b><b>l</b> table of the <b>N</b><b>o</b><b>r</b><b>t</b><b>h</b><b>b</b><b>o</b><b>u</b><b>n</b><b>d</b> database), for logi‐
                     cal ports of type <b>v</b><b>i</b><b>r</b><b>t</b><b>u</b><b>a</b><b>l</b>  and  for  logical  ports  with
                     ’unknown’ address set.

              ·      Priority-100  flows  with match criteria like the ARP and
                     ND flows above, except that they only match packets  from
                     the  <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b>  that owns the IP addresses in question, with
                     action <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>. These flows prevent OVN from  replying  to,
                     for  example,  an ARP request emitted by a VM for its own
                     IP address. A VM only  makes  this  kind  of  request  to
                     attempt  to  detect a duplicate IP address assignment, so
                     sending a reply will prevent the VM from accepting the IP
                     address that it owns.

                     In  place  of  <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>, it would be reasonable to use <b>d</b><b>r</b><b>o</b><b>p</b><b>;</b>
                     for the flows’ actions. If everything is working as it is
                     configured,  then  this would produce equivalent results,
                     since no host should reply to the request. But ARPing for
                     one’s  own  IP  address  is intended to detect situations
                     where the network is not working as configured, so  drop‐
                     ping the request would frustrate that intent.

              ·      For  each  <u>S</u><u>V</u><u>C</u><b>_</b><u>M</u><u>O</u><u>N</u><b>_</b><u>S</u><u>R</u><u>C</u><b>_</b><u>I</u><u>P</u>  defined  in  the  value of the
                     <b>i</b><b>p</b><b>_</b><b>p</b><b>o</b><b>r</b><b>t</b><b>_</b><b>m</b><b>a</b><b>p</b><b>p</b><b>i</b><b>n</b><b>g</b><b>s</b><b>:</b><b>E</b><b>N</b><b>D</b><b>P</b><b>O</b><b>I</b><b>N</b><b>T</b><b>_</b><b>I</b><b>P</b> column of <b>L</b><b>o</b><b>a</b><b>d</b><b>_</b><b>B</b><b>a</b><b>l</b><b>a</b><b>n</b><b>c</b><b>e</b><b>r</b>  ta‐
                     ble,  priority-110  logical  flow is added with the match
                     <b>a</b><b>r</b><b>p</b><b>.</b><b>t</b><b>p</b><b>a</b> <b>=</b><b>=</b> <u>S</u><u>V</u><u>C</u><b>_</b><u>M</u><u>O</u><u>N</u><b>_</b><u>S</u><u>R</u><u>C</u><b>_</b><u>I</u><u>P</u> &amp;&amp;&amp;&amp; &amp;&amp;&amp;&amp; <b>a</b><b>r</b><b>p</b><b>.</b><b>o</b><b>p</b> <b>=</b><b>=</b> <b>1</b>  and  applies
                     the action

                     <b>e</b><b>t</b><b>h</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b> <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b><b>;</b>
                     <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b> <b>=</b> <u>E</u>;
                     <b>a</b><b>r</b><b>p</b><b>.</b><b>o</b><b>p</b> <b>=</b> <b>2</b><b>;</b> <b>/</b><b>*</b> <b>A</b><b>R</b><b>P</b> <b>r</b><b>e</b><b>p</b><b>l</b><b>y</b><b>.</b> <b>*</b><b>/</b>
                     <b>a</b><b>r</b><b>p</b><b>.</b><b>t</b><b>h</b><b>a</b> <b>=</b> <b>a</b><b>r</b><b>p</b><b>.</b><b>s</b><b>h</b><b>a</b><b>;</b>
                     <b>a</b><b>r</b><b>p</b><b>.</b><b>s</b><b>h</b><b>a</b> <b>=</b> <u>E</u>;
                     <b>a</b><b>r</b><b>p</b><b>.</b><b>t</b><b>p</b><b>a</b> <b>=</b> <b>a</b><b>r</b><b>p</b><b>.</b><b>s</b><b>p</b><b>a</b><b>;</b>
                     <b>a</b><b>r</b><b>p</b><b>.</b><b>s</b><b>p</b><b>a</b> <b>=</b> <u>A</u>;
                     <b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b> <b>=</b> <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b><b>;</b>
                     <b>f</b><b>l</b><b>a</b><b>g</b><b>s</b><b>.</b><b>l</b><b>o</b><b>o</b><b>p</b><b>b</b><b>a</b><b>c</b><b>k</b> <b>=</b> <b>1</b><b>;</b>
                     <b>o</b><b>u</b><b>t</b><b>p</b><b>u</b><b>t</b><b>;</b>


                     where  <u>E</u> is the service monitor source mac defined in the
                     <b>o</b><b>p</b><b>t</b><b>i</b><b>o</b><b>n</b><b>s</b><b>:</b><b>s</b><b>v</b><b>c</b><b>_</b><b>m</b><b>o</b><b>n</b><b>i</b><b>t</b><b>o</b><b>r</b><b>_</b><b>m</b><b>a</b><b>c</b> column in  the  <b>N</b><b>B</b><b>_</b><b>G</b><b>l</b><b>o</b><b>b</b><b>a</b><b>l</b>  table.
                     This mac is used as the source mac in the service monitor
                     packets for the load balancer endpoint IP health checks.

                     <u>S</u><u>V</u><u>C</u><b>_</b><u>M</u><u>O</u><u>N</u><b>_</b><u>S</u><u>R</u><u>C</u><b>_</b><u>I</u><u>P</u> is used as the source ip  in  the  service
                     monitor  IPv4  packets  for the load balancer endpoint IP
                     health checks.

                     These flows are required if an ARP request  is  sent  for
                     the IP <u>S</u><u>V</u><u>C</u><b>_</b><u>M</u><u>O</u><u>N</u><b>_</b><u>S</u><u>R</u><u>C</u><b>_</b><u>I</u><u>P</u>.

              ·      For  each  <u>V</u><u>I</u><u>P</u> configured in the table <b>F</b><b>o</b><b>r</b><b>w</b><b>a</b><b>r</b><b>d</b><b>i</b><b>n</b><b>g</b><b>_</b><b>G</b><b>r</b><b>o</b><b>u</b><b>p</b> a
                     priority-50 logical flow is added with the match  <b>a</b><b>r</b><b>p</b><b>.</b><b>t</b><b>p</b><b>a</b>
                     <b>=</b><b>=</b> <u>v</u><u>i</u><u>p</u> &amp;&amp;&amp;&amp; &amp;&amp;&amp;&amp; <b>a</b><b>r</b><b>p</b><b>.</b><b>o</b><b>p</b> <b>=</b><b>=</b> <b>1</b>
                      and applies the action

                     <b>e</b><b>t</b><b>h</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b> <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b><b>;</b>
                     <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b> <b>=</b> <u>E</u>;
                     <b>a</b><b>r</b><b>p</b><b>.</b><b>o</b><b>p</b> <b>=</b> <b>2</b><b>;</b> <b>/</b><b>*</b> <b>A</b><b>R</b><b>P</b> <b>r</b><b>e</b><b>p</b><b>l</b><b>y</b><b>.</b> <b>*</b><b>/</b>
                     <b>a</b><b>r</b><b>p</b><b>.</b><b>t</b><b>h</b><b>a</b> <b>=</b> <b>a</b><b>r</b><b>p</b><b>.</b><b>s</b><b>h</b><b>a</b><b>;</b>
                     <b>a</b><b>r</b><b>p</b><b>.</b><b>s</b><b>h</b><b>a</b> <b>=</b> <u>E</u>;
                     <b>a</b><b>r</b><b>p</b><b>.</b><b>t</b><b>p</b><b>a</b> <b>=</b> <b>a</b><b>r</b><b>p</b><b>.</b><b>s</b><b>p</b><b>a</b><b>;</b>
                     <b>a</b><b>r</b><b>p</b><b>.</b><b>s</b><b>p</b><b>a</b> <b>=</b> <u>A</u>;
                     <b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b> <b>=</b> <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b><b>;</b>
                     <b>f</b><b>l</b><b>a</b><b>g</b><b>s</b><b>.</b><b>l</b><b>o</b><b>o</b><b>p</b><b>b</b><b>a</b><b>c</b><b>k</b> <b>=</b> <b>1</b><b>;</b>
                     <b>o</b><b>u</b><b>t</b><b>p</b><b>u</b><b>t</b><b>;</b>


                     where  <u>E</u>  is  the  forwarding  group’s mac defined in the
                     <b>v</b><b>m</b><b>a</b><b>c</b>.

                     <u>A</u> is used as either the destination ip for load balancing
                     traffic  to child ports or as nexthop to hosts behind the
                     child ports.

                     These flows are required to respond to an ARP request  if
                     an ARP request is sent for the IP <u>v</u><u>i</u><u>p</u>.

              ·      One priority-0 fallback flow that matches all packets and
                     advances to the next table.

     <u>I</u><u>n</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>1</u><u>7</u><u>:</u> <u>D</u><u>H</u><u>C</u><u>P</u> <u>o</u><u>p</u><u>t</u><u>i</u><u>o</u><u>n</u> <u>p</u><u>r</u><u>o</u><u>c</u><u>e</u><u>s</u><u>s</u><u>i</u><u>n</u><u>g</u>

       This table adds the DHCPv4 options to a DHCPv4 packet from the  logical
       ports  configured  with  IPv4 address(es) and DHCPv4 options, and simi‐
       larly for DHCPv6 options. This table also adds flows  for  the  logical
       ports of type <b>e</b><b>x</b><b>t</b><b>e</b><b>r</b><b>n</b><b>a</b><b>l</b>.

              ·      A  priority-100  logical  flow is added for these logical
                     ports which matches the IPv4 packet with <b>u</b><b>d</b><b>p</b><b>.</b><b>s</b><b>r</b><b>c</b> = 68 and
                     <b>u</b><b>d</b><b>p</b><b>.</b><b>d</b><b>s</b><b>t</b>  =  67  and  applies the action <b>p</b><b>u</b><b>t</b><b>_</b><b>d</b><b>h</b><b>c</b><b>p</b><b>_</b><b>o</b><b>p</b><b>t</b><b>s</b> and
                     advances the packet to the next table.

                     <b>r</b><b>e</b><b>g</b><b>0</b><b>[</b><b>3</b><b>]</b> <b>=</b> <b>p</b><b>u</b><b>t</b><b>_</b><b>d</b><b>h</b><b>c</b><b>p</b><b>_</b><b>o</b><b>p</b><b>t</b><b>s</b><b>(</b><b>o</b><b>f</b><b>f</b><b>e</b><b>r</b><b>_</b><b>i</b><b>p</b> <b>=</b> <u>i</u><u>p</u>, <u>o</u><u>p</u><u>t</u><u>i</u><u>o</u><u>n</u><u>s</u>...);
                     <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>


                     For DHCPDISCOVER and  DHCPREQUEST,  this  transforms  the
                     packet  into  a DHCP reply, adds the DHCP offer IP <u>i</u><u>p</u> and
                     options to the packet, and stores  1  into  reg0[3].  For
                     other  kinds  of  packets, it just stores 0 into reg0[3].
                     Either way, it continues to the next table.

              ·      A priority-100 logical flow is added  for  these  logical
                     ports  which  matches  the IPv6 packet with <b>u</b><b>d</b><b>p</b><b>.</b><b>s</b><b>r</b><b>c</b> = 546
                     and <b>u</b><b>d</b><b>p</b><b>.</b><b>d</b><b>s</b><b>t</b> = 547 and applies the action  <b>p</b><b>u</b><b>t</b><b>_</b><b>d</b><b>h</b><b>c</b><b>p</b><b>v</b><b>6</b><b>_</b><b>o</b><b>p</b><b>t</b><b>s</b>
                     and advances the packet to the next table.

                     <b>r</b><b>e</b><b>g</b><b>0</b><b>[</b><b>3</b><b>]</b> <b>=</b> <b>p</b><b>u</b><b>t</b><b>_</b><b>d</b><b>h</b><b>c</b><b>p</b><b>v</b><b>6</b><b>_</b><b>o</b><b>p</b><b>t</b><b>s</b><b>(</b><b>i</b><b>a</b><b>_</b><b>a</b><b>d</b><b>d</b><b>r</b> <b>=</b> <u>i</u><u>p</u>, <u>o</u><u>p</u><u>t</u><u>i</u><u>o</u><u>n</u><u>s</u>...);
                     <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>


                     For  DHCPv6  Solicit/Request/Confirm packets, this trans‐
                     forms the packet into a DHCPv6 Advertise/Reply, adds  the
                     DHCPv6  offer IP <u>i</u><u>p</u> and options to the packet, and stores
                     1 into reg0[3]. For  other  kinds  of  packets,  it  just
                     stores  0  into  reg0[3]. Either way, it continues to the
                     next table.

              ·      A priority-0 flow that matches all packets to advances to
                     table 16.

     <u>I</u><u>n</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>1</u><u>8</u><u>:</u> <u>D</u><u>H</u><u>C</u><u>P</u> <u>r</u><u>e</u><u>s</u><u>p</u><u>o</u><u>n</u><u>s</u><u>e</u><u>s</u>

       This  table implements DHCP responder for the DHCP replies generated by
       the previous table.

              ·      A priority 100 logical flow  is  added  for  the  logical
                     ports  configured  with DHCPv4 options which matches IPv4
                     packets with <b>u</b><b>d</b><b>p</b><b>.</b><b>s</b><b>r</b><b>c</b> <b>=</b><b>=</b> <b>6</b><b>8</b> &amp;&amp;&amp;&amp; <b>u</b><b>d</b><b>p</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b><b>=</b> <b>6</b><b>7</b> &amp;&amp;&amp;&amp; <b>r</b><b>e</b><b>g</b><b>0</b><b>[</b><b>3</b><b>]</b> <b>=</b><b>=</b>
                     <b>1</b>  and  responds  back to the <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b> after applying these
                     actions. If <b>r</b><b>e</b><b>g</b><b>0</b><b>[</b><b>3</b><b>]</b> is set to 1, it means that the action
                     <b>p</b><b>u</b><b>t</b><b>_</b><b>d</b><b>h</b><b>c</b><b>p</b><b>_</b><b>o</b><b>p</b><b>t</b><b>s</b> was successful.

                     <b>e</b><b>t</b><b>h</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b> <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b><b>;</b>
                     <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b> <b>=</b> <u>E</u>;
                     <b>i</b><b>p</b><b>4</b><b>.</b><b>s</b><b>r</b><b>c</b> <b>=</b> <u>S</u>;
                     <b>u</b><b>d</b><b>p</b><b>.</b><b>s</b><b>r</b><b>c</b> <b>=</b> <b>6</b><b>7</b><b>;</b>
                     <b>u</b><b>d</b><b>p</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b> <b>6</b><b>8</b><b>;</b>
                     <b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b> <b>=</b> <u>P</u>;
                     <b>f</b><b>l</b><b>a</b><b>g</b><b>s</b><b>.</b><b>l</b><b>o</b><b>o</b><b>p</b><b>b</b><b>a</b><b>c</b><b>k</b> <b>=</b> <b>1</b><b>;</b>
                     <b>o</b><b>u</b><b>t</b><b>p</b><b>u</b><b>t</b><b>;</b>


                     where  <u>E</u>  is  the  server MAC address and <u>S</u> is the server
                     IPv4 address defined in the  DHCPv4  options.  Note  that
                     <b>i</b><b>p</b><b>4</b><b>.</b><b>d</b><b>s</b><b>t</b> field is handled by <b>p</b><b>u</b><b>t</b><b>_</b><b>d</b><b>h</b><b>c</b><b>p</b><b>_</b><b>o</b><b>p</b><b>t</b><b>s</b>.

                     (This  terminates  ingress  packet processing; the packet
                     does not go to the next ingress table.)

              ·      A priority 100 logical flow  is  added  for  the  logical
                     ports  configured  with DHCPv6 options which matches IPv6
                     packets with <b>u</b><b>d</b><b>p</b><b>.</b><b>s</b><b>r</b><b>c</b> <b>=</b><b>=</b> <b>5</b><b>4</b><b>6</b> &amp;&amp;&amp;&amp; <b>u</b><b>d</b><b>p</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b><b>=</b> <b>5</b><b>4</b><b>7</b> &amp;&amp;&amp;&amp;  <b>r</b><b>e</b><b>g</b><b>0</b><b>[</b><b>3</b><b>]</b>
                     <b>=</b><b>=</b> <b>1</b> and responds back to the <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b> after applying these
                     actions. If <b>r</b><b>e</b><b>g</b><b>0</b><b>[</b><b>3</b><b>]</b> is set to 1, it means that the action
                     <b>p</b><b>u</b><b>t</b><b>_</b><b>d</b><b>h</b><b>c</b><b>p</b><b>v</b><b>6</b><b>_</b><b>o</b><b>p</b><b>t</b><b>s</b> was successful.

                     <b>e</b><b>t</b><b>h</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b> <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b><b>;</b>
                     <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b> <b>=</b> <u>E</u>;
                     <b>i</b><b>p</b><b>6</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b> <u>A</u>;
                     <b>i</b><b>p</b><b>6</b><b>.</b><b>s</b><b>r</b><b>c</b> <b>=</b> <u>S</u>;
                     <b>u</b><b>d</b><b>p</b><b>.</b><b>s</b><b>r</b><b>c</b> <b>=</b> <b>5</b><b>4</b><b>7</b><b>;</b>
                     <b>u</b><b>d</b><b>p</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b> <b>5</b><b>4</b><b>6</b><b>;</b>
                     <b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b> <b>=</b> <u>P</u>;
                     <b>f</b><b>l</b><b>a</b><b>g</b><b>s</b><b>.</b><b>l</b><b>o</b><b>o</b><b>p</b><b>b</b><b>a</b><b>c</b><b>k</b> <b>=</b> <b>1</b><b>;</b>
                     <b>o</b><b>u</b><b>t</b><b>p</b><b>u</b><b>t</b><b>;</b>


                     where  <u>E</u>  is  the  server MAC address and <u>S</u> is the server
                     IPv6 LLA address generated from the <b>s</b><b>e</b><b>r</b><b>v</b><b>e</b><b>r</b><b>_</b><b>i</b><b>d</b> defined  in
                     the  DHCPv6  options and <u>A</u> is the IPv6 address defined in
                     the logical port’s addresses column.

                     (This terminates packet processing; the packet  does  not
                     go on the next ingress table.)

              ·      A priority-0 flow that matches all packets to advances to
                     table 17.

     <u>I</u><u>n</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>1</u><u>9</u> <u>D</u><u>N</u><u>S</u> <u>L</u><u>o</u><u>o</u><u>k</u><u>u</u><u>p</u>

       This table looks up and resolves the DNS  names  to  the  corresponding
       configured IP address(es).

              ·      A priority-100 logical flow for each logical switch data‐
                     path if it is configured with DNS records, which  matches
                     the  IPv4  and IPv6 packets with <b>u</b><b>d</b><b>p</b><b>.</b><b>d</b><b>s</b><b>t</b> = 53 and applies
                     the action <b>d</b><b>n</b><b>s</b><b>_</b><b>l</b><b>o</b><b>o</b><b>k</b><b>u</b><b>p</b> and advances the packet to the next
                     table.

                     <b>r</b><b>e</b><b>g</b><b>0</b><b>[</b><b>4</b><b>]</b> <b>=</b> <b>d</b><b>n</b><b>s</b><b>_</b><b>l</b><b>o</b><b>o</b><b>k</b><b>u</b><b>p</b><b>(</b><b>)</b><b>;</b> <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>


                     For  valid DNS packets, this transforms the packet into a
                     DNS reply if the DNS name can be resolved, and  stores  1
                     into reg0[4]. For failed DNS resolution or other kinds of
                     packets, it just stores 0 into reg0[4].  Either  way,  it
                     continues to the next table.

     <u>I</u><u>n</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>2</u><u>0</u> <u>D</u><u>N</u><u>S</u> <u>R</u><u>e</u><u>s</u><u>p</u><u>o</u><u>n</u><u>s</u><u>e</u><u>s</u>

       This  table  implements  DNS responder for the DNS replies generated by
       the previous table.

              ·      A priority-100 logical flow for each logical switch data‐
                     path  if it is configured with DNS records, which matches
                     the IPv4 and IPv6 packets with <b>u</b><b>d</b><b>p</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b> <b>5</b><b>3</b> &amp;&amp;&amp;&amp; <b>r</b><b>e</b><b>g</b><b>0</b><b>[</b><b>4</b><b>]</b> <b>=</b><b>=</b>
                     <b>1</b>  and  responds  back to the <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b> after applying these
                     actions. If <b>r</b><b>e</b><b>g</b><b>0</b><b>[</b><b>4</b><b>]</b> is set to 1, it means that the action
                     <b>d</b><b>n</b><b>s</b><b>_</b><b>l</b><b>o</b><b>o</b><b>k</b><b>u</b><b>p</b> was successful.

                     <b>e</b><b>t</b><b>h</b><b>.</b><b>d</b><b>s</b><b>t</b> <lt;<lt;<b>-</b>>gt;>gt; <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b><b>;</b>
                     <b>i</b><b>p</b><b>4</b><b>.</b><b>s</b><b>r</b><b>c</b> <lt;<lt;<b>-</b>>gt;>gt; <b>i</b><b>p</b><b>4</b><b>.</b><b>d</b><b>s</b><b>t</b><b>;</b>
                     <b>u</b><b>d</b><b>p</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b> <b>u</b><b>d</b><b>p</b><b>.</b><b>s</b><b>r</b><b>c</b><b>;</b>
                     <b>u</b><b>d</b><b>p</b><b>.</b><b>s</b><b>r</b><b>c</b> <b>=</b> <b>5</b><b>3</b><b>;</b>
                     <b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b> <b>=</b> <u>P</u>;
                     <b>f</b><b>l</b><b>a</b><b>g</b><b>s</b><b>.</b><b>l</b><b>o</b><b>o</b><b>p</b><b>b</b><b>a</b><b>c</b><b>k</b> <b>=</b> <b>1</b><b>;</b>
                     <b>o</b><b>u</b><b>t</b><b>p</b><b>u</b><b>t</b><b>;</b>


                     (This  terminates  ingress  packet processing; the packet
                     does not go to the next ingress table.)

     <u>I</u><u>n</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>t</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>2</u><u>1</u> <u>E</u><u>x</u><u>t</u><u>e</u><u>r</u><u>n</u><u>a</u><u>l</u> <u>p</u><u>o</u><u>r</u><u>t</u><u>s</u>

       Traffic from the <b>e</b><b>x</b><b>t</b><b>e</b><b>r</b><b>n</b><b>a</b><b>l</b> logical  ports  enter  the  ingress  datapath
       pipeline via the <b>l</b><b>o</b><b>c</b><b>a</b><b>l</b><b>n</b><b>e</b><b>t</b> port. This table adds the below logical flows
       to handle the traffic from these ports.

              ·      A priority-100 flow is added for  each  <b>e</b><b>x</b><b>t</b><b>e</b><b>r</b><b>n</b><b>a</b><b>l</b>  logical
                     port  which  doesn’t  reside  on  a  chassis  to drop the
                     ARP/IPv6 NS request to the router IP(s) (of  the  logical
                     switch) which matches on the <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b> of the <b>e</b><b>x</b><b>t</b><b>e</b><b>r</b><b>n</b><b>a</b><b>l</b> logi‐
                     cal port and the valid <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b> address(es) of the  <b>e</b><b>x</b><b>t</b><b>e</b><b>r</b><b>‐</b>
                     <b>n</b><b>a</b><b>l</b> logical port.

                     This  flow  guarantees  that  the  ARP/NS  request to the
                     router IP address from the external ports is responded by
                     only  the chassis which has claimed these external ports.
                     All the other chassis, drops these packets.

                     A priority-100 flow is added for  each  <b>e</b><b>x</b><b>t</b><b>e</b><b>r</b><b>n</b><b>a</b><b>l</b>  logical
                     port which doesn’t reside on a chassis to drop any packet
                     destined to the router mac - with  the  match  <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b>  <b>=</b><b>=</b>
                     <u>e</u><u>x</u><u>t</u><u>e</u><u>r</u><u>n</u><u>a</u><u>l</u>  &amp;&amp;&amp;&amp;  <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b>  <b>=</b><b>=</b>  <u>E</u> &amp;&amp;&amp;&amp; <b>e</b><b>t</b><b>h</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b><b>=</b> <u>R</u> &amp;&amp;&amp;&amp; <b>!</b><b>i</b><b>s</b><b>_</b><b>c</b><b>h</b><b>a</b><b>s</b><b>‐</b>
                     <b>s</b><b>i</b><b>s</b><b>_</b><b>r</b><b>e</b><b>s</b><b>i</b><b>d</b><b>e</b><b>n</b><b>t</b><b>(</b><b>"</b><u>e</u><u>x</u><u>t</u><u>e</u><u>r</u><u>n</u><u>a</u><u>l</u><b>"</b><b>)</b> where <u>E</u> is the external port mac
                     and <u>R</u> is the router port mac.

              ·      A priority-0 flow that matches all packets to advances to
                     table 20.

     <u>I</u><u>n</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>2</u><u>2</u> <u>D</u><u>e</u><u>s</u><u>t</u><u>i</u><u>n</u><u>a</u><u>t</u><u>i</u><u>o</u><u>n</u> <u>L</u><u>o</u><u>o</u><u>k</u><u>u</u><u>p</u>

       This table implements switching behavior.  It  contains  these  logical
       flows:

              ·      A  priority-110  flow with the match <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b> <b>=</b><b>=</b> <u>E</u> for all
                     logical switch datapaths  and  applies  the  action  <b>h</b><b>a</b><b>n</b><b>‐</b>
                     <b>d</b><b>l</b><b>e</b><b>_</b><b>s</b><b>v</b><b>c</b><b>_</b><b>c</b><b>h</b><b>e</b><b>c</b><b>k</b><b>(</b><b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b><b>)</b>. Where <u>E</u> is the service monitor mac
                     defined in the <b>o</b><b>p</b><b>t</b><b>i</b><b>o</b><b>n</b><b>s</b><b>:</b><b>s</b><b>v</b><b>c</b><b>_</b><b>m</b><b>o</b><b>n</b><b>i</b><b>t</b><b>o</b><b>r</b><b>_</b><b>m</b><b>a</b><b>c</b> colum of <b>N</b><b>B</b><b>_</b><b>G</b><b>l</b><b>o</b><b>b</b><b>a</b><b>l</b>
                     table.

              ·      A  priority-100  flow  that punts all IGMP/MLD packets to
                     <b>o</b><b>v</b><b>n</b><b>-</b><b>c</b><b>o</b><b>n</b><b>t</b><b>r</b><b>o</b><b>l</b><b>l</b><b>e</b><b>r</b> if multicast snooping is  enabled  on  the
                     logical switch. The flow also forwards the IGMP/MLD pack‐
                     ets  to  the  <b>M</b><b>C</b><b>_</b><b>M</b><b>R</b><b>O</b><b>U</b><b>T</b><b>E</b><b>R</b><b>_</b><b>S</b><b>T</b><b>A</b><b>T</b><b>I</b><b>C</b>  multicast  group,  which
                     <b>o</b><b>v</b><b>n</b><b>-</b><b>n</b><b>o</b><b>r</b><b>t</b><b>h</b><b>d</b> populates with all the logical ports that have
                     <b>o</b><b>p</b><b>t</b><b>i</b><b>o</b><b>n</b><b>s</b> <b>:</b><b>m</b><b>c</b><b>a</b><b>s</b><b>t</b><b>_</b><b>f</b><b>l</b><b>o</b><b>o</b><b>d</b><b>_</b><b>r</b><b>e</b><b>p</b><b>o</b><b>r</b><b>t</b><b>s</b><b>=</b><b>’</b><b>t</b><b>r</b><b>u</b><b>e</b><b>’</b>.

              ·      Priority-90 flows that forward  registered  IP  multicast
                     traffic  to  their  corresponding  multicast group, which
                     <b>o</b><b>v</b><b>n</b><b>-</b><b>n</b><b>o</b><b>r</b><b>t</b><b>h</b><b>d</b> creates based on  learnt  <b>I</b><b>G</b><b>M</b><b>P</b><b>_</b><b>G</b><b>r</b><b>o</b><b>u</b><b>p</b>  entries.
                     The  flows  also  forward packets to the <b>M</b><b>C</b><b>_</b><b>M</b><b>R</b><b>O</b><b>U</b><b>T</b><b>E</b><b>R</b><b>_</b><b>F</b><b>L</b><b>O</b><b>O</b><b>D</b>
                     multicast group, which <b>o</b><b>v</b><b>n</b><b>-</b><b>n</b><b>o</b><b>r</b><b>t</b><b>d</b><b>h</b> populates with all  the
                     logical  ports that are connected to logical routers with
                     <b>o</b><b>p</b><b>t</b><b>i</b><b>o</b><b>n</b><b>s</b>:mcast_relay=’true’.

              ·      A priority-85 flow that forwards all IP multicast traffic
                     destined  to  224.0.0.X  to the <b>M</b><b>C</b><b>_</b><b>F</b><b>L</b><b>O</b><b>O</b><b>D</b> multicast group,
                     which  <b>o</b><b>v</b><b>n</b><b>-</b><b>n</b><b>o</b><b>r</b><b>t</b><b>h</b><b>d</b>  populates  with  all  enabled  logical
                     ports.

              ·      A priority-85 flow that forwards all IP multicast traffic
                     destined to reserved multicast IPv6 addresses (RFC  4291,
                     2.7.1,  e.g.,  Solicited-Node  multicast) to the <b>M</b><b>C</b><b>_</b><b>F</b><b>L</b><b>O</b><b>O</b><b>D</b>
                     multicast group,  which  <b>o</b><b>v</b><b>n</b><b>-</b><b>n</b><b>o</b><b>r</b><b>t</b><b>h</b><b>d</b>  populates  with  all
                     enabled logical ports.

              ·      A priority-80 flow that forwards all unregistered IP mul‐
                     ticast traffic to the <b>M</b><b>C</b><b>_</b><b>S</b><b>T</b><b>A</b><b>T</b><b>I</b><b>C</b>  multicast  group,  which
                     <b>o</b><b>v</b><b>n</b><b>-</b><b>n</b><b>o</b><b>r</b><b>t</b><b>h</b><b>d</b> populates with all the logical ports that have
                     <b>o</b><b>p</b><b>t</b><b>i</b><b>o</b><b>n</b><b>s</b>  <b>:</b><b>m</b><b>c</b><b>a</b><b>s</b><b>t</b><b>_</b><b>f</b><b>l</b><b>o</b><b>o</b><b>d</b><b>=</b><b>’</b><b>t</b><b>r</b><b>u</b><b>e</b><b>’</b>.  The  flow  also   forwards
                     unregistered IP multicast traffic to the <b>M</b><b>C</b><b>_</b><b>M</b><b>R</b><b>O</b><b>U</b><b>T</b><b>E</b><b>R</b><b>_</b><b>F</b><b>L</b><b>O</b><b>O</b><b>D</b>
                     multicast group, which <b>o</b><b>v</b><b>n</b><b>-</b><b>n</b><b>o</b><b>r</b><b>t</b><b>h</b><b>d</b> populates with all  the
                     logical  ports  connected  to  logical  routers that have
                     <b>o</b><b>p</b><b>t</b><b>i</b><b>o</b><b>n</b><b>s</b> <b>:</b><b>m</b><b>c</b><b>a</b><b>s</b><b>t</b><b>_</b><b>r</b><b>e</b><b>l</b><b>a</b><b>y</b><b>=</b><b>’</b><b>t</b><b>r</b><b>u</b><b>e</b><b>’</b>.

              ·      A priority-80 flow that drops all unregistered IP  multi‐
                     cast  traffic  if  <b>o</b><b>t</b><b>h</b><b>e</b><b>r</b><b>_</b><b>c</b><b>o</b><b>n</b><b>f</b><b>i</b><b>g</b>  <b>:</b><b>m</b><b>c</b><b>a</b><b>s</b><b>t</b><b>_</b><b>s</b><b>n</b><b>o</b><b>o</b><b>p</b><b>=</b><b>’</b><b>t</b><b>r</b><b>u</b><b>e</b><b>’</b>  and
                     <b>o</b><b>t</b><b>h</b><b>e</b><b>r</b><b>_</b><b>c</b><b>o</b><b>n</b><b>f</b><b>i</b><b>g</b>  <b>:</b><b>m</b><b>c</b><b>a</b><b>s</b><b>t</b><b>_</b><b>f</b><b>l</b><b>o</b><b>o</b><b>d</b><b>_</b><b>u</b><b>n</b><b>r</b><b>e</b><b>g</b><b>i</b><b>s</b><b>t</b><b>e</b><b>r</b><b>e</b><b>d</b><b>=</b><b>’</b><b>f</b><b>a</b><b>l</b><b>s</b><b>e</b><b>’</b>  and  the
                     switch  is  not  connected  to  a logical router that has
                     <b>o</b><b>p</b><b>t</b><b>i</b><b>o</b><b>n</b><b>s</b> <b>:</b><b>m</b><b>c</b><b>a</b><b>s</b><b>t</b><b>_</b><b>r</b><b>e</b><b>l</b><b>a</b><b>y</b><b>=</b><b>’</b><b>t</b><b>r</b><b>u</b><b>e</b><b>’</b> and the switch  doesn’t  have
                     any logical port with <b>o</b><b>p</b><b>t</b><b>i</b><b>o</b><b>n</b><b>s</b> <b>:</b><b>m</b><b>c</b><b>a</b><b>s</b><b>t</b><b>_</b><b>f</b><b>l</b><b>o</b><b>o</b><b>d</b><b>=</b><b>’</b><b>t</b><b>r</b><b>u</b><b>e</b><b>’</b>.

              ·      Priority-80  flows  for  each  IP address/VIP/NAT address
                     owned by a router port connected  to  the  switch.  These
                     flows  match ARP requests and ND packets for the specific
                     IP addresses. Matched packets are forwarded only  to  the
                     router  that  owns  the IP address and to the <b>M</b><b>C</b><b>_</b><b>F</b><b>L</b><b>O</b><b>O</b><b>D</b><b>_</b><b>L</b><b>2</b>
                     multicast group which  contains  all  non-router  logical
                     ports.

              ·      Priority-75  flows  for  each port connected to a logical
                     router matching self originated ARP  request/ND  packets.
                     These  packets  are flooded to the <b>M</b><b>C</b><b>_</b><b>F</b><b>L</b><b>O</b><b>O</b><b>D</b><b>_</b><b>L</b><b>2</b> which con‐
                     tains all non-router logical ports.

              ·      A priority-70 flow that outputs all packets with an  Eth‐
                     ernet broadcast or multicast <b>e</b><b>t</b><b>h</b><b>.</b><b>d</b><b>s</b><b>t</b> to the <b>M</b><b>C</b><b>_</b><b>F</b><b>L</b><b>O</b><b>O</b><b>D</b> mul‐
                     ticast group.

              ·      One priority-50 flow that  matches  each  known  Ethernet
                     address  against  <b>e</b><b>t</b><b>h</b><b>.</b><b>d</b><b>s</b><b>t</b>  and  outputs the packet to the
                     single associated output port.

                     For the Ethernet address on a logical switch port of type
                     <b>r</b><b>o</b><b>u</b><b>t</b><b>e</b><b>r</b>,  when that logical switch port’s <b>a</b><b>d</b><b>d</b><b>r</b><b>e</b><b>s</b><b>s</b><b>e</b><b>s</b> column
                     is set to <b>r</b><b>o</b><b>u</b><b>t</b><b>e</b><b>r</b> and the connected  logical  router  port
                     has a gateway chassis:

                     ·      The  flow  for the connected logical router port’s
                            Ethernet address is only programmed on the gateway
                            chassis.

                     ·      If  the  logical router has rules specified in <b>n</b><b>a</b><b>t</b>
                            with <b>e</b><b>x</b><b>t</b><b>e</b><b>r</b><b>n</b><b>a</b><b>l</b><b>_</b><b>m</b><b>a</b><b>c</b>, then those addresses  are  also
                            used  to  populate the switch’s destination lookup
                            on the chassis where <b>l</b><b>o</b><b>g</b><b>i</b><b>c</b><b>a</b><b>l</b><b>_</b><b>p</b><b>o</b><b>r</b><b>t</b> is resident.

                     For the Ethernet address on a logical switch port of type
                     <b>r</b><b>o</b><b>u</b><b>t</b><b>e</b><b>r</b>,  when that logical switch port’s <b>a</b><b>d</b><b>d</b><b>r</b><b>e</b><b>s</b><b>s</b><b>e</b><b>s</b> column
                     is set to <b>r</b><b>o</b><b>u</b><b>t</b><b>e</b><b>r</b> and the connected  logical  router  port
                     specifies  a  <b>r</b><b>e</b><b>s</b><b>i</b><b>d</b><b>e</b><b>-</b><b>o</b><b>n</b><b>-</b><b>r</b><b>e</b><b>d</b><b>i</b><b>r</b><b>e</b><b>c</b><b>t</b><b>-</b><b>c</b><b>h</b><b>a</b><b>s</b><b>s</b><b>i</b><b>s</b>  and the logical
                     router to which the connected logical router port belongs
                     to has a distributed gateway LRP:

                     ·      The  flow  for the connected logical router port’s
                            Ethernet address is only programmed on the gateway
                            chassis.

                     For  each  forwarding  group  configured  on  the logical
                     switch datapath,  a  priority-50  flow  that  matches  on
                     <b>e</b><b>t</b><b>h</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b><b>=</b> <u>V</u><u>I</u><u>P</u>
                      with  an  action  of  <b>f</b><b>w</b><b>d</b><b>_</b><b>g</b><b>r</b><b>o</b><b>u</b><b>p</b><b>(</b><b>c</b><b>h</b><b>i</b><b>l</b><b>d</b><b>p</b><b>o</b><b>r</b><b>t</b><b>s</b><b>=</b><u>a</u><u>r</u><u>g</u><u>s</u> <b>)</b>, where
                     <u>a</u><u>r</u><u>g</u><u>s</u> contains comma separated logical switch child  ports
                     to  load  balance to. If <b>l</b><b>i</b><b>v</b><b>e</b><b>n</b><b>e</b><b>s</b><b>s</b> is enabled, then action
                     also includes  <b>l</b><b>i</b><b>v</b><b>e</b><b>n</b><b>e</b><b>s</b><b>s</b><b>=</b><b>t</b><b>r</b><b>u</b><b>e</b>.

              ·      One priority-0 fallback flow  that  matches  all  packets
                     with  the  action  <b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b> <b>=</b> <b>g</b><b>e</b><b>t</b><b>_</b><b>f</b><b>d</b><b>b</b><b>(</b><b>e</b><b>t</b><b>h</b><b>.</b><b>d</b><b>s</b><b>t</b><b>)</b><b>;</b> <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>. The
                     action <b>g</b><b>e</b><b>t</b><b>_</b><b>f</b><b>d</b><b>b</b> gets the port for the <b>e</b><b>t</b><b>h</b><b>.</b><b>d</b><b>s</b><b>t</b> in  the  MAC
                     learning  table  of the logical switch datapath. If there
                     is no entry for <b>e</b><b>t</b><b>h</b><b>.</b><b>d</b><b>s</b><b>t</b> in the MAC learning  table,  then
                     it stores <b>n</b><b>o</b><b>n</b><b>e</b> in the <b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b>.

     <u>I</u><u>n</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>2</u><u>4</u> <u>D</u><u>e</u><u>s</u><u>t</u><u>i</u><u>n</u><u>a</u><u>t</u><u>i</u><u>o</u><u>n</u> <u>u</u><u>n</u><u>k</u><u>n</u><u>o</u><u>w</u><u>n</u>

       This  table  handles the packets whose destination was not found or and
       looked up in the MAC learning table of the logical switch datapath.  It
       contains the following flows.

              ·      If  the  logical  switch has logical ports with ’unknown’
                     addresses set, then the below logical flow is added

                     ·      Priority 50 flow with the match  <b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b>  <b>=</b><b>=</b>  <b>n</b><b>o</b><b>n</b><b>e</b>
                            then  outputs  them  to  the  <b>M</b><b>C</b><b>_</b><b>U</b><b>N</b><b>K</b><b>N</b><b>O</b><b>W</b><b>N</b> multicast
                            group, which <b>o</b><b>v</b><b>n</b><b>-</b><b>n</b><b>o</b><b>r</b><b>t</b><b>h</b><b>d</b> populates with all enabled
                            logical  ports  that  accept  unknown  destination
                            packets. As a small optimization,  if  no  logical
                            ports    accept   unknown   destination   packets,
                            <b>o</b><b>v</b><b>n</b><b>-</b><b>n</b><b>o</b><b>r</b><b>t</b><b>h</b><b>d</b> omits this multicast group and  logical
                            flow.

                     If the logical switch has no logical ports with ’unknown’
                     address set, then the below logical flow is added

                     ·      Priority 50 flow with the match  <b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b>  <b>=</b><b>=</b>  <b>n</b><b>o</b><b>n</b><b>e</b>
                            and drops the packets.

              ·      One  priority-0  fallback flow that outputs the packet to
                     the egress stage with the  outport  learnt  from  <b>g</b><b>e</b><b>t</b><b>_</b><b>f</b><b>d</b><b>b</b>
                     action.

     <u>E</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>0</u><u>:</u> <u>P</u><u>r</u><u>e</u><u>-</u><u>L</u><u>B</u>

       This table is similar to ingress table <b>P</b><b>r</b><b>e</b><b>-</b><b>L</b><b>B</b>. It contains a priority-0
       flow that simply moves traffic to the next table. Moreover it  contains
       a priority-110 flow to move IPv6 Neighbor Discovery traffic to the next
       table. If any load balancing rules exist for  the  datapath,  a  prior‐
       ity-100  flow  is  added  with a match of <b>i</b><b>p</b> and action of <b>r</b><b>e</b><b>g</b><b>0</b><b>[</b><b>2</b><b>]</b> <b>=</b> <b>1</b><b>;</b>
       <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b> to act as a hint for table <b>P</b><b>r</b><b>e</b><b>-</b><b>s</b><b>t</b><b>a</b><b>t</b><b>e</b><b>f</b><b>u</b><b>l</b> to send IP packets to the
       connection  tracker  for  packet de-fragmentation and possibly DNAT the
       destination VIP to one of the selected  backend  for  already  commited
       load balanced traffic.

       This table also has a priority-110 flow with the match <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b> <b>=</b><b>=</b> <u>E</u> for
       all logical switch datapaths to move traffic to the next table. Where <u>E</u>
       is the service monitor mac defined in the <b>o</b><b>p</b><b>t</b><b>i</b><b>o</b><b>n</b><b>s</b><b>:</b><b>s</b><b>v</b><b>c</b><b>_</b><b>m</b><b>o</b><b>n</b><b>i</b><b>t</b><b>o</b><b>r</b><b>_</b><b>m</b><b>a</b><b>c</b> colum
       of <b>N</b><b>B</b><b>_</b><b>G</b><b>l</b><b>o</b><b>b</b><b>a</b><b>l</b> table.

     <u>E</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>1</u><u>:</u> <b>t</b><b>o</b><b>-</b><b>l</b><b>p</b><b>o</b><b>r</b><b>t</b> <u>P</u><u>r</u><u>e</u><u>-</u><u>A</u><u>C</u><u>L</u><u>s</u>

       This is similar to ingress table <b>P</b><b>r</b><b>e</b><b>-</b><b>A</b><b>C</b><b>L</b><b>s</b> except for <b>t</b><b>o</b><b>-</b><b>l</b><b>p</b><b>o</b><b>r</b><b>t</b> traffic.

       This table also has a priority-110 flow with the match <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b> <b>=</b><b>=</b> <u>E</u> for
       all logical switch datapaths to move traffic to the next table. Where <u>E</u>
       is the service monitor mac defined in the <b>o</b><b>p</b><b>t</b><b>i</b><b>o</b><b>n</b><b>s</b><b>:</b><b>s</b><b>v</b><b>c</b><b>_</b><b>m</b><b>o</b><b>n</b><b>i</b><b>t</b><b>o</b><b>r</b><b>_</b><b>m</b><b>a</b><b>c</b> colum
       of <b>N</b><b>B</b><b>_</b><b>G</b><b>l</b><b>o</b><b>b</b><b>a</b><b>l</b> table.

       This table also has a priority-110 flow with the match <b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b> <b>=</b><b>=</b> <u>I</u> for
       all logical switch datapaths to move traffic to the next table. Where <u>I</u>
       is  the  peer  of a logical router port. This flow is added to skip the
       connection tracking of packets which will be  entering  logical  router
       datapath from logical switch datapath for routing.

     <u>E</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>2</u><u>:</u> <u>P</u><u>r</u><u>e</u><u>-</u><u>s</u><u>t</u><u>a</u><u>t</u><u>e</u><u>f</u><u>u</u><u>l</u>

       This  is  similar  to  ingress  table <b>P</b><b>r</b><b>e</b><b>-</b><b>s</b><b>t</b><b>a</b><b>t</b><b>e</b><b>f</b><b>u</b><b>l</b>. This table adds the
       below 3 logical flows.

              ·      A Priority-120 flow that send the packets  to  connection
                     tracker  using  <b>c</b><b>t</b><b>_</b><b>l</b><b>b</b><b>;</b>  as the action so that the already
                     established traffic gets unDNATted from the backend IP to
                     the  load  balancer  VIP  based on a hint provided by the
                     previous tables with a match for <b>r</b><b>e</b><b>g</b><b>0</b><b>[</b><b>2</b><b>]</b>  <b>=</b><b>=</b>  <b>1</b>.  If  the
                     packet was not DNATted earlier, then <b>c</b><b>t</b><b>_</b><b>l</b><b>b</b> functions like
                     <b>c</b><b>t</b><b>_</b><b>n</b><b>e</b><b>x</b><b>t</b>.

              ·      A priority-100  flow  sends  the  packets  to  connection
                     tracker  based  on a hint provided by the previous tables
                     (with a match for <b>r</b><b>e</b><b>g</b><b>0</b><b>[</b><b>0</b><b>]</b> <b>=</b><b>=</b> <b>1</b>)  by  using  the  <b>c</b><b>t</b><b>_</b><b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>
                     action.

              ·      A  priority-0 flow that matches all packets to advance to
                     the next table.

     <u>E</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>3</u><u>:</u> <b>f</b><b>r</b><b>o</b><b>m</b><b>-</b><b>l</b><b>p</b><b>o</b><b>r</b><b>t</b> <u>A</u><u>C</u><u>L</u> <u>h</u><u>i</u><u>n</u><u>t</u><u>s</u>

       This is similar to ingress table <b>A</b><b>C</b><b>L</b> <b>h</b><b>i</b><b>n</b><b>t</b><b>s</b>.

     <u>E</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>4</u><u>:</u> <b>t</b><b>o</b><b>-</b><b>l</b><b>p</b><b>o</b><b>r</b><b>t</b> <u>A</u><u>C</u><u>L</u><u>s</u>

       This is similar to ingress table <b>A</b><b>C</b><b>L</b><b>s</b> except for <b>t</b><b>o</b><b>-</b><b>l</b><b>p</b><b>o</b><b>r</b><b>t</b> ACLs.

       In addition, the following flows are added.

              ·      A priority 34000 logical flow is added for  each  logical
                     port which has DHCPv4 options defined to allow the DHCPv4
                     reply packet and which  has  DHCPv6  options  defined  to
                     allow  the DHCPv6 reply packet from the <b>I</b><b>n</b><b>g</b><b>r</b><b>e</b><b>s</b><b>s</b> <b>T</b><b>a</b><b>b</b><b>l</b><b>e</b> <b>1</b><b>6</b><b>:</b>
                     <b>D</b><b>H</b><b>C</b><b>P</b> <b>r</b><b>e</b><b>s</b><b>p</b><b>o</b><b>n</b><b>s</b><b>e</b><b>s</b>.

              ·      A priority 34000 logical flow is added for  each  logical
                     switch  datapath  configured  with  DNS  records with the
                     match <b>u</b><b>d</b><b>p</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b> <b>5</b><b>3</b> to allow the DNS reply packet from the
                     <b>I</b><b>n</b><b>g</b><b>r</b><b>e</b><b>s</b><b>s</b> <b>T</b><b>a</b><b>b</b><b>l</b><b>e</b> <b>1</b><b>8</b><b>:</b> <b>D</b><b>N</b><b>S</b> <b>r</b><b>e</b><b>s</b><b>p</b><b>o</b><b>n</b><b>s</b><b>e</b><b>s</b>.

              ·      A  priority  34000 logical flow is added for each logical
                     switch datapath with the match <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b> <b>=</b> <u>E</u> to  allow  the
                     service  monitor  request  packet  generated  by <b>o</b><b>v</b><b>n</b><b>-</b><b>c</b><b>o</b><b>n</b><b>‐</b>
                     <b>t</b><b>r</b><b>o</b><b>l</b><b>l</b><b>e</b><b>r</b> with the action <b>n</b><b>e</b><b>x</b><b>t</b>, where <u>E</u> is the service mon‐
                     itor  mac defined in the <b>o</b><b>p</b><b>t</b><b>i</b><b>o</b><b>n</b><b>s</b><b>:</b><b>s</b><b>v</b><b>c</b><b>_</b><b>m</b><b>o</b><b>n</b><b>i</b><b>t</b><b>o</b><b>r</b><b>_</b><b>m</b><b>a</b><b>c</b> colum of
                     <b>N</b><b>B</b><b>_</b><b>G</b><b>l</b><b>o</b><b>b</b><b>a</b><b>l</b> table.

     <u>E</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>5</u><u>:</u> <b>t</b><b>o</b><b>-</b><b>l</b><b>p</b><b>o</b><b>r</b><b>t</b> <u>Q</u><u>o</u><u>S</u> <u>M</u><u>a</u><u>r</u><u>k</u><u>i</u><u>n</u><u>g</u>

       This is similar to ingress table  <b>Q</b><b>o</b><b>S</b>  <b>m</b><b>a</b><b>r</b><b>k</b><b>i</b><b>n</b><b>g</b>  except  they  apply  to
       <b>t</b><b>o</b><b>-</b><b>l</b><b>p</b><b>o</b><b>r</b><b>t</b> QoS rules.

     <u>E</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>6</u><u>:</u> <b>t</b><b>o</b><b>-</b><b>l</b><b>p</b><b>o</b><b>r</b><b>t</b> <u>Q</u><u>o</u><u>S</u> <u>M</u><u>e</u><u>t</u><u>e</u><u>r</u>

       This  is  similar  to  ingress  table  <b>Q</b><b>o</b><b>S</b>  <b>m</b><b>e</b><b>t</b><b>e</b><b>r</b>  except they apply to
       <b>t</b><b>o</b><b>-</b><b>l</b><b>p</b><b>o</b><b>r</b><b>t</b> QoS rules.

     <u>E</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>7</u><u>:</u> <u>S</u><u>t</u><u>a</u><u>t</u><u>e</u><u>f</u><u>u</u><u>l</u>

       This is similar to ingress table <b>S</b><b>t</b><b>a</b><b>t</b><b>e</b><b>f</b><b>u</b><b>l</b>  except  that  there  are  no
       rules added for load balancing new connections.

     <u>E</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>8</u><u>:</u> <u>E</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>P</u><u>o</u><u>r</u><u>t</u> <u>S</u><u>e</u><u>c</u><u>u</u><u>r</u><u>i</u><u>t</u><u>y</u> <u>-</u> <u>I</u><u>P</u>

       This  is similar to the port security logic in table <b>I</b><b>n</b><b>g</b><b>r</b><b>e</b><b>s</b><b>s</b> <b>P</b><b>o</b><b>r</b><b>t</b> <b>S</b><b>e</b><b>c</b><b>u</b><b>‐</b>
       <b>r</b><b>i</b><b>t</b><b>y</b> <b>-</b> <b>I</b><b>P</b> except that <b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b>, <b>e</b><b>t</b><b>h</b><b>.</b><b>d</b><b>s</b><b>t</b>, <b>i</b><b>p</b><b>4</b><b>.</b><b>d</b><b>s</b><b>t</b> and <b>i</b><b>p</b><b>6</b><b>.</b><b>d</b><b>s</b><b>t</b> are checked
       instead of <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b>, <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b>, <b>i</b><b>p</b><b>4</b><b>.</b><b>s</b><b>r</b><b>c</b> and <b>i</b><b>p</b><b>6</b><b>.</b><b>s</b><b>r</b><b>c</b>

     <u>E</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>9</u><u>:</u> <u>E</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>P</u><u>o</u><u>r</u><u>t</u> <u>S</u><u>e</u><u>c</u><u>u</u><u>r</u><u>i</u><u>t</u><u>y</u> <u>-</u> <u>L</u><u>2</u>

       This  is  similar  to  the ingress port security logic in ingress table
       <b>A</b><b>d</b><b>m</b><b>i</b><b>s</b><b>s</b><b>i</b><b>o</b><b>n</b> <b>C</b><b>o</b><b>n</b><b>t</b><b>r</b><b>o</b><b>l</b> <b>a</b><b>n</b><b>d</b> <b>I</b><b>n</b><b>g</b><b>r</b><b>e</b><b>s</b><b>s</b> <b>P</b><b>o</b><b>r</b><b>t</b> <b>S</b><b>e</b><b>c</b><b>u</b><b>r</b><b>i</b><b>t</b><b>y</b> <b>-</b> <b>L</b><b>2</b>,  but  with  important
       differences. Most obviously, <b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b> and <b>e</b><b>t</b><b>h</b><b>.</b><b>d</b><b>s</b><b>t</b> are checked instead of
       <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b> and <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b>. Second, packets directed to broadcast or  multicast
       <b>e</b><b>t</b><b>h</b><b>.</b><b>d</b><b>s</b><b>t</b>  are always accepted instead of being subject to the port secu‐
       rity rules; this  is  implemented  through  a  priority-100  flow  that
       matches on <b>e</b><b>t</b><b>h</b><b>.</b><b>m</b><b>c</b><b>a</b><b>s</b><b>t</b> with action <b>o</b><b>u</b><b>t</b><b>p</b><b>u</b><b>t</b><b>;</b>. Moreover, to ensure that even
       broadcast and multicast packets are not delivered to  disabled  logical
       ports,  a priority-150 flow for each disabled logical <b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b> overrides
       the priority-100 flow with a <b>d</b><b>r</b><b>o</b><b>p</b><b>;</b> action. Finally if  egress  qos  has
       been  enabled  on a localnet port, the outgoing queue id is set through
       <b>s</b><b>e</b><b>t</b><b>_</b><b>q</b><b>u</b><b>e</b><b>u</b><b>e</b> action. Please remember to mark  the  corresponding  physical
       interface with <b>o</b><b>v</b><b>n</b><b>-</b><b>e</b><b>g</b><b>r</b><b>e</b><b>s</b><b>s</b><b>-</b><b>i</b><b>f</b><b>a</b><b>c</b><b>e</b> set to true in <b>e</b><b>x</b><b>t</b><b>e</b><b>r</b><b>n</b><b>a</b><b>l</b><b>_</b><b>i</b><b>d</b><b>s</b>

   <b>L</b><b>o</b><b>g</b><b>i</b><b>c</b><b>a</b><b>l</b> <b>R</b><b>o</b><b>u</b><b>t</b><b>e</b><b>r</b> <b>D</b><b>a</b><b>t</b><b>a</b><b>p</b><b>a</b><b>t</b><b>h</b><b>s</b>
       Logical router datapaths will only exist for <b>L</b><b>o</b><b>g</b><b>i</b><b>c</b><b>a</b><b>l</b><b>_</b><b>R</b><b>o</b><b>u</b><b>t</b><b>e</b><b>r</b> rows in the
       <b>O</b><b>V</b><b>N</b><b>_</b><b>N</b><b>o</b><b>r</b><b>t</b><b>h</b><b>b</b><b>o</b><b>u</b><b>n</b><b>d</b> database that do not have <b>e</b><b>n</b><b>a</b><b>b</b><b>l</b><b>e</b><b>d</b> set to <b>f</b><b>a</b><b>l</b><b>s</b><b>e</b>

     <u>I</u><u>n</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>0</u><u>:</u> <u>L</u><u>2</u> <u>A</u><u>d</u><u>m</u><u>i</u><u>s</u><u>s</u><u>i</u><u>o</u><u>n</u> <u>C</u><u>o</u><u>n</u><u>t</u><u>r</u><u>o</u><u>l</u>

       This table drops packets that the router shouldn’t see at all based  on
       their Ethernet headers. It contains the following flows:

              ·      Priority-100 flows to drop packets with VLAN tags or mul‐
                     ticast Ethernet source addresses.

              ·      For each enabled router port <u>P</u> with Ethernet address <u>E</u>, a
                     priority-50  flow  that matches <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b> <b>=</b><b>=</b> <u>P</u> &amp;&amp;&amp;&amp; <b>(</b><b>e</b><b>t</b><b>h</b><b>.</b><b>m</b><b>c</b><b>a</b><b>s</b><b>t</b>
                     <b>|</b><b>|</b> <b>e</b><b>t</b><b>h</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b><b>=</b> <u>E</u>), stores the router port ethernet address
                     and  advances  to next table, with action <b>x</b><b>r</b><b>e</b><b>g</b><b>0</b><b>[</b><b>0</b><b>.</b><b>.</b><b>4</b><b>7</b><b>]</b><b>=</b><b>E</b><b>;</b>
                     <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>.

                     For the gateway port  on  a  distributed  logical  router
                     (where  one of the logical router ports specifies a gate‐
                     way chassis), the above flow matching  <b>e</b><b>t</b><b>h</b><b>.</b><b>d</b><b>s</b><b>t</b>  <b>=</b><b>=</b>  <u>E</u>  is
                     only programmed on the gateway port instance on the gate‐
                     way chassis.

              ·      For each <b>d</b><b>n</b><b>a</b><b>t</b><b>_</b><b>a</b><b>n</b><b>d</b><b>_</b><b>s</b><b>n</b><b>a</b><b>t</b> NAT rule on a  distributed  router
                     that  specifies  an external Ethernet address <u>E</u>, a prior‐
                     ity-50 flow that matches <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b> <b>=</b><b>=</b> <u>G</u><u>W</u> &amp;&amp;&amp;&amp;  <b>e</b><b>t</b><b>h</b><b>.</b><b>d</b><b>s</b><b>t</b>  <b>=</b><b>=</b>  <u>E</u>,
                     where  <u>G</u><u>W</u> is the logical router gateway port, with action
                     <b>x</b><b>r</b><b>e</b><b>g</b><b>0</b><b>[</b><b>0</b><b>.</b><b>.</b><b>4</b><b>7</b><b>]</b><b>=</b><b>E</b><b>;</b> <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>.

                     This flow is only programmed on the gateway port instance
                     on  the  chassis  where the <b>l</b><b>o</b><b>g</b><b>i</b><b>c</b><b>a</b><b>l</b><b>_</b><b>p</b><b>o</b><b>r</b><b>t</b> specified in the
                     NAT rule resides.

       Other packets are implicitly dropped.

     <u>I</u><u>n</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>1</u><u>:</u> <u>N</u><u>e</u><u>i</u><u>g</u><u>h</u><u>b</u><u>o</u><u>r</u> <u>l</u><u>o</u><u>o</u><u>k</u><u>u</u><u>p</u>

       For ARP and IPv6 Neighbor Discovery packets, this table looks into  the
       <b>M</b><b>A</b><b>C</b><b>_</b><b>B</b><b>i</b><b>n</b><b>d</b><b>i</b><b>n</b><b>g</b>  records  to  determine if OVN needs to learn the mac bind‐
       ings. Following flows are added:

              ·      For each router port <u>P</u> that  owns  IP  address  <u>A</u>,  which
                     belongs  to  subnet <u>S</u> with prefix length <u>L</u>, if the option
                     <b>a</b><b>l</b><b>w</b><b>a</b><b>y</b><b>s</b><b>_</b><b>l</b><b>e</b><b>a</b><b>r</b><b>n</b><b>_</b><b>f</b><b>r</b><b>o</b><b>m</b><b>_</b><b>a</b><b>r</b><b>p</b><b>_</b><b>r</b><b>e</b><b>q</b><b>u</b><b>e</b><b>s</b><b>t</b> is <b>t</b><b>r</b><b>u</b><b>e</b> for this router,  a
                     priority-100  flow  is added which matches <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b> <b>=</b><b>=</b> <u>P</u> &amp;&amp;&amp;&amp;
                     <b>a</b><b>r</b><b>p</b><b>.</b><b>s</b><b>p</b><b>a</b> <b>=</b><b>=</b> <u>S</u><b>/</b><u>L</u> &amp;&amp;&amp;&amp; <b>a</b><b>r</b><b>p</b><b>.</b><b>o</b><b>p</b> <b>=</b><b>=</b> <b>1</b> (ARP request) with the fol‐
                     lowing actions:

                     <b>r</b><b>e</b><b>g</b><b>9</b><b>[</b><b>2</b><b>]</b> <b>=</b> <b>l</b><b>o</b><b>o</b><b>k</b><b>u</b><b>p</b><b>_</b><b>a</b><b>r</b><b>p</b><b>(</b><b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b><b>,</b> <b>a</b><b>r</b><b>p</b><b>.</b><b>s</b><b>p</b><b>a</b><b>,</b> <b>a</b><b>r</b><b>p</b><b>.</b><b>s</b><b>h</b><b>a</b><b>)</b><b>;</b>
                     <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>


                     If the option <b>a</b><b>l</b><b>w</b><b>a</b><b>y</b><b>s</b><b>_</b><b>l</b><b>e</b><b>a</b><b>r</b><b>n</b><b>_</b><b>f</b><b>r</b><b>o</b><b>m</b><b>_</b><b>a</b><b>r</b><b>p</b><b>_</b><b>r</b><b>e</b><b>q</b><b>u</b><b>e</b><b>s</b><b>t</b> is <b>f</b><b>a</b><b>l</b><b>s</b><b>e</b>, the
                     following two flows are added.

                     A priority-110 flow is added which matches <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b> <b>=</b><b>=</b> <u>P</u> &amp;&amp;&amp;&amp;
                     <b>a</b><b>r</b><b>p</b><b>.</b><b>s</b><b>p</b><b>a</b>  <b>=</b><b>=</b>  <u>S</u><b>/</b><u>L</u>  &amp;&amp;&amp;&amp;  <b>a</b><b>r</b><b>p</b><b>.</b><b>t</b><b>p</b><b>a</b>  <b>=</b><b>=</b>  <u>A</u>  &amp;&amp;&amp;&amp; <b>a</b><b>r</b><b>p</b><b>.</b><b>o</b><b>p</b> <b>=</b><b>=</b> <b>1</b> (ARP
                     request) with the following actions:

                     <b>r</b><b>e</b><b>g</b><b>9</b><b>[</b><b>2</b><b>]</b> <b>=</b> <b>l</b><b>o</b><b>o</b><b>k</b><b>u</b><b>p</b><b>_</b><b>a</b><b>r</b><b>p</b><b>(</b><b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b><b>,</b> <b>a</b><b>r</b><b>p</b><b>.</b><b>s</b><b>p</b><b>a</b><b>,</b> <b>a</b><b>r</b><b>p</b><b>.</b><b>s</b><b>h</b><b>a</b><b>)</b><b>;</b>
                     <b>r</b><b>e</b><b>g</b><b>9</b><b>[</b><b>3</b><b>]</b> <b>=</b> <b>1</b><b>;</b>
                     <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>


                     A priority-100 flow is added which matches <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b> <b>=</b><b>=</b> <u>P</u> &amp;&amp;&amp;&amp;
                     <b>a</b><b>r</b><b>p</b><b>.</b><b>s</b><b>p</b><b>a</b> <b>=</b><b>=</b> <u>S</u><b>/</b><u>L</u> &amp;&amp;&amp;&amp; <b>a</b><b>r</b><b>p</b><b>.</b><b>o</b><b>p</b> <b>=</b><b>=</b> <b>1</b> (ARP request) with the fol‐
                     lowing actions:

                     <b>r</b><b>e</b><b>g</b><b>9</b><b>[</b><b>2</b><b>]</b> <b>=</b> <b>l</b><b>o</b><b>o</b><b>k</b><b>u</b><b>p</b><b>_</b><b>a</b><b>r</b><b>p</b><b>(</b><b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b><b>,</b> <b>a</b><b>r</b><b>p</b><b>.</b><b>s</b><b>p</b><b>a</b><b>,</b> <b>a</b><b>r</b><b>p</b><b>.</b><b>s</b><b>h</b><b>a</b><b>)</b><b>;</b>
                     <b>r</b><b>e</b><b>g</b><b>9</b><b>[</b><b>3</b><b>]</b> <b>=</b> <b>l</b><b>o</b><b>o</b><b>k</b><b>u</b><b>p</b><b>_</b><b>a</b><b>r</b><b>p</b><b>_</b><b>i</b><b>p</b><b>(</b><b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b><b>,</b> <b>a</b><b>r</b><b>p</b><b>.</b><b>s</b><b>p</b><b>a</b><b>)</b><b>;</b>
                     <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>


                     If the logical router port <u>P</u>  is  a  distributed  gateway
                     router  port,  additional match <b>i</b><b>s</b><b>_</b><b>c</b><b>h</b><b>a</b><b>s</b><b>s</b><b>i</b><b>s</b><b>_</b><b>r</b><b>e</b><b>s</b><b>i</b><b>d</b><b>e</b><b>n</b><b>t</b><b>(</b><b>c</b><b>r</b><b>-</b><u>P</u><b>)</b>
                     is added for all these flows.

              ·      A priority-100 flow which matches on  ARP  reply  packets
                     and     applies     the    actions    if    the    option
                     <b>a</b><b>l</b><b>w</b><b>a</b><b>y</b><b>s</b><b>_</b><b>l</b><b>e</b><b>a</b><b>r</b><b>n</b><b>_</b><b>f</b><b>r</b><b>o</b><b>m</b><b>_</b><b>a</b><b>r</b><b>p</b><b>_</b><b>r</b><b>e</b><b>q</b><b>u</b><b>e</b><b>s</b><b>t</b> is <b>t</b><b>r</b><b>u</b><b>e</b>:

                     <b>r</b><b>e</b><b>g</b><b>9</b><b>[</b><b>2</b><b>]</b> <b>=</b> <b>l</b><b>o</b><b>o</b><b>k</b><b>u</b><b>p</b><b>_</b><b>a</b><b>r</b><b>p</b><b>(</b><b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b><b>,</b> <b>a</b><b>r</b><b>p</b><b>.</b><b>s</b><b>p</b><b>a</b><b>,</b> <b>a</b><b>r</b><b>p</b><b>.</b><b>s</b><b>h</b><b>a</b><b>)</b><b>;</b>
                     <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>


                     If the option <b>a</b><b>l</b><b>w</b><b>a</b><b>y</b><b>s</b><b>_</b><b>l</b><b>e</b><b>a</b><b>r</b><b>n</b><b>_</b><b>f</b><b>r</b><b>o</b><b>m</b><b>_</b><b>a</b><b>r</b><b>p</b><b>_</b><b>r</b><b>e</b><b>q</b><b>u</b><b>e</b><b>s</b><b>t</b> is <b>f</b><b>a</b><b>l</b><b>s</b><b>e</b>, the
                     above actions will be:

                     <b>r</b><b>e</b><b>g</b><b>9</b><b>[</b><b>2</b><b>]</b> <b>=</b> <b>l</b><b>o</b><b>o</b><b>k</b><b>u</b><b>p</b><b>_</b><b>a</b><b>r</b><b>p</b><b>(</b><b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b><b>,</b> <b>a</b><b>r</b><b>p</b><b>.</b><b>s</b><b>p</b><b>a</b><b>,</b> <b>a</b><b>r</b><b>p</b><b>.</b><b>s</b><b>h</b><b>a</b><b>)</b><b>;</b>
                     <b>r</b><b>e</b><b>g</b><b>9</b><b>[</b><b>3</b><b>]</b> <b>=</b> <b>1</b><b>;</b>
                     <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>


              ·      A  priority-100  flow which matches on IPv6 Neighbor Dis‐
                     covery advertisement packet and applies  the  actions  if
                     the option <b>a</b><b>l</b><b>w</b><b>a</b><b>y</b><b>s</b><b>_</b><b>l</b><b>e</b><b>a</b><b>r</b><b>n</b><b>_</b><b>f</b><b>r</b><b>o</b><b>m</b><b>_</b><b>a</b><b>r</b><b>p</b><b>_</b><b>r</b><b>e</b><b>q</b><b>u</b><b>e</b><b>s</b><b>t</b> is <b>t</b><b>r</b><b>u</b><b>e</b>:

                     <b>r</b><b>e</b><b>g</b><b>9</b><b>[</b><b>2</b><b>]</b> <b>=</b> <b>l</b><b>o</b><b>o</b><b>k</b><b>u</b><b>p</b><b>_</b><b>n</b><b>d</b><b>(</b><b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b><b>,</b> <b>n</b><b>d</b><b>.</b><b>t</b><b>a</b><b>r</b><b>g</b><b>e</b><b>t</b><b>,</b> <b>n</b><b>d</b><b>.</b><b>t</b><b>l</b><b>l</b><b>)</b><b>;</b>
                     <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>


                     If the option <b>a</b><b>l</b><b>w</b><b>a</b><b>y</b><b>s</b><b>_</b><b>l</b><b>e</b><b>a</b><b>r</b><b>n</b><b>_</b><b>f</b><b>r</b><b>o</b><b>m</b><b>_</b><b>a</b><b>r</b><b>p</b><b>_</b><b>r</b><b>e</b><b>q</b><b>u</b><b>e</b><b>s</b><b>t</b> is <b>f</b><b>a</b><b>l</b><b>s</b><b>e</b>, the
                     above actions will be:

                     <b>r</b><b>e</b><b>g</b><b>9</b><b>[</b><b>2</b><b>]</b> <b>=</b> <b>l</b><b>o</b><b>o</b><b>k</b><b>u</b><b>p</b><b>_</b><b>n</b><b>d</b><b>(</b><b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b><b>,</b> <b>n</b><b>d</b><b>.</b><b>t</b><b>a</b><b>r</b><b>g</b><b>e</b><b>t</b><b>,</b> <b>n</b><b>d</b><b>.</b><b>t</b><b>l</b><b>l</b><b>)</b><b>;</b>
                     <b>r</b><b>e</b><b>g</b><b>9</b><b>[</b><b>3</b><b>]</b> <b>=</b> <b>1</b><b>;</b>
                     <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>


              ·      A priority-100 flow which matches on IPv6  Neighbor  Dis‐
                     covery solicitation packet and applies the actions if the
                     option <b>a</b><b>l</b><b>w</b><b>a</b><b>y</b><b>s</b><b>_</b><b>l</b><b>e</b><b>a</b><b>r</b><b>n</b><b>_</b><b>f</b><b>r</b><b>o</b><b>m</b><b>_</b><b>a</b><b>r</b><b>p</b><b>_</b><b>r</b><b>e</b><b>q</b><b>u</b><b>e</b><b>s</b><b>t</b> is <b>t</b><b>r</b><b>u</b><b>e</b>:

                     <b>r</b><b>e</b><b>g</b><b>9</b><b>[</b><b>2</b><b>]</b> <b>=</b> <b>l</b><b>o</b><b>o</b><b>k</b><b>u</b><b>p</b><b>_</b><b>n</b><b>d</b><b>(</b><b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b><b>,</b> <b>i</b><b>p</b><b>6</b><b>.</b><b>s</b><b>r</b><b>c</b><b>,</b> <b>n</b><b>d</b><b>.</b><b>s</b><b>l</b><b>l</b><b>)</b><b>;</b>
                     <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>


                     If the option <b>a</b><b>l</b><b>w</b><b>a</b><b>y</b><b>s</b><b>_</b><b>l</b><b>e</b><b>a</b><b>r</b><b>n</b><b>_</b><b>f</b><b>r</b><b>o</b><b>m</b><b>_</b><b>a</b><b>r</b><b>p</b><b>_</b><b>r</b><b>e</b><b>q</b><b>u</b><b>e</b><b>s</b><b>t</b> is <b>f</b><b>a</b><b>l</b><b>s</b><b>e</b>, the
                     above actions will be:

                     <b>r</b><b>e</b><b>g</b><b>9</b><b>[</b><b>2</b><b>]</b> <b>=</b> <b>l</b><b>o</b><b>o</b><b>k</b><b>u</b><b>p</b><b>_</b><b>n</b><b>d</b><b>(</b><b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b><b>,</b> <b>i</b><b>p</b><b>6</b><b>.</b><b>s</b><b>r</b><b>c</b><b>,</b> <b>n</b><b>d</b><b>.</b><b>s</b><b>l</b><b>l</b><b>)</b><b>;</b>
                     <b>r</b><b>e</b><b>g</b><b>9</b><b>[</b><b>3</b><b>]</b> <b>=</b> <b>l</b><b>o</b><b>o</b><b>k</b><b>u</b><b>p</b><b>_</b><b>n</b><b>d</b><b>_</b><b>i</b><b>p</b><b>(</b><b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b><b>,</b> <b>i</b><b>p</b><b>6</b><b>.</b><b>s</b><b>r</b><b>c</b><b>)</b><b>;</b>
                     <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>


              ·      A  priority-0  fallback flow that matches all packets and
                     applies the action  <b>r</b><b>e</b><b>g</b><b>9</b><b>[</b><b>2</b><b>]</b>  <b>=</b>  <b>1</b><b>;</b>  <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>  advancing  the
                     packet to the next table.

     <u>I</u><u>n</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>2</u><u>:</u> <u>N</u><u>e</u><u>i</u><u>g</u><u>h</u><u>b</u><u>o</u><u>r</u> <u>l</u><u>e</u><u>a</u><u>r</u><u>n</u><u>i</u><u>n</u><u>g</u>

       This  table  adds flows to learn the mac bindings from the ARP and IPv6
       Neighbor Solicitation/Advertisement packets if it is  needed  according
       to the lookup results from the previous stage.

       reg9[2] will be <b>1</b> if the <b>l</b><b>o</b><b>o</b><b>k</b><b>u</b><b>p</b><b>_</b><b>a</b><b>r</b><b>p</b><b>/</b><b>l</b><b>o</b><b>o</b><b>k</b><b>u</b><b>p</b><b>_</b><b>n</b><b>d</b> in the previous table was
       successful or skipped, meaning no need to learn mac  binding  from  the
       packet.

       reg9[3] will be <b>1</b> if the <b>l</b><b>o</b><b>o</b><b>k</b><b>u</b><b>p</b><b>_</b><b>a</b><b>r</b><b>p</b><b>_</b><b>i</b><b>p</b><b>/</b><b>l</b><b>o</b><b>o</b><b>k</b><b>u</b><b>p</b><b>_</b><b>n</b><b>d</b><b>_</b><b>i</b><b>p</b> in the previous ta‐
       ble was successful or skipped, meaning it is ok to  learn  mac  binding
       from the packet (if reg9[2] is 0).

              ·      A  priority-100  flow  with  the  match  <b>r</b><b>e</b><b>g</b><b>9</b><b>[</b><b>2</b><b>]</b>  <b>=</b><b>=</b> <b>1</b> <b>|</b><b>|</b>
                     <b>r</b><b>e</b><b>g</b><b>9</b><b>[</b><b>3</b><b>]</b> <b>=</b><b>=</b> <b>0</b> and advances the packet to the next table as
                     there is no need to learn the neighbor.

              ·      A  priority-90  flow  with  the match <b>a</b><b>r</b><b>p</b> and applies the
                     action <b>p</b><b>u</b><b>t</b><b>_</b><b>a</b><b>r</b><b>p</b><b>(</b><b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b><b>,</b> <b>a</b><b>r</b><b>p</b><b>.</b><b>s</b><b>p</b><b>a</b><b>,</b> <b>a</b><b>r</b><b>p</b><b>.</b><b>s</b><b>h</b><b>a</b><b>)</b><b>;</b> <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>

              ·      A priority-90 flow with the match <b>n</b><b>d</b><b>_</b><b>n</b><b>a</b> and  applies  the
                     action <b>p</b><b>u</b><b>t</b><b>_</b><b>n</b><b>d</b><b>(</b><b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b><b>,</b> <b>n</b><b>d</b><b>.</b><b>t</b><b>a</b><b>r</b><b>g</b><b>e</b><b>t</b><b>,</b> <b>n</b><b>d</b><b>.</b><b>t</b><b>l</b><b>l</b><b>)</b><b>;</b> <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>

              ·      A  priority-90  flow with the match <b>n</b><b>d</b><b>_</b><b>n</b><b>s</b> and applies the
                     action <b>p</b><b>u</b><b>t</b><b>_</b><b>n</b><b>d</b><b>(</b><b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b><b>,</b> <b>i</b><b>p</b><b>6</b><b>.</b><b>s</b><b>r</b><b>c</b><b>,</b> <b>n</b><b>d</b><b>.</b><b>s</b><b>l</b><b>l</b><b>)</b><b>;</b> <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>

     <u>I</u><u>n</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>3</u><u>:</u> <u>I</u><u>P</u> <u>I</u><u>n</u><u>p</u><u>u</u><u>t</u>

       This table is the core of the logical router datapath functionality. It
       contains  the following flows to implement very basic IP host function‐
       ality.

              ·      For each NAT entry of a distributed logical router  (with
                     distributed  gateway  router port) of type <b>s</b><b>n</b><b>a</b><b>t</b>, a prior‐
                     ity-120 flow with the match <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b> <b>=</b><b>=</b> <u>P</u> &amp;&amp;&amp;&amp; <b>i</b><b>p</b><b>4</b><b>.</b><b>s</b><b>r</b><b>c</b>  <b>=</b><b>=</b>  <u>A</u>
                     advances  the packet to the next pipeline, where <u>P</u> is the
                     distributed logical router port and <u>A</u> is the  <b>e</b><b>x</b><b>t</b><b>e</b><b>r</b><b>n</b><b>a</b><b>l</b><b>_</b><b>i</b><b>p</b>
                     set  in  the  NAT  entry.  If  <u>A</u> is an IPv6 address, then
                     <b>i</b><b>p</b><b>6</b><b>.</b><b>s</b><b>r</b><b>c</b> is used for the match.

                     The above flow is required to handle the routing  of  the
                     East/west NAT traffic.

              ·      For  each  BFD  port the two following priority-110 flows
                     are added to manage BFD traffic:

                     ·      if <b>i</b><b>p</b><b>4</b><b>.</b><b>s</b><b>r</b><b>c</b> or <b>i</b><b>p</b><b>6</b><b>.</b><b>s</b><b>r</b><b>c</b> is any IP address  owned  by
                            the  router  port and <b>u</b><b>d</b><b>p</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b><b>=</b> <b>3</b><b>7</b><b>8</b><b>4</b> , the packet
                            is advanced to the next pipeline stage.

                     ·      if <b>i</b><b>p</b><b>4</b><b>.</b><b>d</b><b>s</b><b>t</b> or <b>i</b><b>p</b><b>6</b><b>.</b><b>d</b><b>s</b><b>t</b> is any IP address  owned  by
                            the  router  port  and  <b>u</b><b>d</b><b>p</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b><b>=</b> <b>3</b><b>7</b><b>8</b><b>4</b> , the <b>h</b><b>a</b><b>n</b><b>‐</b>
                            <b>d</b><b>l</b><b>e</b><b>_</b><b>b</b><b>f</b><b>d</b><b>_</b><b>m</b><b>s</b><b>g</b> action is executed.

              ·      L3 admission control: A priority-100 flow  drops  packets
                     that match any of the following:

                     ·      <b>i</b><b>p</b><b>4</b><b>.</b><b>s</b><b>r</b><b>c</b><b>[</b><b>2</b><b>8</b><b>.</b><b>.</b><b>3</b><b>1</b><b>]</b> <b>=</b><b>=</b> <b>0</b><b>x</b><b>e</b> (multicast source)

                     ·      <b>i</b><b>p</b><b>4</b><b>.</b><b>s</b><b>r</b><b>c</b> <b>=</b><b>=</b> <b>2</b><b>5</b><b>5</b><b>.</b><b>2</b><b>5</b><b>5</b><b>.</b><b>2</b><b>5</b><b>5</b><b>.</b><b>2</b><b>5</b><b>5</b> (broadcast source)

                     ·      <b>i</b><b>p</b><b>4</b><b>.</b><b>s</b><b>r</b><b>c</b>  <b>=</b><b>=</b>  <b>1</b><b>2</b><b>7</b><b>.</b><b>0</b><b>.</b><b>0</b><b>.</b><b>0</b><b>/</b><b>8</b> <b>|</b><b>|</b> <b>i</b><b>p</b><b>4</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b><b>=</b> <b>1</b><b>2</b><b>7</b><b>.</b><b>0</b><b>.</b><b>0</b><b>.</b><b>0</b><b>/</b><b>8</b>
                            (localhost source or destination)

                     ·      <b>i</b><b>p</b><b>4</b><b>.</b><b>s</b><b>r</b><b>c</b> <b>=</b><b>=</b> <b>0</b><b>.</b><b>0</b><b>.</b><b>0</b><b>.</b><b>0</b><b>/</b><b>8</b> <b>|</b><b>|</b> <b>i</b><b>p</b><b>4</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b><b>=</b> <b>0</b><b>.</b><b>0</b><b>.</b><b>0</b><b>.</b><b>0</b><b>/</b><b>8</b> (zero
                            network source or destination)

                     ·      <b>i</b><b>p</b><b>4</b><b>.</b><b>s</b><b>r</b><b>c</b>  or <b>i</b><b>p</b><b>6</b><b>.</b><b>s</b><b>r</b><b>c</b> is any IP address owned by the
                            router, unless the packet was recirculated due  to
                            egress    loopback    as    indicated    by   <b>R</b><b>E</b><b>G</b><b>‐</b>
                            <b>B</b><b>I</b><b>T</b><b>_</b><b>E</b><b>G</b><b>R</b><b>E</b><b>S</b><b>S</b><b>_</b><b>L</b><b>O</b><b>O</b><b>P</b><b>B</b><b>A</b><b>C</b><b>K</b>.

                     ·      <b>i</b><b>p</b><b>4</b><b>.</b><b>s</b><b>r</b><b>c</b> is the broadcast address of any IP network
                            known to the router.

              ·      A  priority-100 flow parses DHCPv6 replies from IPv6 pre‐
                     fix delegation routers (<b>u</b><b>d</b><b>p</b><b>.</b><b>s</b><b>r</b><b>c</b>  <b>=</b><b>=</b>  <b>5</b><b>4</b><b>7</b>  &amp;&amp;&amp;&amp;  <b>u</b><b>d</b><b>p</b><b>.</b><b>d</b><b>s</b><b>t</b>  <b>=</b><b>=</b>
                     <b>5</b><b>4</b><b>6</b>). The <b>h</b><b>a</b><b>n</b><b>d</b><b>l</b><b>e</b><b>_</b><b>d</b><b>h</b><b>c</b><b>p</b><b>v</b><b>6</b><b>_</b><b>r</b><b>e</b><b>p</b><b>l</b><b>y</b> is used to send IPv6 prefix
                     delegation messages to the delegation router.

              ·      ICMP echo reply. These flows reply to ICMP echo  requests
                     received  for  the  router’s  IP  address. Let <u>A</u> be an IP
                     address owned by a router port. Then, for each <u>A</u> that  is
                     an IPv4 address, a priority-90 flow matches on <b>i</b><b>p</b><b>4</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b><b>=</b>
                     <u>A</u> and <b>i</b><b>c</b><b>m</b><b>p</b><b>4</b><b>.</b><b>t</b><b>y</b><b>p</b><b>e</b> <b>=</b><b>=</b> <b>8</b>  &amp;&amp;&amp;&amp;  <b>i</b><b>c</b><b>m</b><b>p</b><b>4</b><b>.</b><b>c</b><b>o</b><b>d</b><b>e</b>  <b>=</b><b>=</b>  <b>0</b>  (ICMP  echo
                     request).  For  each  <u>A</u> that is an IPv6 address, a prior‐
                     ity-90 flow matches on <b>i</b><b>p</b><b>6</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b><b>=</b> <u>A</u> and <b>i</b><b>c</b><b>m</b><b>p</b><b>6</b><b>.</b><b>t</b><b>y</b><b>p</b><b>e</b> <b>=</b><b>=</b> <b>1</b><b>2</b><b>8</b>
                     &amp;&amp;&amp;&amp; <b>i</b><b>c</b><b>m</b><b>p</b><b>6</b><b>.</b><b>c</b><b>o</b><b>d</b><b>e</b> <b>=</b><b>=</b> <b>0</b> (ICMPv6 echo request). The port of the
                     router that receives the echo request  does  not  matter.
                     Also,  the  <b>i</b><b>p</b><b>.</b><b>t</b><b>t</b><b>l</b>  of  the  echo  request  packet is not
                     checked, so it complies with RFC 1812,  section  4.2.2.9.
                     Flows for ICMPv4 echo requests use the following actions:

                     <b>i</b><b>p</b><b>4</b><b>.</b><b>d</b><b>s</b><b>t</b> <lt;<lt;<b>-</b>>gt;>gt; <b>i</b><b>p</b><b>4</b><b>.</b><b>s</b><b>r</b><b>c</b><b>;</b>
                     <b>i</b><b>p</b><b>.</b><b>t</b><b>t</b><b>l</b> <b>=</b> <b>2</b><b>5</b><b>5</b><b>;</b>
                     <b>i</b><b>c</b><b>m</b><b>p</b><b>4</b><b>.</b><b>t</b><b>y</b><b>p</b><b>e</b> <b>=</b> <b>0</b><b>;</b>
                     <b>f</b><b>l</b><b>a</b><b>g</b><b>s</b><b>.</b><b>l</b><b>o</b><b>o</b><b>p</b><b>b</b><b>a</b><b>c</b><b>k</b> <b>=</b> <b>1</b><b>;</b>
                     <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>


                     Flows for ICMPv6 echo requests use the following actions:

                     <b>i</b><b>p</b><b>6</b><b>.</b><b>d</b><b>s</b><b>t</b> <lt;<lt;<b>-</b>>gt;>gt; <b>i</b><b>p</b><b>6</b><b>.</b><b>s</b><b>r</b><b>c</b><b>;</b>
                     <b>i</b><b>p</b><b>.</b><b>t</b><b>t</b><b>l</b> <b>=</b> <b>2</b><b>5</b><b>5</b><b>;</b>
                     <b>i</b><b>c</b><b>m</b><b>p</b><b>6</b><b>.</b><b>t</b><b>y</b><b>p</b><b>e</b> <b>=</b> <b>1</b><b>2</b><b>9</b><b>;</b>
                     <b>f</b><b>l</b><b>a</b><b>g</b><b>s</b><b>.</b><b>l</b><b>o</b><b>o</b><b>p</b><b>b</b><b>a</b><b>c</b><b>k</b> <b>=</b> <b>1</b><b>;</b>
                     <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>


              ·      Reply to ARP requests.

                     These flows reply to ARP requests for the router’s own IP
                     address.  The  ARP  requests  are  handled  only  if  the
                     requestor’s IP belongs to the same subnets of the logical
                     router port. For each router port <u>P</u> that owns IP  address
                     <u>A</u>,  which  belongs  to subnet <u>S</u> with prefix length <u>L</u>, and
                     Ethernet address <u>E</u>, a priority-90 flow matches <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b>  <b>=</b><b>=</b>
                     <u>P</u>  &amp;&amp;&amp;&amp;  <b>a</b><b>r</b><b>p</b><b>.</b><b>s</b><b>p</b><b>a</b> <b>=</b><b>=</b> <u>S</u><b>/</b><u>L</u> &amp;&amp;&amp;&amp; <b>a</b><b>r</b><b>p</b><b>.</b><b>o</b><b>p</b> <b>=</b><b>=</b> <b>1</b> &amp;&amp;&amp;&amp; <b>a</b><b>r</b><b>p</b><b>.</b><b>t</b><b>p</b><b>a</b> <b>=</b><b>=</b> <u>A</u> (ARP
                     request) with the following actions:

                     <b>e</b><b>t</b><b>h</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b> <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b><b>;</b>
                     <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b> <b>=</b> <b>x</b><b>r</b><b>e</b><b>g</b><b>0</b><b>[</b><b>0</b><b>.</b><b>.</b><b>4</b><b>7</b><b>]</b><b>;</b>
                     <b>a</b><b>r</b><b>p</b><b>.</b><b>o</b><b>p</b> <b>=</b> <b>2</b><b>;</b> <b>/</b><b>*</b> <b>A</b><b>R</b><b>P</b> <b>r</b><b>e</b><b>p</b><b>l</b><b>y</b><b>.</b> <b>*</b><b>/</b>
                     <b>a</b><b>r</b><b>p</b><b>.</b><b>t</b><b>h</b><b>a</b> <b>=</b> <b>a</b><b>r</b><b>p</b><b>.</b><b>s</b><b>h</b><b>a</b><b>;</b>
                     <b>a</b><b>r</b><b>p</b><b>.</b><b>s</b><b>h</b><b>a</b> <b>=</b> <b>x</b><b>r</b><b>e</b><b>g</b><b>0</b><b>[</b><b>0</b><b>.</b><b>.</b><b>4</b><b>7</b><b>]</b><b>;</b>
                     <b>a</b><b>r</b><b>p</b><b>.</b><b>t</b><b>p</b><b>a</b> <b>=</b> <b>a</b><b>r</b><b>p</b><b>.</b><b>s</b><b>p</b><b>a</b><b>;</b>
                     <b>a</b><b>r</b><b>p</b><b>.</b><b>s</b><b>p</b><b>a</b> <b>=</b> <u>A</u>;
                     <b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b> <b>=</b> <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b><b>;</b>
                     <b>f</b><b>l</b><b>a</b><b>g</b><b>s</b><b>.</b><b>l</b><b>o</b><b>o</b><b>p</b><b>b</b><b>a</b><b>c</b><b>k</b> <b>=</b> <b>1</b><b>;</b>
                     <b>o</b><b>u</b><b>t</b><b>p</b><b>u</b><b>t</b><b>;</b>


                     For the gateway port  on  a  distributed  logical  router
                     (where  one of the logical router ports specifies a gate‐
                     way chassis), the above flows are only programmed on  the
                     gateway port instance on the gateway chassis. This behav‐
                     ior avoids generation of multiple ARP responses from dif‐
                     ferent chassis, and allows upstream MAC learning to point
                     to the gateway chassis.

                     For the logical router port with the option <b>r</b><b>e</b><b>s</b><b>i</b><b>d</b><b>e</b><b>-</b><b>o</b><b>n</b><b>-</b><b>r</b><b>e</b><b>‐</b>
                     <b>d</b><b>i</b><b>r</b><b>e</b><b>c</b><b>t</b><b>-</b><b>c</b><b>h</b><b>a</b><b>s</b><b>s</b><b>i</b><b>s</b>  set  (which  is  centralized),  the above
                     flows are only programmed on the gateway port instance on
                     the gateway chassis (if the logical router has a distrib‐
                     uted gateway port). This behavior  avoids  generation  of
                     multiple ARP responses from different chassis, and allows
                     upstream MAC learning to point to the gateway chassis.

              ·      Reply to IPv6 Neighbor Solicitations. These  flows  reply
                     to  Neighbor  Solicitation  requests for the router’s own
                     IPv6 address and populate the logical router’s mac  bind‐
                     ing table.

                     For  each  router  port  <u>P</u>  that  owns  IPv6  address  <u>A</u>,
                     solicited node address <u>S</u>, and Ethernet address <u>E</u>, a  pri‐
                     ority-90  flow matches <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b> <b>=</b><b>=</b> <u>P</u> &amp;&amp;&amp;&amp; <b>n</b><b>d</b><b>_</b><b>n</b><b>s</b> &amp;&amp;&amp;&amp; <b>i</b><b>p</b><b>6</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b><b>=</b>
                     <b>{</b><u>A</u><b>,</b> <u>E</u><b>}</b> &amp;&amp;&amp;&amp; <b>n</b><b>d</b><b>.</b><b>t</b><b>a</b><b>r</b><b>g</b><b>e</b><b>t</b> <b>=</b><b>=</b> <u>A</u> with the following actions:

                     <b>n</b><b>d</b><b>_</b><b>n</b><b>a</b><b>_</b><b>r</b><b>o</b><b>u</b><b>t</b><b>e</b><b>r</b> <b>{</b>
                         <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b> <b>=</b> <b>x</b><b>r</b><b>e</b><b>g</b><b>0</b><b>[</b><b>0</b><b>.</b><b>.</b><b>4</b><b>7</b><b>]</b><b>;</b>
                         <b>i</b><b>p</b><b>6</b><b>.</b><b>s</b><b>r</b><b>c</b> <b>=</b> <u>A</u>;
                         <b>n</b><b>d</b><b>.</b><b>t</b><b>a</b><b>r</b><b>g</b><b>e</b><b>t</b> <b>=</b> <u>A</u>;
                         <b>n</b><b>d</b><b>.</b><b>t</b><b>l</b><b>l</b> <b>=</b> <b>x</b><b>r</b><b>e</b><b>g</b><b>0</b><b>[</b><b>0</b><b>.</b><b>.</b><b>4</b><b>7</b><b>]</b><b>;</b>
                         <b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b> <b>=</b> <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b><b>;</b>
                         <b>f</b><b>l</b><b>a</b><b>g</b><b>s</b><b>.</b><b>l</b><b>o</b><b>o</b><b>p</b><b>b</b><b>a</b><b>c</b><b>k</b> <b>=</b> <b>1</b><b>;</b>
                         <b>o</b><b>u</b><b>t</b><b>p</b><b>u</b><b>t</b><b>;</b>
                     <b>}</b><b>;</b>


                     For the gateway port  on  a  distributed  logical  router
                     (where  one of the logical router ports specifies a gate‐
                     way chassis), the above flows replying to  IPv6  Neighbor
                     Solicitations  are  only  programmed  on the gateway port
                     instance on the gateway  chassis.  This  behavior  avoids
                     generation  of  multiple  replies from different chassis,
                     and allows upstream MAC learning to point to the  gateway
                     chassis.

              ·      These flows reply to ARP requests or IPv6 neighbor solic‐
                     itation for the virtual IP addresses  configured  in  the
                     router for NAT (both DNAT and SNAT) or load balancing.

                     IPv4:  For  a  configured  NAT  (both  DNAT  and SNAT) IP
                     address or a load balancer IPv4 VIP <u>A</u>,  for  each  router
                     port  <u>P</u>  with  Ethernet  address  <u>E</u>,  a  priority-90 flow
                     matches <b>a</b><b>r</b><b>p</b><b>.</b><b>o</b><b>p</b> <b>=</b><b>=</b> <b>1</b> &amp;&amp;&amp;&amp; <b>a</b><b>r</b><b>p</b><b>.</b><b>t</b><b>p</b><b>a</b> <b>=</b><b>=</b> <u>A</u>  (ARP  request)  with
                     the following actions:

                     <b>e</b><b>t</b><b>h</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b> <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b><b>;</b>
                     <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b> <b>=</b> <b>x</b><b>r</b><b>e</b><b>g</b><b>0</b><b>[</b><b>0</b><b>.</b><b>.</b><b>4</b><b>7</b><b>]</b><b>;</b>
                     <b>a</b><b>r</b><b>p</b><b>.</b><b>o</b><b>p</b> <b>=</b> <b>2</b><b>;</b> <b>/</b><b>*</b> <b>A</b><b>R</b><b>P</b> <b>r</b><b>e</b><b>p</b><b>l</b><b>y</b><b>.</b> <b>*</b><b>/</b>
                     <b>a</b><b>r</b><b>p</b><b>.</b><b>t</b><b>h</b><b>a</b> <b>=</b> <b>a</b><b>r</b><b>p</b><b>.</b><b>s</b><b>h</b><b>a</b><b>;</b>
                     <b>a</b><b>r</b><b>p</b><b>.</b><b>s</b><b>h</b><b>a</b> <b>=</b> <b>x</b><b>r</b><b>e</b><b>g</b><b>0</b><b>[</b><b>0</b><b>.</b><b>.</b><b>4</b><b>7</b><b>]</b><b>;</b>
                     <b>a</b><b>r</b><b>p</b><b>.</b><b>t</b><b>p</b><b>a</b> <lt;<lt;<b>-</b>>gt;>gt; <b>a</b><b>r</b><b>p</b><b>.</b><b>s</b><b>p</b><b>a</b><b>;</b>
                     <b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b> <b>=</b> <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b><b>;</b>
                     <b>f</b><b>l</b><b>a</b><b>g</b><b>s</b><b>.</b><b>l</b><b>o</b><b>o</b><b>p</b><b>b</b><b>a</b><b>c</b><b>k</b> <b>=</b> <b>1</b><b>;</b>
                     <b>o</b><b>u</b><b>t</b><b>p</b><b>u</b><b>t</b><b>;</b>


                     IPv4:  For a configured load balancer IPv4 VIP, a similar
                     flow is added with the additional match <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b> <b>=</b><b>=</b> <u>P</u>.

                     If the router port <u>P</u>  is  a  distributed  gateway  router
                     port,  then  the  <b>i</b><b>s</b><b>_</b><b>c</b><b>h</b><b>a</b><b>s</b><b>s</b><b>i</b><b>s</b><b>_</b><b>r</b><b>e</b><b>s</b><b>i</b><b>d</b><b>e</b><b>n</b><b>t</b><b>(</b><u>P</u><b>)</b> is also added in
                     the match condition for the load balancer IPv4 VIP <u>A</u>.

                     IPv6: For a  configured  NAT  (both  DNAT  and  SNAT)  IP
                     address  or  a  load  balancer IPv6 VIP <u>A</u>, solicited node
                     address <u>S</u>, for each router port <u>P</u> with  Ethernet  address
                     <u>E</u>,  a  priority-90  flow  matches <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b> <b>=</b><b>=</b> <u>P</u> &amp;&amp;&amp;&amp; <b>n</b><b>d</b><b>_</b><b>n</b><b>s</b> &amp;&amp;&amp;&amp;
                     <b>i</b><b>p</b><b>6</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b><b>=</b> <b>{</b><u>A</u><b>,</b> <u>S</u><b>}</b> &amp;&amp;&amp;&amp; <b>n</b><b>d</b><b>.</b><b>t</b><b>a</b><b>r</b><b>g</b><b>e</b><b>t</b> <b>=</b><b>=</b> <u>A</u>  with  the  following
                     actions:

                     <b>e</b><b>t</b><b>h</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b> <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b><b>;</b>
                     <b>n</b><b>d</b><b>_</b><b>n</b><b>a</b> <b>{</b>
                         <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b> <b>=</b> <b>x</b><b>r</b><b>e</b><b>g</b><b>0</b><b>[</b><b>0</b><b>.</b><b>.</b><b>4</b><b>7</b><b>]</b><b>;</b>
                         <b>n</b><b>d</b><b>.</b><b>t</b><b>l</b><b>l</b> <b>=</b> <b>x</b><b>r</b><b>e</b><b>g</b><b>0</b><b>[</b><b>0</b><b>.</b><b>.</b><b>4</b><b>7</b><b>]</b><b>;</b>
                         <b>i</b><b>p</b><b>6</b><b>.</b><b>s</b><b>r</b><b>c</b> <b>=</b> <u>A</u>;
                         <b>n</b><b>d</b><b>.</b><b>t</b><b>a</b><b>r</b><b>g</b><b>e</b><b>t</b> <b>=</b> <u>A</u>;
                         <b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b> <b>=</b> <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b><b>;</b>
                         <b>f</b><b>l</b><b>a</b><b>g</b><b>s</b><b>.</b><b>l</b><b>o</b><b>o</b><b>p</b><b>b</b><b>a</b><b>c</b><b>k</b> <b>=</b> <b>1</b><b>;</b>
                         <b>o</b><b>u</b><b>t</b><b>p</b><b>u</b><b>t</b><b>;</b>
                     <b>}</b>


                     If  the  router  port  <u>P</u>  is a distributed gateway router
                     port, then the <b>i</b><b>s</b><b>_</b><b>c</b><b>h</b><b>a</b><b>s</b><b>s</b><b>i</b><b>s</b><b>_</b><b>r</b><b>e</b><b>s</b><b>i</b><b>d</b><b>e</b><b>n</b><b>t</b><b>(</b><u>P</u><b>)</b> is  also  added  in
                     the match condition for the load balancer IPv6 VIP <u>A</u>.

                     For the gateway port on a distributed logical router with
                     NAT (where one of the logical router  ports  specifies  a
                     gateway chassis):

                     ·      If the corresponding NAT rule cannot be handled in
                            a distributed manner, then a priority-92  flow  is
                            programmed  on  the  gateway  port instance on the
                            gateway chassis. A priority-91 drop flow  is  pro‐
                            grammed  on the other chassis when ARP requests/NS
                            packets are received on  the  gateway  port.  This
                            behavior   avoids   generation   of  multiple  ARP
                            responses  from  different  chassis,  and   allows
                            upstream  MAC  learning  to  point  to the gateway
                            chassis.

                     ·      If the corresponding NAT rule can be handled in  a
                            distributed  manner,  then  this flow is only pro‐
                            grammed on the gateway  port  instance  where  the
                            <b>l</b><b>o</b><b>g</b><b>i</b><b>c</b><b>a</b><b>l</b><b>_</b><b>p</b><b>o</b><b>r</b><b>t</b> specified in the NAT rule resides.

                            Some  of  the actions are different for this case,
                            using the <b>e</b><b>x</b><b>t</b><b>e</b><b>r</b><b>n</b><b>a</b><b>l</b><b>_</b><b>m</b><b>a</b><b>c</b> specified in the  NAT  rule
                            rather than the gateway port’s Ethernet address <u>E</u>:

                            <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b> <b>=</b> <u>e</u><u>x</u><u>t</u><u>e</u><u>r</u><u>n</u><u>a</u><u>l</u><b>_</b><u>m</u><u>a</u><u>c</u>;
                            <b>a</b><b>r</b><b>p</b><b>.</b><b>s</b><b>h</b><b>a</b> <b>=</b> <u>e</u><u>x</u><u>t</u><u>e</u><u>r</u><u>n</u><u>a</u><u>l</u><b>_</b><u>m</u><u>a</u><u>c</u>;


                            or in the case of IPv6 neighbor solicition:

                            <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b> <b>=</b> <u>e</u><u>x</u><u>t</u><u>e</u><u>r</u><u>n</u><u>a</u><u>l</u><b>_</b><u>m</u><u>a</u><u>c</u>;
                            <b>n</b><b>d</b><b>.</b><b>t</b><b>l</b><b>l</b> <b>=</b> <u>e</u><u>x</u><u>t</u><u>e</u><u>r</u><u>n</u><u>a</u><u>l</u><b>_</b><u>m</u><u>a</u><u>c</u>;


                            This  behavior  avoids  generation of multiple ARP
                            responses  from  different  chassis,  and   allows
                            upstream  MAC  learning  to  point  to the correct
                            chassis.

              ·      Priority-85 flows which drops the ARP and  IPv6  Neighbor
                     Discovery packets.

              ·      A priority-84 flow explicitly allows IPv6 multicast traf‐
                     fic that is supposed to reach the router pipeline  (i.e.,
                     router solicitation and router advertisement packets).

              ·      A  priority-83 flow explicitly drops IPv6 multicast traf‐
                     fic that is destined to reserved multicast groups.

              ·      A  priority-82  flow  allows  IP  multicast  traffic   if
                     <b>o</b><b>p</b><b>t</b><b>i</b><b>o</b><b>n</b><b>s</b>:mcast_relay=’true’, otherwise drops it.

              ·      UDP  port  unreachable.  Priority-80  flows generate ICMP
                     port unreachable  messages  in  reply  to  UDP  datagrams
                     directed  to  the router’s IP address, except in the spe‐
                     cial case of gateways, which accept traffic directed to a
                     router IP for load balancing and NAT purposes.

                     These  flows  should  not match IP fragments with nonzero
                     offset.

              ·      TCP reset. Priority-80 flows generate TCP reset  messages
                     in  reply  to  TCP  datagrams directed to the router’s IP
                     address, except in the special case  of  gateways,  which
                     accept traffic directed to a router IP for load balancing
                     and NAT purposes.

                     These flows should not match IP  fragments  with  nonzero
                     offset.

              ·      Protocol or address unreachable. Priority-70 flows gener‐
                     ate ICMP protocol or  address  unreachable  messages  for
                     IPv4  and  IPv6 respectively in reply to packets directed
                     to the router’s IP address on  IP  protocols  other  than
                     UDP,  TCP,  and ICMP, except in the special case of gate‐
                     ways, which accept traffic directed to a  router  IP  for
                     load balancing purposes.

                     These  flows  should  not match IP fragments with nonzero
                     offset.

              ·      Drop other IP traffic to this router.  These  flows  drop
                     any  other  traffic  destined  to  an  IP address of this
                     router that is not already handled by one  of  the  flows
                     above,  which  amounts to ICMP (other than echo requests)
                     and fragments with nonzero offsets. For each IP address <u>A</u>
                     owned  by  the router, a priority-60 flow matches <b>i</b><b>p</b><b>4</b><b>.</b><b>d</b><b>s</b><b>t</b>
                     <b>=</b><b>=</b> <u>A</u> or <b>i</b><b>p</b><b>6</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b><b>=</b> <u>A</u> and drops the traffic. An  exception
                     is  made  and  the  above flow is not added if the router
                     port’s own IP address is used  to  SNAT  packets  passing
                     through that router.

       The flows above handle all of the traffic that might be directed to the
       router itself. The following flows (with lower priorities)  handle  the
       remaining traffic, potentially for forwarding:

              ·      Drop  Ethernet  local  broadcast. A priority-50 flow with
                     match <b>e</b><b>t</b><b>h</b><b>.</b><b>b</b><b>c</b><b>a</b><b>s</b><b>t</b> drops traffic destined to the local  Eth‐
                     ernet  broadcast  address.  By  definition  this  traffic
                     should not be forwarded.

              ·      ICMP time exceeded. For each  router  port  <u>P</u>,  whose  IP
                     address  is  <u>A</u>, a priority-40 flow with match <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b> <b>=</b><b>=</b> <u>P</u>
                     &amp;&amp;&amp;&amp; <b>i</b><b>p</b><b>.</b><b>t</b><b>t</b><b>l</b> <b>=</b><b>=</b> <b>{</b><b>0</b><b>,</b> <b>1</b><b>}</b>  &amp;&amp;&amp;&amp;  <b>!</b><b>i</b><b>p</b><b>.</b><b>l</b><b>a</b><b>t</b><b>e</b><b>r</b><b>_</b><b>f</b><b>r</b><b>a</b><b>g</b>  matches  packets
                     whose TTL has expired, with the following actions to send
                     an ICMP time exceeded reply for  IPv4  and  IPv6  respec‐
                     tively:

                     <b>i</b><b>c</b><b>m</b><b>p</b><b>4</b> <b>{</b>
                         <b>i</b><b>c</b><b>m</b><b>p</b><b>4</b><b>.</b><b>t</b><b>y</b><b>p</b><b>e</b> <b>=</b> <b>1</b><b>1</b><b>;</b> <b>/</b><b>*</b> <b>T</b><b>i</b><b>m</b><b>e</b> <b>e</b><b>x</b><b>c</b><b>e</b><b>e</b><b>d</b><b>e</b><b>d</b><b>.</b> <b>*</b><b>/</b>
                         <b>i</b><b>c</b><b>m</b><b>p</b><b>4</b><b>.</b><b>c</b><b>o</b><b>d</b><b>e</b> <b>=</b> <b>0</b><b>;</b>  <b>/</b><b>*</b> <b>T</b><b>T</b><b>L</b> <b>e</b><b>x</b><b>c</b><b>e</b><b>e</b><b>d</b><b>e</b><b>d</b> <b>i</b><b>n</b> <b>t</b><b>r</b><b>a</b><b>n</b><b>s</b><b>i</b><b>t</b><b>.</b> <b>*</b><b>/</b>
                         <b>i</b><b>p</b><b>4</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b> <b>i</b><b>p</b><b>4</b><b>.</b><b>s</b><b>r</b><b>c</b><b>;</b>
                         <b>i</b><b>p</b><b>4</b><b>.</b><b>s</b><b>r</b><b>c</b> <b>=</b> <u>A</u>;
                         <b>i</b><b>p</b><b>.</b><b>t</b><b>t</b><b>l</b> <b>=</b> <b>2</b><b>5</b><b>5</b><b>;</b>
                         <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>
                     <b>}</b><b>;</b>
                     <b>i</b><b>c</b><b>m</b><b>p</b><b>6</b> <b>{</b>
                         <b>i</b><b>c</b><b>m</b><b>p</b><b>6</b><b>.</b><b>t</b><b>y</b><b>p</b><b>e</b> <b>=</b> <b>3</b><b>;</b> <b>/</b><b>*</b> <b>T</b><b>i</b><b>m</b><b>e</b> <b>e</b><b>x</b><b>c</b><b>e</b><b>e</b><b>d</b><b>e</b><b>d</b><b>.</b> <b>*</b><b>/</b>
                         <b>i</b><b>c</b><b>m</b><b>p</b><b>6</b><b>.</b><b>c</b><b>o</b><b>d</b><b>e</b> <b>=</b> <b>0</b><b>;</b>  <b>/</b><b>*</b> <b>T</b><b>T</b><b>L</b> <b>e</b><b>x</b><b>c</b><b>e</b><b>e</b><b>d</b><b>e</b><b>d</b> <b>i</b><b>n</b> <b>t</b><b>r</b><b>a</b><b>n</b><b>s</b><b>i</b><b>t</b><b>.</b> <b>*</b><b>/</b>
                         <b>i</b><b>p</b><b>6</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b> <b>i</b><b>p</b><b>6</b><b>.</b><b>s</b><b>r</b><b>c</b><b>;</b>
                         <b>i</b><b>p</b><b>6</b><b>.</b><b>s</b><b>r</b><b>c</b> <b>=</b> <u>A</u>;
                         <b>i</b><b>p</b><b>.</b><b>t</b><b>t</b><b>l</b> <b>=</b> <b>2</b><b>5</b><b>5</b><b>;</b>
                         <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>
                     <b>}</b><b>;</b>


              ·      TTL  discard. A priority-30 flow with match <b>i</b><b>p</b><b>.</b><b>t</b><b>t</b><b>l</b> <b>=</b><b>=</b> <b>{</b><b>0</b><b>,</b>
                     <b>1</b><b>}</b> and actions <b>d</b><b>r</b><b>o</b><b>p</b><b>;</b> drops other packets  whose  TTL  has
                     expired, that should not receive a ICMP error reply (i.e.
                     fragments with nonzero offset).

              ·      Next table. A priority-0 flows  match  all  packets  that
                     aren’t  already  handled  and  uses actions <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b> to feed
                     them to the next table.

     <u>I</u><u>n</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>4</u><u>:</u> <u>D</u><u>E</u><u>F</u><u>R</u><u>A</u><u>G</u>

       This is to send packets to connection tracker for tracking and  defrag‐
       mentation.  It  contains a priority-0 flow that simply moves traffic to
       the next table.

       If load balancing rules with virtual IP addresses (and ports) are  con‐
       figured in <b>O</b><b>V</b><b>N</b><b>_</b><b>N</b><b>o</b><b>r</b><b>t</b><b>h</b><b>b</b><b>o</b><b>u</b><b>n</b><b>d</b> database for a Gateway router, a priority-100
       flow is added for each configured virtual IP address <u>V</u><u>I</u><u>P</u>. For IPv4 <u>V</u><u>I</u><u>P</u><u>s</u>
       the  flow matches <b>i</b><b>p</b> &amp;&amp;&amp;&amp; <b>i</b><b>p</b><b>4</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b><b>=</b> <u>V</u><u>I</u><u>P</u>. For IPv6 <u>V</u><u>I</u><u>P</u><u>s</u>, the flow matches
       <b>i</b><b>p</b> &amp;&amp;&amp;&amp; <b>i</b><b>p</b><b>6</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b><b>=</b> <u>V</u><u>I</u><u>P</u>. The flow uses the  action  <b>c</b><b>t</b><b>_</b><b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>  to  send  IP
       packets  to  the  connection  tracker  for  packet de-fragmentation and
       tracking before sending it to the next table.

       If ECMP routes with symmetric reply are configured  in  the  <b>O</b><b>V</b><b>N</b><b>_</b><b>N</b><b>o</b><b>r</b><b>t</b><b>h</b><b>‐</b>
       <b>b</b><b>o</b><b>u</b><b>n</b><b>d</b>  database  for a gateway router, a priority-300 flow is added for
       each router port on which symmetric replies are configured. The  match‐
       ing  logic for these ports essentially reverses the configured logic of
       the ECMP route. So for instance, a route  with  a  destination  routing
       policy  will  instead match if the source IP address matches the static
       route’s prefix. The flow uses the action <b>c</b><b>t</b><b>_</b><b>n</b><b>e</b><b>x</b><b>t</b> to send IP packets  to
       the  connection tracker for packet de-fragmentation and tracking before
       sending it to the next table.

     <u>I</u><u>n</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>5</u><u>:</u> <u>U</u><u>N</u><u>S</u><u>N</u><u>A</u><u>T</u>

       This is for already established  connections’  reverse  traffic.  i.e.,
       SNAT  has  already  been done in egress pipeline and now the packet has
       entered the ingress pipeline as part of a reply. It is unSNATted here.

       Ingress Table 5: UNSNAT on Gateway and Distributed Routers

              ·      If the Router (Gateway or Distributed) is configured with
                     load balancers, then below lflows are added:

                     For each IPv4 address <u>A</u> defined as load balancer VIP with
                     the protocol <u>P</u> (and the protocol port <u>T</u>  if  defined)  is
                     also present as an <b>e</b><b>x</b><b>t</b><b>e</b><b>r</b><b>n</b><b>a</b><b>l</b><b>_</b><b>i</b><b>p</b> in the NAT table, a prior‐
                     ity-120 logical flow is  added  with  the  match  <b>i</b><b>p</b><b>4</b>  &amp;&amp;&amp;&amp;
                     <b>i</b><b>p</b><b>4</b><b>.</b><b>d</b><b>s</b><b>t</b>  <b>=</b><b>=</b>  <u>A</u>  &amp;&amp;&amp;&amp; <u>P</u> with the action <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b> to advance the
                     packet to the next table. If the load balancer has proto‐
                     col port <b>B</b> defined, then the match also has <u>P</u><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b><b>=</b> <u>B</u>.

                     The above flows are also added for IPv6 load balancers.

       Ingress Table 5: UNSNAT on Gateway Routers

              ·      If  the  Gateway router has been configured to force SNAT
                     any previously DNATted packets to <u>B</u>, a priority-110  flow
                     matches  <b>i</b><b>p</b> &amp;&amp;&amp;&amp; <b>i</b><b>p</b><b>4</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b><b>=</b> <u>B</u> or <b>i</b><b>p</b> &amp;&amp;&amp;&amp; <b>i</b><b>p</b><b>6</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b><b>=</b> <u>B</u> with an
                     action <b>c</b><b>t</b><b>_</b><b>s</b><b>n</b><b>a</b><b>t</b><b>;</b> .

                     If   the    Gateway    router    is    configured    with
                     <b>l</b><b>b</b><b>_</b><b>f</b><b>o</b><b>r</b><b>c</b><b>e</b><b>_</b><b>s</b><b>n</b><b>a</b><b>t</b><b>_</b><b>i</b><b>p</b><b>=</b><b>r</b><b>o</b><b>u</b><b>t</b><b>e</b><b>r</b><b>_</b><b>i</b><b>p</b>  then for every logical router
                     port <u>P</u> attached to the Gateway router with the router  ip
                     <u>B</u>,  a priority-110 flow is added with the match <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b> <b>=</b><b>=</b>
                     <u>P</u> &amp;&amp;&amp;&amp; <b>i</b><b>p</b><b>4</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b><b>=</b> <u>B</u> or <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b> <b>=</b><b>=</b> <u>P</u> &amp;&amp;&amp;&amp; <b>i</b><b>p</b><b>6</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b><b>=</b> <u>B</u> with  an
                     action <b>c</b><b>t</b><b>_</b><b>s</b><b>n</b><b>a</b><b>t</b><b>;</b> .

                     If  the  Gateway router has been configured to force SNAT
                     any previously load-balanced packets to <u>B</u>, a priority-100
                     flow  matches  <b>i</b><b>p</b>  &amp;&amp;&amp;&amp;  <b>i</b><b>p</b><b>4</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b><b>=</b> <u>B</u> or <b>i</b><b>p</b> &amp;&amp;&amp;&amp; <b>i</b><b>p</b><b>6</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b><b>=</b> <u>B</u>
                     with an action <b>c</b><b>t</b><b>_</b><b>s</b><b>n</b><b>a</b><b>t</b><b>;</b> .

                     For each NAT configuration in the  OVN  Northbound  data‐
                     base,  that  asks  to  change  the source IP address of a
                     packet from <u>A</u> to <u>B</u>, a  priority-90  flow  matches  <b>i</b><b>p</b>  &amp;&amp;&amp;&amp;
                     <b>i</b><b>p</b><b>4</b><b>.</b><b>d</b><b>s</b><b>t</b>  <b>=</b><b>=</b>  <u>B</u>  or  <b>i</b><b>p</b>  &amp;&amp;&amp;&amp;  <b>i</b><b>p</b><b>6</b><b>.</b><b>d</b><b>s</b><b>t</b>  <b>=</b><b>=</b>  <u>B</u> with an action
                     <b>c</b><b>t</b><b>_</b><b>s</b><b>n</b><b>a</b><b>t</b><b>;</b> . If the NAT rule is of type  dnat_and_snat  and
                     has  <b>s</b><b>t</b><b>a</b><b>t</b><b>e</b><b>l</b><b>e</b><b>s</b><b>s</b><b>=</b><b>t</b><b>r</b><b>u</b><b>e</b> in the options, then the action would
                     be <b>i</b><b>p</b><b>4</b><b>/</b><b>6</b><b>.</b><b>d</b><b>s</b><b>t</b><b>=</b> <b>(</b><u>B</u><b>)</b>.

                     A priority-0 logical flow with match <b>1</b> has actions <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>.

       Ingress Table 5: UNSNAT on Distributed Routers

              ·      For each configuration in the  OVN  Northbound  database,
                     that  asks  to  change  the source IP address of a packet
                     from <u>A</u> to <u>B</u>, a priority-100 flow matches <b>i</b><b>p</b> &amp;&amp;&amp;&amp; <b>i</b><b>p</b><b>4</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b><b>=</b>
                     <u>B</u>  &amp;&amp;&amp;&amp;  <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b> <b>=</b><b>=</b> <u>G</u><u>W</u> or <b>i</b><b>p</b> &amp;&amp;&amp;&amp; <b>i</b><b>p</b><b>6</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b><b>=</b> <u>B</u> &amp;&amp;&amp;&amp; <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b> <b>=</b><b>=</b> <u>G</u><u>W</u>
                     where <u>G</u><u>W</u> is the logical  router  gateway  port,  with  an
                     action <b>c</b><b>t</b><b>_</b><b>s</b><b>n</b><b>a</b><b>t</b><b>;</b>. If the NAT rule is of type dnat_and_snat
                     and has <b>s</b><b>t</b><b>a</b><b>t</b><b>e</b><b>l</b><b>e</b><b>s</b><b>s</b><b>=</b><b>t</b><b>r</b><b>u</b><b>e</b> in the options,  then  the  action
                     would be <b>i</b><b>p</b><b>4</b><b>/</b><b>6</b><b>.</b><b>d</b><b>s</b><b>t</b><b>=</b> <b>(</b><u>B</u><b>)</b>.

                     If  the  NAT rule cannot be handled in a distributed man‐
                     ner, then the priority-100 flow above is only  programmed
                     on the gateway chassis.

                     A priority-0 logical flow with match <b>1</b> has actions <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>.

     <u>I</u><u>n</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>6</u><u>:</u> <u>D</u><u>N</u><u>A</u><u>T</u>

       Packets enter the pipeline with destination IP address that needs to be
       DNATted from a virtual IP address to a real IP address. Packets in  the
       reverse direction needs to be unDNATed.

       Ingress Table 6: Load balancing DNAT rules

       Following  load  balancing  DNAT  flows are added for Gateway router or
       Router with gateway port. These flows are programmed only on the  gate‐
       way  chassis. These flows do not get programmed for load balancers with
       IPv6 <u>V</u><u>I</u><u>P</u><u>s</u>.

              ·      If controller_event has been enabled for all the  config‐
                     ured  load balancing rules for a Gateway router or Router
                     with gateway port in <b>O</b><b>V</b><b>N</b><b>_</b><b>N</b><b>o</b><b>r</b><b>t</b><b>h</b><b>b</b><b>o</b><b>u</b><b>n</b><b>d</b>  database  that  does
                     not  have  configured  backends,  a  priority-130 flow is
                     added to trigger ovn-controller events whenever the chas‐
                     sis  receives  a  packet  for  that  particular  VIP.  If
                     <b>e</b><b>v</b><b>e</b><b>n</b><b>t</b><b>-</b><b>e</b><b>l</b><b>b</b> meter has been previously created, it  will  be
                     associated to the empty_lb logical flow

              ·      For all the configured load balancing rules for a Gateway
                     router or Router  with  gateway  port  in  <b>O</b><b>V</b><b>N</b><b>_</b><b>N</b><b>o</b><b>r</b><b>t</b><b>h</b><b>b</b><b>o</b><b>u</b><b>n</b><b>d</b>
                     database  that  includes a L4 port <u>P</u><u>O</u><u>R</u><u>T</u> of protocol <u>P</u> and
                     IPv4 or  IPv6  address  <u>V</u><u>I</u><u>P</u>,  a  priority-120  flow  that
                     matches  on  <b>c</b><b>t</b><b>.</b><b>n</b><b>e</b><b>w</b> &amp;&amp;&amp;&amp; <b>i</b><b>p</b> &amp;&amp;&amp;&amp; <b>i</b><b>p</b><b>4</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b><b>=</b> <u>V</u><u>I</u><u>P</u> &amp;&amp;&amp;&amp; <u>P</u> &amp;&amp;&amp;&amp; <u>P</u><b>.</b><b>d</b><b>s</b><b>t</b>
                     <b>=</b><b>=</b> <u>P</u><u>O</u><u>R</u><u>T</u>
                      (<b>i</b><b>p</b><b>6</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b><b>=</b> <u>V</u><u>I</u><u>P</u> in the IPv6  case)  with  an  action  of
                     <b>c</b><b>t</b><b>_</b><b>l</b><b>b</b><b>(</b><u>a</u><u>r</u><u>g</u><u>s</u><b>)</b>,  where <u>a</u><u>r</u><u>g</u><u>s</u> contains comma separated IPv4 or
                     IPv6 addresses (and optional port numbers) to  load  bal‐
                     ance  to.  If  the router is configured to force SNAT any
                     load-balanced packets, the above action will be  replaced
                     by <b>f</b><b>l</b><b>a</b><b>g</b><b>s</b><b>.</b><b>f</b><b>o</b><b>r</b><b>c</b><b>e</b><b>_</b><b>s</b><b>n</b><b>a</b><b>t</b><b>_</b><b>f</b><b>o</b><b>r</b><b>_</b><b>l</b><b>b</b> <b>=</b> <b>1</b><b>;</b> <b>c</b><b>t</b><b>_</b><b>l</b><b>b</b><b>(</b><u>a</u><u>r</u><u>g</u><u>s</u><b>)</b><b>;</b>. If the load
                     balancing rule is configured with <b>s</b><b>k</b><b>i</b><b>p</b><b>_</b><b>s</b><b>n</b><b>a</b><b>t</b> set to  true,
                     the     above     action     will    be    replaced    by
                     <b>f</b><b>l</b><b>a</b><b>g</b><b>s</b><b>.</b><b>s</b><b>k</b><b>i</b><b>p</b><b>_</b><b>s</b><b>n</b><b>a</b><b>t</b><b>_</b><b>f</b><b>o</b><b>r</b><b>_</b><b>l</b><b>b</b> <b>=</b> <b>1</b><b>;</b> <b>c</b><b>t</b><b>_</b><b>l</b><b>b</b><b>(</b><u>a</u><u>r</u><u>g</u><u>s</u><b>)</b><b>;</b>. If health check
                     is  enabled,  then <u>a</u><u>r</u><u>g</u><u>s</u> will only contain those endpoints
                     whose service monitor status entry in  <b>O</b><b>V</b><b>N</b><b>_</b><b>S</b><b>o</b><b>u</b><b>t</b><b>h</b><b>b</b><b>o</b><b>u</b><b>n</b><b>d</b>  db
                     is either <b>o</b><b>n</b><b>l</b><b>i</b><b>n</b><b>e</b> or empty.

              ·      For  all the configured load balancing rules for a router
                     in <b>O</b><b>V</b><b>N</b><b>_</b><b>N</b><b>o</b><b>r</b><b>t</b><b>h</b><b>b</b><b>o</b><b>u</b><b>n</b><b>d</b> database that includes a L4  port  <u>P</u><u>O</u><u>R</u><u>T</u>
                     of  protocol  <u>P</u>  and  IPv4  or IPv6 address <u>V</u><u>I</u><u>P</u>, a prior‐
                     ity-120 flow that matches on <b>c</b><b>t</b><b>.</b><b>e</b><b>s</b><b>t</b> &amp;&amp;&amp;&amp; <b>i</b><b>p</b> &amp;&amp;&amp;&amp;  <b>i</b><b>p</b><b>4</b><b>.</b><b>d</b><b>s</b><b>t</b>  <b>=</b><b>=</b>
                     <u>V</u><u>I</u><u>P</u> &amp;&amp;&amp;&amp; <u>P</u> &amp;&amp;&amp;&amp; <u>P</u><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b><b>=</b> <u>P</u><u>O</u><u>R</u><u>T</u>
                      (<b>i</b><b>p</b><b>6</b><b>.</b><b>d</b><b>s</b><b>t</b>  <b>=</b><b>=</b>  <u>V</u><u>I</u><u>P</u>  in  the  IPv6 case) with an action of
                     <b>c</b><b>t</b><b>_</b><b>d</b><b>n</b><b>a</b><b>t</b><b>;</b>. If the router is configured to force  SNAT  any
                     load-balanced  packets, the above action will be replaced
                     by <b>f</b><b>l</b><b>a</b><b>g</b><b>s</b><b>.</b><b>f</b><b>o</b><b>r</b><b>c</b><b>e</b><b>_</b><b>s</b><b>n</b><b>a</b><b>t</b><b>_</b><b>f</b><b>o</b><b>r</b><b>_</b><b>l</b><b>b</b> <b>=</b> <b>1</b><b>;</b>  <b>c</b><b>t</b><b>_</b><b>d</b><b>n</b><b>a</b><b>t</b><b>;</b>.  If  the  load
                     balancing  rule is configured with <b>s</b><b>k</b><b>i</b><b>p</b><b>_</b><b>s</b><b>n</b><b>a</b><b>t</b> set to true,
                     the    above    action    will     be     replaced     by
                     <b>f</b><b>l</b><b>a</b><b>g</b><b>s</b><b>.</b><b>s</b><b>k</b><b>i</b><b>p</b><b>_</b><b>s</b><b>n</b><b>a</b><b>t</b><b>_</b><b>f</b><b>o</b><b>r</b><b>_</b><b>l</b><b>b</b> <b>=</b> <b>1</b><b>;</b> <b>c</b><b>t</b><b>_</b><b>d</b><b>n</b><b>a</b><b>t</b><b>;</b>.

              ·      For  all the configured load balancing rules for a router
                     in <b>O</b><b>V</b><b>N</b><b>_</b><b>N</b><b>o</b><b>r</b><b>t</b><b>h</b><b>b</b><b>o</b><b>u</b><b>n</b><b>d</b>  database  that  includes  just  an  IP
                     address <u>V</u><u>I</u><u>P</u> to match on, a priority-110 flow that matches
                     on <b>c</b><b>t</b><b>.</b><b>n</b><b>e</b><b>w</b> &amp;&amp;&amp;&amp; <b>i</b><b>p</b> &amp;&amp;&amp;&amp; <b>i</b><b>p</b><b>4</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b><b>=</b> <u>V</u><u>I</u><u>P</u> (<b>i</b><b>p</b><b>6</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b><b>=</b> <u>V</u><u>I</u><u>P</u> in  the
                     IPv6 case) with an action of <b>c</b><b>t</b><b>_</b><b>l</b><b>b</b><b>(</b><u>a</u><u>r</u><u>g</u><u>s</u><b>)</b>, where <u>a</u><u>r</u><u>g</u><u>s</u> con‐
                     tains comma separated IPv4  or  IPv6  addresses.  If  the
                     router  is  configured  to  force  SNAT any load-balanced
                     packets,  the  above   action   will   be   replaced   by
                     <b>f</b><b>l</b><b>a</b><b>g</b><b>s</b><b>.</b><b>f</b><b>o</b><b>r</b><b>c</b><b>e</b><b>_</b><b>s</b><b>n</b><b>a</b><b>t</b><b>_</b><b>f</b><b>o</b><b>r</b><b>_</b><b>l</b><b>b</b>  <b>=</b>  <b>1</b><b>;</b>  <b>c</b><b>t</b><b>_</b><b>l</b><b>b</b><b>(</b><u>a</u><u>r</u><u>g</u><u>s</u><b>)</b><b>;</b>. If the load
                     balancing rule is configured with <b>s</b><b>k</b><b>i</b><b>p</b><b>_</b><b>s</b><b>n</b><b>a</b><b>t</b> set to  true,
                     the     above     action     will    be    replaced    by
                     <b>f</b><b>l</b><b>a</b><b>g</b><b>s</b><b>.</b><b>s</b><b>k</b><b>i</b><b>p</b><b>_</b><b>s</b><b>n</b><b>a</b><b>t</b><b>_</b><b>f</b><b>o</b><b>r</b><b>_</b><b>l</b><b>b</b> <b>=</b> <b>1</b><b>;</b> <b>c</b><b>t</b><b>_</b><b>l</b><b>b</b><b>(</b><u>a</u><u>r</u><u>g</u><u>s</u><b>)</b><b>;</b>.

              ·      For all the configured load balancing rules for a  router
                     in  <b>O</b><b>V</b><b>N</b><b>_</b><b>N</b><b>o</b><b>r</b><b>t</b><b>h</b><b>b</b><b>o</b><b>u</b><b>n</b><b>d</b>  database  that  includes  just  an IP
                     address <u>V</u><u>I</u><u>P</u> to match on, a priority-110 flow that matches
                     on  <b>c</b><b>t</b><b>.</b><b>e</b><b>s</b><b>t</b>  &amp;&amp;&amp;&amp;  <b>i</b><b>p</b>  &amp;&amp;&amp;&amp; <b>i</b><b>p</b><b>4</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b><b>=</b> <u>V</u><u>I</u><u>P</u> (or <b>i</b><b>p</b><b>6</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b><b>=</b> <u>V</u><u>I</u><u>P</u>)
                     with an action of <b>c</b><b>t</b><b>_</b><b>d</b><b>n</b><b>a</b><b>t</b><b>;</b>. If the router  is  configured
                     to force SNAT any load-balanced packets, the above action
                     will  be  replaced  by   <b>f</b><b>l</b><b>a</b><b>g</b><b>s</b><b>.</b><b>f</b><b>o</b><b>r</b><b>c</b><b>e</b><b>_</b><b>s</b><b>n</b><b>a</b><b>t</b><b>_</b><b>f</b><b>o</b><b>r</b><b>_</b><b>l</b><b>b</b>   <b>=</b>   <b>1</b><b>;</b>
                     <b>c</b><b>t</b><b>_</b><b>d</b><b>n</b><b>a</b><b>t</b><b>;</b>.  If  the load balancing rule is configured with
                     <b>s</b><b>k</b><b>i</b><b>p</b><b>_</b><b>s</b><b>n</b><b>a</b><b>t</b> set to true, the above action will be  replaced
                     by <b>f</b><b>l</b><b>a</b><b>g</b><b>s</b><b>.</b><b>s</b><b>k</b><b>i</b><b>p</b><b>_</b><b>s</b><b>n</b><b>a</b><b>t</b><b>_</b><b>f</b><b>o</b><b>r</b><b>_</b><b>l</b><b>b</b> <b>=</b> <b>1</b><b>;</b> <b>c</b><b>t</b><b>_</b><b>d</b><b>n</b><b>a</b><b>t</b><b>;</b>.

              ·      If  the load balancer is created with <b>-</b><b>-</b><b>r</b><b>e</b><b>j</b><b>e</b><b>c</b><b>t</b> option and
                     it has no active backends, a TCP reset segment (for  tcp)
                     or an ICMP port unreachable packet (for all other kind of
                     traffic) will be sent  whenever  an  incoming  packet  is
                     received   for  this  load-balancer.  Please  note  using
                     <b>-</b><b>-</b><b>r</b><b>e</b><b>j</b><b>e</b><b>c</b><b>t</b> option will disable empty_lb SB controller event
                     for this load balancer.

       Ingress Table 6: DNAT on Gateway Routers

              ·      For  each  configuration  in the OVN Northbound database,
                     that asks to change  the  destination  IP  address  of  a
                     packet  from  <u>A</u>  to  <u>B</u>, a priority-100 flow matches <b>i</b><b>p</b> &amp;&amp;&amp;&amp;
                     <b>i</b><b>p</b><b>4</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b><b>=</b> <u>A</u> or  <b>i</b><b>p</b>  &amp;&amp;&amp;&amp;  <b>i</b><b>p</b><b>6</b><b>.</b><b>d</b><b>s</b><b>t</b>  <b>=</b><b>=</b>  <u>A</u>  with  an  action
                     <b>f</b><b>l</b><b>a</b><b>g</b><b>s</b><b>.</b><b>l</b><b>o</b><b>o</b><b>p</b><b>b</b><b>a</b><b>c</b><b>k</b> <b>=</b> <b>1</b><b>;</b> <b>c</b><b>t</b><b>_</b><b>d</b><b>n</b><b>a</b><b>t</b><b>(</b><u>B</u><b>)</b><b>;</b>. If the Gateway router is
                     configured to force SNAT any  DNATed  packet,  the  above
                     action will be replaced by <b>f</b><b>l</b><b>a</b><b>g</b><b>s</b><b>.</b><b>f</b><b>o</b><b>r</b><b>c</b><b>e</b><b>_</b><b>s</b><b>n</b><b>a</b><b>t</b><b>_</b><b>f</b><b>o</b><b>r</b><b>_</b><b>d</b><b>n</b><b>a</b><b>t</b> <b>=</b> <b>1</b><b>;</b>
                     <b>f</b><b>l</b><b>a</b><b>g</b><b>s</b><b>.</b><b>l</b><b>o</b><b>o</b><b>p</b><b>b</b><b>a</b><b>c</b><b>k</b> <b>=</b> <b>1</b><b>;</b> <b>c</b><b>t</b><b>_</b><b>d</b><b>n</b><b>a</b><b>t</b><b>(</b><u>B</u><b>)</b><b>;</b>. If the NAT  rule  is  of
                     type dnat_and_snat and has <b>s</b><b>t</b><b>a</b><b>t</b><b>e</b><b>l</b><b>e</b><b>s</b><b>s</b><b>=</b><b>t</b><b>r</b><b>u</b><b>e</b> in the options,
                     then the action would be <b>i</b><b>p</b><b>4</b><b>/</b><b>6</b><b>.</b><b>d</b><b>s</b><b>t</b><b>=</b> <b>(</b><u>B</u><b>)</b>.

                     If the NAT  rule  has  <b>a</b><b>l</b><b>l</b><b>o</b><b>w</b><b>e</b><b>d</b><b>_</b><b>e</b><b>x</b><b>t</b><b>_</b><b>i</b><b>p</b><b>s</b>  configured,  then
                     there is an additional match <b>i</b><b>p</b><b>4</b><b>.</b><b>s</b><b>r</b><b>c</b> <b>=</b><b>=</b> <u>a</u><u>l</u><u>l</u><u>o</u><u>w</u><u>e</u><u>d</u><b>_</b><u>e</u><u>x</u><u>t</u><b>_</b><u>i</u><u>p</u><u>s</u> .
                     Similarly,  for  IPV6,  match   would   be   <b>i</b><b>p</b><b>6</b><b>.</b><b>s</b><b>r</b><b>c</b>   <b>=</b><b>=</b>
                     <u>a</u><u>l</u><u>l</u><u>o</u><u>w</u><u>e</u><u>d</u><b>_</b><u>e</u><u>x</u><u>t</u><b>_</b><u>i</u><u>p</u><u>s</u>.

                     If  the  NAT rule has <b>e</b><b>x</b><b>e</b><b>m</b><b>p</b><b>t</b><b>e</b><b>d</b><b>_</b><b>e</b><b>x</b><b>t</b><b>_</b><b>i</b><b>p</b><b>s</b> set, then there is
                     an additional flow configured at priority 101.  The  flow
                     matches if source ip is an <b>e</b><b>x</b><b>e</b><b>m</b><b>p</b><b>t</b><b>e</b><b>d</b><b>_</b><b>e</b><b>x</b><b>t</b><b>_</b><b>i</b><b>p</b> and the action
                     is <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b> . This flow is used to bypass the ct_dnat action
                     for a packet originating from <b>e</b><b>x</b><b>e</b><b>m</b><b>p</b><b>t</b><b>e</b><b>d</b><b>_</b><b>e</b><b>x</b><b>t</b><b>_</b><b>i</b><b>p</b><b>s</b>.

              ·      For  all  IP  packets  of a Gateway router, a priority-50
                     flow with an action <b>f</b><b>l</b><b>a</b><b>g</b><b>s</b><b>.</b><b>l</b><b>o</b><b>o</b><b>p</b><b>b</b><b>a</b><b>c</b><b>k</b> <b>=</b> <b>1</b><b>;</b> <b>c</b><b>t</b><b>_</b><b>d</b><b>n</b><b>a</b><b>t</b><b>;</b>.

              ·      A priority-0 logical flow with match <b>1</b> has actions <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>.

       Ingress Table 6: DNAT on Distributed Routers

       On distributed routers, the DNAT table only handles packets with desti‐
       nation IP address that needs to be DNATted from a virtual IP address to
       a real IP address. The unDNAT processing in the  reverse  direction  is
       handled in a separate table in the egress pipeline.

              ·      For  each  configuration  in the OVN Northbound database,
                     that asks to change  the  destination  IP  address  of  a
                     packet  from  <u>A</u>  to  <u>B</u>, a priority-100 flow matches <b>i</b><b>p</b> &amp;&amp;&amp;&amp;
                     <b>i</b><b>p</b><b>4</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b><b>=</b> <u>B</u> &amp;&amp;&amp;&amp; <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b> <b>=</b><b>=</b> <u>G</u><u>W</u>, where  <u>G</u><u>W</u>  is  the  logical
                     router  gateway  port,  with  an  action <b>c</b><b>t</b><b>_</b><b>d</b><b>n</b><b>a</b><b>t</b><b>(</b><u>B</u><b>)</b><b>;</b>. The
                     match will include <b>i</b><b>p</b><b>6</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b><b>=</b> <u>B</u> in the IPv6 case. If  the
                     NAT  rule is of type dnat_and_snat and has <b>s</b><b>t</b><b>a</b><b>t</b><b>e</b><b>l</b><b>e</b><b>s</b><b>s</b><b>=</b><b>t</b><b>r</b><b>u</b><b>e</b>
                     in the options, then the action would be <b>i</b><b>p</b><b>4</b><b>/</b><b>6</b><b>.</b><b>d</b><b>s</b><b>t</b><b>=</b><b>(</b><u>B</u><b>)</b>.

                     If the NAT rule cannot be handled in a  distributed  man‐
                     ner,  then the priority-100 flow above is only programmed
                     on the gateway chassis.

                     If the NAT  rule  has  <b>a</b><b>l</b><b>l</b><b>o</b><b>w</b><b>e</b><b>d</b><b>_</b><b>e</b><b>x</b><b>t</b><b>_</b><b>i</b><b>p</b><b>s</b>  configured,  then
                     there is an additional match <b>i</b><b>p</b><b>4</b><b>.</b><b>s</b><b>r</b><b>c</b> <b>=</b><b>=</b> <u>a</u><u>l</u><u>l</u><u>o</u><u>w</u><u>e</u><u>d</u><b>_</b><u>e</u><u>x</u><u>t</u><b>_</b><u>i</u><u>p</u><u>s</u> .
                     Similarly,  for  IPV6,  match   would   be   <b>i</b><b>p</b><b>6</b><b>.</b><b>s</b><b>r</b><b>c</b>   <b>=</b><b>=</b>
                     <u>a</u><u>l</u><u>l</u><u>o</u><u>w</u><u>e</u><u>d</u><b>_</b><u>e</u><u>x</u><u>t</u><b>_</b><u>i</u><u>p</u><u>s</u>.

                     If  the  NAT rule has <b>e</b><b>x</b><b>e</b><b>m</b><b>p</b><b>t</b><b>e</b><b>d</b><b>_</b><b>e</b><b>x</b><b>t</b><b>_</b><b>i</b><b>p</b><b>s</b> set, then there is
                     an additional flow configured at priority 101.  The  flow
                     matches if source ip is an <b>e</b><b>x</b><b>e</b><b>m</b><b>p</b><b>t</b><b>e</b><b>d</b><b>_</b><b>e</b><b>x</b><b>t</b><b>_</b><b>i</b><b>p</b> and the action
                     is <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b> . This flow is used to bypass the ct_dnat action
                     for a packet originating from <b>e</b><b>x</b><b>e</b><b>m</b><b>p</b><b>t</b><b>e</b><b>d</b><b>_</b><b>e</b><b>x</b><b>t</b><b>_</b><b>i</b><b>p</b><b>s</b>.

                     A priority-0 logical flow with match <b>1</b> has actions <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>.

     <u>I</u><u>n</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>7</u><u>:</u> <u>E</u><u>C</u><u>M</u><u>P</u> <u>s</u><u>y</u><u>m</u><u>m</u><u>e</u><u>t</u><u>r</u><u>i</u><u>c</u> <u>r</u><u>e</u><u>p</u><u>l</u><u>y</u> <u>p</u><u>r</u><u>o</u><u>c</u><u>e</u><u>s</u><u>s</u><u>i</u><u>n</u><u>g</u>

              ·      If ECMP routes with symmetric reply are configured in the
                     <b>O</b><b>V</b><b>N</b><b>_</b><b>N</b><b>o</b><b>r</b><b>t</b><b>h</b><b>b</b><b>o</b><b>u</b><b>n</b><b>d</b> database for a gateway  router,  a  prior‐
                     ity-100  flow is added for each router port on which sym‐
                     metric replies are configured.  The  matching  logic  for
                     these  ports essentially reverses the configured logic of
                     the ECMP route. So for instance, a route with a  destina‐
                     tion  routing  policy will instead match if the source IP
                     address matches the static route’s prefix. The flow  uses
                     the   action   <b>c</b><b>t</b><b>_</b><b>c</b><b>o</b><b>m</b><b>m</b><b>i</b><b>t</b>   <b>{</b>   <b>c</b><b>t</b><b>_</b><b>l</b><b>a</b><b>b</b><b>e</b><b>l</b><b>.</b><b>e</b><b>c</b><b>m</b><b>p</b><b>_</b><b>r</b><b>e</b><b>p</b><b>l</b><b>y</b><b>_</b><b>e</b><b>t</b><b>h</b>  <b>=</b>
                     <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b><b>;</b><b>"</b> <b>"</b> <b>c</b><b>t</b><b>_</b><b>l</b><b>a</b><b>b</b><b>e</b><b>l</b><b>.</b><b>e</b><b>c</b><b>m</b><b>p</b><b>_</b><b>r</b><b>e</b><b>p</b><b>l</b><b>y</b><b>_</b><b>p</b><b>o</b><b>r</b><b>t</b>  <b>=</b>  <u>K</u><b>;</b><b>}</b><b>;</b>  <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>   to
                     commit  the  connection  and storing <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b> and the ECMP
                     reply port binding tunnel key <u>K</u> in the <b>c</b><b>t</b><b>_</b><b>l</b><b>a</b><b>b</b><b>e</b><b>l</b>.

     <u>I</u><u>n</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>8</u><u>:</u> <u>I</u><u>P</u><u>v</u><u>6</u> <u>N</u><u>D</u> <u>R</u><u>A</u> <u>o</u><u>p</u><u>t</u><u>i</u><u>o</u><u>n</u> <u>p</u><u>r</u><u>o</u><u>c</u><u>e</u><u>s</u><u>s</u><u>i</u><u>n</u><u>g</u>

              ·      A priority-50 logical flow  is  added  for  each  logical
                     router  port  configured  with  IPv6  ND RA options which
                     matches IPv6 ND Router Solicitation  packet  and  applies
                     the  action <b>p</b><b>u</b><b>t</b><b>_</b><b>n</b><b>d</b><b>_</b><b>r</b><b>a</b><b>_</b><b>o</b><b>p</b><b>t</b><b>s</b> and advances the packet to the
                     next table.

                     <b>r</b><b>e</b><b>g</b><b>0</b><b>[</b><b>5</b><b>]</b> <b>=</b> <b>p</b><b>u</b><b>t</b><b>_</b><b>n</b><b>d</b><b>_</b><b>r</b><b>a</b><b>_</b><b>o</b><b>p</b><b>t</b><b>s</b><b>(</b><u>o</u><u>p</u><u>t</u><u>i</u><u>o</u><u>n</u><u>s</u>);next;


                     For a valid IPv6 ND RS packet, this transforms the packet
                     into  an  IPv6 ND RA reply and sets the RA options to the
                     packet and stores 1 into  reg0[5].  For  other  kinds  of
                     packets,  it  just  stores 0 into reg0[5]. Either way, it
                     continues to the next table.

              ·      A priority-0 logical flow with match <b>1</b> has actions <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>.

     <u>I</u><u>n</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>9</u><u>:</u> <u>I</u><u>P</u><u>v</u><u>6</u> <u>N</u><u>D</u> <u>R</u><u>A</u> <u>r</u><u>e</u><u>s</u><u>p</u><u>o</u><u>n</u><u>d</u><u>e</u><u>r</u>

       This table implements IPv6 ND RA responder for the IPv6 ND  RA  replies
       generated by the previous table.

              ·      A  priority-50  logical  flow  is  added for each logical
                     router port configured with  IPv6  ND  RA  options  which
                     matches  IPv6 ND RA packets and <b>r</b><b>e</b><b>g</b><b>0</b><b>[</b><b>5</b><b>]</b> <b>=</b><b>=</b> <b>1</b> and responds
                     back to the  <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b>  after  applying  these  actions.  If
                     <b>r</b><b>e</b><b>g</b><b>0</b><b>[</b><b>5</b><b>]</b>   is   set   to  1,  it  means  that  the  action
                     <b>p</b><b>u</b><b>t</b><b>_</b><b>n</b><b>d</b><b>_</b><b>r</b><b>a</b><b>_</b><b>o</b><b>p</b><b>t</b><b>s</b> was successful.

                     <b>e</b><b>t</b><b>h</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b> <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b><b>;</b>
                     <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b> <b>=</b> <u>E</u>;
                     <b>i</b><b>p</b><b>6</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b> <b>i</b><b>p</b><b>6</b><b>.</b><b>s</b><b>r</b><b>c</b><b>;</b>
                     <b>i</b><b>p</b><b>6</b><b>.</b><b>s</b><b>r</b><b>c</b> <b>=</b> <u>I</u>;
                     <b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b> <b>=</b> <u>P</u>;
                     <b>f</b><b>l</b><b>a</b><b>g</b><b>s</b><b>.</b><b>l</b><b>o</b><b>o</b><b>p</b><b>b</b><b>a</b><b>c</b><b>k</b> <b>=</b> <b>1</b><b>;</b>
                     <b>o</b><b>u</b><b>t</b><b>p</b><b>u</b><b>t</b><b>;</b>


                     where <u>E</u> is the MAC address and <u>I</u> is the IPv6  link  local
                     address of the logical router port.

                     (This  terminates  packet processing in ingress pipeline;
                     the packet does not go to the next ingress table.)

              ·      A priority-0 logical flow with match <b>1</b> has actions <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>.

     <u>I</u><u>n</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>1</u><u>0</u><u>:</u> <u>I</u><u>P</u> <u>R</u><u>o</u><u>u</u><u>t</u><u>i</u><u>n</u><u>g</u>

       A packet that arrives at this table is an  IP  packet  that  should  be
       routed  to  the address in <b>i</b><b>p</b><b>4</b><b>.</b><b>d</b><b>s</b><b>t</b> or <b>i</b><b>p</b><b>6</b><b>.</b><b>d</b><b>s</b><b>t</b>. This table implements IP
       routing, setting <b>r</b><b>e</b><b>g</b><b>0</b> (or <b>x</b><b>x</b><b>r</b><b>e</b><b>g</b><b>0</b> for IPv6) to the next-hop  IP  address
       (leaving <b>i</b><b>p</b><b>4</b><b>.</b><b>d</b><b>s</b><b>t</b> or <b>i</b><b>p</b><b>6</b><b>.</b><b>d</b><b>s</b><b>t</b>, the packet’s final destination, unchanged)
       and advances to the next table for ARP resolution. It  also  sets  <b>r</b><b>e</b><b>g</b><b>1</b>
       (or  <b>x</b><b>x</b><b>r</b><b>e</b><b>g</b><b>1</b>)  to  the  IP  address  owned  by  the selected router port
       (ingress table <b>A</b><b>R</b><b>P</b> <b>R</b><b>e</b><b>q</b><b>u</b><b>e</b><b>s</b><b>t</b> will generate an  ARP  request,  if  needed,
       with  <b>r</b><b>e</b><b>g</b><b>0</b> as the target protocol address and <b>r</b><b>e</b><b>g</b><b>1</b> as the source proto‐
       col address).

       For ECMP routes, i.e. multiple static routes with same policy and  pre‐
       fix  but different nexthops, the above actions are deferred to next ta‐
       ble. This table, instead, is responsible for determine the  ECMP  group
       id and select a member id within the group based on 5-tuple hashing. It
       stores group id in <b>r</b><b>e</b><b>g</b><b>8</b><b>[</b><b>0</b><b>.</b><b>.</b><b>1</b><b>5</b><b>]</b> and member id in <b>r</b><b>e</b><b>g</b><b>8</b><b>[</b><b>1</b><b>6</b><b>.</b><b>.</b><b>3</b><b>1</b><b>]</b>. This step
       is  skipped  if  the traffic going out the ECMP route is reply traffic,
       and the ECMP route was configured to use  symmetric  replies.  Instead,
       the  stored <b>c</b><b>t</b><b>_</b><b>l</b><b>a</b><b>b</b><b>e</b><b>l</b> value is used to choose the destination. The least
       significant 48 bits of the <b>c</b><b>t</b><b>_</b><b>l</b><b>a</b><b>b</b><b>e</b><b>l</b> tell the destination MAC address to
       which  the  packet  should  be  sent. The next 16 bits tell the logical
       router port on which the packet should be sent.  These  values  in  the
       <b>c</b><b>t</b><b>_</b><b>l</b><b>a</b><b>b</b><b>e</b><b>l</b>  are set when the initial ingress traffic is received over the
       ECMP route.

       This table contains the following logical flows:

              ·      Priority-550  flow  that  drops  IPv6  Router   Solicita‐
                     tion/Advertisement  packets  that  were  not processed in
                     previous tables.

              ·      Priority-500 flows that match IP multicast  traffic  des‐
                     tined  to  groups  registered  on  any  of  the  attached
                     switches and sets <b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b>  to  the  associated  multicast
                     group  that  will  eventually  flood  the  traffic to all
                     interested attached  logical  switches.  The  flows  also
                     decrement TTL.

              ·      Priority-450  flow that matches unregistered IP multicast
                     traffic and  sets  <b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b>  to  the  <b>M</b><b>C</b><b>_</b><b>S</b><b>T</b><b>A</b><b>T</b><b>I</b><b>C</b>  multicast
                     group,  which <b>o</b><b>v</b><b>n</b><b>-</b><b>n</b><b>o</b><b>r</b><b>t</b><b>h</b><b>d</b> populates with the logical ports
                     that have <b>o</b><b>p</b><b>t</b><b>i</b><b>o</b><b>n</b><b>s</b> <b>:</b><b>m</b><b>c</b><b>a</b><b>s</b><b>t</b><b>_</b><b>f</b><b>l</b><b>o</b><b>o</b><b>d</b><b>=</b><b>’</b><b>t</b><b>r</b><b>u</b><b>e</b><b>’</b>. If no router ports
                     are configured to flood multicast traffic the packets are
                     dropped.

              ·      IPv4 routing table. For each route to IPv4 network <u>N</u> with
                     netmask  <u>M</u>, on router port <u>P</u> with IP address <u>A</u> and Ether‐
                     net address <u>E</u>, a logical flow with match <b>i</b><b>p</b><b>4</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b><b>=</b>  <u>N</u><b>/</b><u>M</u>,
                     whose priority is the number of 1-bits in <u>M</u>, has the fol‐
                     lowing actions:

                     <b>i</b><b>p</b><b>.</b><b>t</b><b>t</b><b>l</b><b>-</b><b>-</b><b>;</b>
                     <b>r</b><b>e</b><b>g</b><b>8</b><b>[</b><b>0</b><b>.</b><b>.</b><b>1</b><b>5</b><b>]</b> <b>=</b> <b>0</b><b>;</b>
                     <b>r</b><b>e</b><b>g</b><b>0</b> <b>=</b> <u>G</u>;
                     <b>r</b><b>e</b><b>g</b><b>1</b> <b>=</b> <u>A</u>;
                     <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b> <b>=</b> <u>E</u>;
                     <b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b> <b>=</b> <u>P</u>;
                     <b>f</b><b>l</b><b>a</b><b>g</b><b>s</b><b>.</b><b>l</b><b>o</b><b>o</b><b>p</b><b>b</b><b>a</b><b>c</b><b>k</b> <b>=</b> <b>1</b><b>;</b>
                     <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>


                     (Ingress table 1 already verified that <b>i</b><b>p</b><b>.</b><b>t</b><b>t</b><b>l</b><b>-</b><b>-</b><b>;</b> will not
                     yield a TTL exceeded error.)

                     If  the route has a gateway, <u>G</u> is the gateway IP address.
                     Instead, if the route is from a configured static  route,
                     <u>G</u> is the next hop IP address. Else it is <b>i</b><b>p</b><b>4</b><b>.</b><b>d</b><b>s</b><b>t</b>.

              ·      IPv6 routing table. For each route to IPv6 network <u>N</u> with
                     netmask <u>M</u>, on router port <u>P</u> with IP address <u>A</u> and  Ether‐
                     net address <u>E</u>, a logical flow with match in CIDR notation
                     <b>i</b><b>p</b><b>6</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b><b>=</b> <u>N</u><b>/</b><u>M</u>, whose priority is the integer value of <u>M</u>,
                     has the following actions:

                     <b>i</b><b>p</b><b>.</b><b>t</b><b>t</b><b>l</b><b>-</b><b>-</b><b>;</b>
                     <b>r</b><b>e</b><b>g</b><b>8</b><b>[</b><b>0</b><b>.</b><b>.</b><b>1</b><b>5</b><b>]</b> <b>=</b> <b>0</b><b>;</b>
                     <b>x</b><b>x</b><b>r</b><b>e</b><b>g</b><b>0</b> <b>=</b> <u>G</u>;
                     <b>x</b><b>x</b><b>r</b><b>e</b><b>g</b><b>1</b> <b>=</b> <u>A</u>;
                     <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b> <b>=</b> <u>E</u>;
                     <b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b> <b>=</b> <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b><b>;</b>
                     <b>f</b><b>l</b><b>a</b><b>g</b><b>s</b><b>.</b><b>l</b><b>o</b><b>o</b><b>p</b><b>b</b><b>a</b><b>c</b><b>k</b> <b>=</b> <b>1</b><b>;</b>
                     <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>


                     (Ingress table 1 already verified that <b>i</b><b>p</b><b>.</b><b>t</b><b>t</b><b>l</b><b>-</b><b>-</b><b>;</b> will not
                     yield a TTL exceeded error.)

                     If the route has a gateway, <u>G</u> is the gateway IP  address.
                     Instead,  if the route is from a configured static route,
                     <u>G</u> is the next hop IP address. Else it is <b>i</b><b>p</b><b>6</b><b>.</b><b>d</b><b>s</b><b>t</b>.

                     If the address <u>A</u> is in the link-local  scope,  the  route
                     will be limited to sending on the ingress port.

              ·      For  ECMP  routes, they are grouped by policy and prefix.
                     An unique id (non-zero) is assigned to  each  group,  and
                     each  member  is  also  assigned  an unique id (non-zero)
                     within each group.

                     For each IPv4/IPv6 ECMP group with group id <u>G</u><u>I</u><u>D</u> and  mem‐
                     ber  ids  <u>M</u><u>I</u><u>D</u><u>1</u>,  <u>M</u><u>I</u><u>D</u><u>2</u>,  ..., a logical flow with match in
                     CIDR notation <b>i</b><b>p</b><b>4</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b><b>=</b> <u>N</u><b>/</b><u>M</u>, or <b>i</b><b>p</b><b>6</b><b>.</b><b>d</b><b>s</b><b>t</b>  <b>=</b><b>=</b>  <u>N</u><b>/</b><u>M</u>,  whose
                     priority  is  the  integer  value of <u>M</u>, has the following
                     actions:

                     <b>i</b><b>p</b><b>.</b><b>t</b><b>t</b><b>l</b><b>-</b><b>-</b><b>;</b>
                     <b>f</b><b>l</b><b>a</b><b>g</b><b>s</b><b>.</b><b>l</b><b>o</b><b>o</b><b>p</b><b>b</b><b>a</b><b>c</b><b>k</b> <b>=</b> <b>1</b><b>;</b>
                     <b>r</b><b>e</b><b>g</b><b>8</b><b>[</b><b>0</b><b>.</b><b>.</b><b>1</b><b>5</b><b>]</b> <b>=</b> <u>G</u><u>I</u><u>D</u>;
                     <b>s</b><b>e</b><b>l</b><b>e</b><b>c</b><b>t</b><b>(</b><b>r</b><b>e</b><b>g</b><b>8</b><b>[</b><b>1</b><b>6</b><b>.</b><b>.</b><b>3</b><b>1</b><b>]</b><b>,</b> <u>M</u><u>I</u><u>D</u><u>1</u>, <u>M</u><u>I</u><u>D</u><u>2</u>, ...);


     <u>I</u><u>n</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>1</u><u>1</u><u>:</u> <u>I</u><u>P</u><b>_</b><u>R</u><u>O</u><u>U</u><u>T</u><u>I</u><u>N</u><u>G</u><b>_</b><u>E</u><u>C</u><u>M</u><u>P</u>

       This table implements the second part of IP  routing  for  ECMP  routes
       following  the  previous table. If a packet matched a ECMP group in the
       previous table, this table matches the group id and  member  id  stored
       from the previous table, setting <b>r</b><b>e</b><b>g</b><b>0</b> (or <b>x</b><b>x</b><b>r</b><b>e</b><b>g</b><b>0</b> for IPv6) to the next-
       hop IP address (leaving <b>i</b><b>p</b><b>4</b><b>.</b><b>d</b><b>s</b><b>t</b> or <b>i</b><b>p</b><b>6</b><b>.</b><b>d</b><b>s</b><b>t</b>, the packet’s final destina‐
       tion,  unchanged) and advances to the next table for ARP resolution. It
       also sets <b>r</b><b>e</b><b>g</b><b>1</b> (or <b>x</b><b>x</b><b>r</b><b>e</b><b>g</b><b>1</b>) to the IP  address  owned  by  the  selected
       router port (ingress table <b>A</b><b>R</b><b>P</b> <b>R</b><b>e</b><b>q</b><b>u</b><b>e</b><b>s</b><b>t</b> will generate an ARP request, if
       needed, with <b>r</b><b>e</b><b>g</b><b>0</b> as the target protocol address and <b>r</b><b>e</b><b>g</b><b>1</b> as the source
       protocol address).

       This  processing is skipped for reply traffic being sent out of an ECMP
       route if the route was configured to use symmetric replies.

       This table contains the following logical flows:

              ·      A priority-150 flow that matches <b>r</b><b>e</b><b>g</b><b>8</b><b>[</b><b>0</b><b>.</b><b>.</b><b>1</b><b>5</b><b>]</b>  <b>=</b><b>=</b>  <b>0</b>  with
                     action   <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>  directly  bypasses  packets  of  non-ECMP
                     routes.

              ·      For each member with ID <u>M</u><u>I</u><u>D</u> in each ECMP  group  with  ID
                     <u>G</u><u>I</u><u>D</u>, a priority-100 flow with match <b>r</b><b>e</b><b>g</b><b>8</b><b>[</b><b>0</b><b>.</b><b>.</b><b>1</b><b>5</b><b>]</b> <b>=</b><b>=</b> <u>G</u><u>I</u><u>D</u> &amp;&amp;&amp;&amp;
                     <b>r</b><b>e</b><b>g</b><b>8</b><b>[</b><b>1</b><b>6</b><b>.</b><b>.</b><b>3</b><b>1</b><b>]</b> <b>=</b><b>=</b> <u>M</u><u>I</u><u>D</u> has following actions:

                     <b>[</b><b>x</b><b>x</b><b>]</b><b>r</b><b>e</b><b>g</b><b>0</b> <b>=</b> <u>G</u>;
                     <b>[</b><b>x</b><b>x</b><b>]</b><b>r</b><b>e</b><b>g</b><b>1</b> <b>=</b> <u>A</u>;
                     <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b> <b>=</b> <u>E</u>;
                     <b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b> <b>=</b> <u>P</u>;


     <u>I</u><u>n</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>1</u><u>2</u><u>:</u> <u>R</u><u>o</u><u>u</u><u>t</u><u>e</u><u>r</u> <u>p</u><u>o</u><u>l</u><u>i</u><u>c</u><u>i</u><u>e</u><u>s</u>

       This table adds flows for the logical router policies configured on the
       logical   router.   Please   see   the  <b>O</b><b>V</b><b>N</b><b>_</b><b>N</b><b>o</b><b>r</b><b>t</b><b>h</b><b>b</b><b>o</b><b>u</b><b>n</b><b>d</b>  database  <b>L</b><b>o</b><b>g</b><b>i</b><b>‐</b>
       <b>c</b><b>a</b><b>l</b><b>_</b><b>R</b><b>o</b><b>u</b><b>t</b><b>e</b><b>r</b><b>_</b><b>P</b><b>o</b><b>l</b><b>i</b><b>c</b><b>y</b> table documentation in <b>o</b><b>v</b><b>n</b><b>-</b><b>n</b><b>b</b> for supported actions.

              ·      For each router policy configured on the logical  router,
                     a  logical  flow  is added with specified priority, match
                     and actions.

              ·      If the policy action is <b>r</b><b>e</b><b>r</b><b>o</b><b>u</b><b>t</b><b>e</b> with 2 or  more  nexthops
                     defined,  then the logical flow is added with the follow‐
                     ing actions:

                     <b>r</b><b>e</b><b>g</b><b>8</b><b>[</b><b>0</b><b>.</b><b>.</b><b>1</b><b>5</b><b>]</b> <b>=</b> <u>G</u><u>I</u><u>D</u>;
                     <b>r</b><b>e</b><b>g</b><b>8</b><b>[</b><b>1</b><b>6</b><b>.</b><b>.</b><b>3</b><b>1</b><b>]</b> <b>=</b> <b>s</b><b>e</b><b>l</b><b>e</b><b>c</b><b>t</b><b>(</b><b>1</b><b>,</b><b>.</b><b>.</b><b>n</b><b>)</b><b>;</b>


                     where <u>G</u><u>I</u><u>D</u> is the ECMP group id  generated  by  <b>o</b><b>v</b><b>n</b><b>-</b><b>n</b><b>o</b><b>r</b><b>t</b><b>h</b><b>d</b>
                     for  this  policy and <u>n</u> is the number of nexthops. <b>s</b><b>e</b><b>l</b><b>e</b><b>c</b><b>t</b>
                     action selects one of the nexthop member id, stores it in
                     the  register <b>r</b><b>e</b><b>g</b><b>8</b><b>[</b><b>1</b><b>6</b><b>.</b><b>.</b><b>3</b><b>1</b><b>]</b> and advances the packet to the
                     next stage.

              ·      If the policy action is <b>r</b><b>e</b><b>r</b><b>o</b><b>u</b><b>t</b><b>e</b>  with  just  one  nexhop,
                     then  the  logical  flow  is  added  with  the  following
                     actions:

                     <b>[</b><b>x</b><b>x</b><b>]</b><b>r</b><b>e</b><b>g</b><b>0</b> <b>=</b> <u>H</u>;
                     <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b> <b>=</b> <u>E</u>;
                     <b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b> <b>=</b> <u>P</u>;
                     <b>r</b><b>e</b><b>g</b><b>8</b><b>[</b><b>0</b><b>.</b><b>.</b><b>1</b><b>5</b><b>]</b> <b>=</b> <b>0</b><b>;</b>
                     <b>f</b><b>l</b><b>a</b><b>g</b><b>s</b><b>.</b><b>l</b><b>o</b><b>o</b><b>p</b><b>b</b><b>a</b><b>c</b><b>k</b> <b>=</b> <b>1</b><b>;</b>
                     <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>


                     where <u>H</u> is the <b>n</b><b>e</b><b>x</b><b>t</b><b>h</b><b>o</b><b>p</b>  defined in the router  policy,  <u>E</u>
                     is  the  ethernet address of the logical router port from
                     which the <b>n</b><b>e</b><b>x</b><b>t</b><b>h</b><b>o</b><b>p</b> is  reachable  and  <u>P</u>  is  the  logical
                     router port from which the <b>n</b><b>e</b><b>x</b><b>t</b><b>h</b><b>o</b><b>p</b> is reachable.

              ·      If  a  router policy has the option <b>p</b><b>k</b><b>t</b><b>_</b><b>m</b><b>a</b><b>r</b><b>k</b><b>=</b><u>m</u> set and if
                     the action is <b>n</b><b>o</b><b>t</b> drop, then  the  action  also  includes
                     <b>p</b><b>k</b><b>t</b><b>.</b><b>m</b><b>a</b><b>r</b><b>k</b> <b>=</b> <u>m</u> to mark the packet with the marker <u>m</u>.

     <u>I</u><u>n</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>1</u><u>3</u><u>:</u> <u>E</u><u>C</u><u>M</u><u>P</u> <u>h</u><u>a</u><u>n</u><u>d</u><u>l</u><u>i</u><u>n</u><u>g</u> <u>f</u><u>o</u><u>r</u> <u>r</u><u>o</u><u>u</u><u>t</u><u>e</u><u>r</u> <u>p</u><u>o</u><u>l</u><u>i</u><u>c</u><u>i</u><u>e</u><u>s</u>

       This  table  handles  the  ECMP for the router policies configured with
       multiple nexthops.

              ·      A priority-150 flow is added to advance the packet to the
                     next  stage  if the ECMP group id register <b>r</b><b>e</b><b>g</b><b>8</b><b>[</b><b>0</b><b>.</b><b>.</b><b>1</b><b>5</b><b>]</b> is
                     0.

              ·      For each ECMP reroute router policy  with  multiple  nex‐
                     thops,  a  priority-100  flow is added for each nexthop <u>H</u>
                     with the match <b>r</b><b>e</b><b>g</b><b>8</b><b>[</b><b>0</b><b>.</b><b>.</b><b>1</b><b>5</b><b>]</b> <b>=</b><b>=</b> <u>G</u><u>I</u><u>D</u> &amp;&amp;&amp;&amp;  <b>r</b><b>e</b><b>g</b><b>8</b><b>[</b><b>1</b><b>6</b><b>.</b><b>.</b><b>3</b><b>1</b><b>]</b>  <b>=</b><b>=</b>  <u>M</u>
                     where  <u>G</u><u>I</u><u>D</u>  is  the  router  policy group id generated by
                     <b>o</b><b>v</b><b>n</b><b>-</b><b>n</b><b>o</b><b>r</b><b>t</b><b>h</b><b>d</b> and <u>M</u> is the member id of the nexthop <u>H</u> gener‐
                     ated  by  <b>o</b><b>v</b><b>n</b><b>-</b><b>n</b><b>o</b><b>r</b><b>t</b><b>h</b><b>d</b>.  The following actions are added to
                     the flow:

                     <b>[</b><b>x</b><b>x</b><b>]</b><b>r</b><b>e</b><b>g</b><b>0</b> <b>=</b> <u>H</u>;
                     <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b> <b>=</b> <u>E</u>;
                     <b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b> <b>=</b> <u>P</u>
                     <b>"</b><b>f</b><b>l</b><b>a</b><b>g</b><b>s</b><b>.</b><b>l</b><b>o</b><b>o</b><b>p</b><b>b</b><b>a</b><b>c</b><b>k</b> <b>=</b> <b>1</b><b>;</b> <b>"</b>
                     <b>"</b><b>n</b><b>e</b><b>x</b><b>t</b><b>;</b><b>"</b>


                     where <u>H</u> is the <b>n</b><b>e</b><b>x</b><b>t</b><b>h</b><b>o</b><b>p</b>  defined in the router  policy,  <u>E</u>
                     is  the  ethernet address of the logical router port from
                     which the <b>n</b><b>e</b><b>x</b><b>t</b><b>h</b><b>o</b><b>p</b> is  reachable  and  <u>P</u>  is  the  logical
                     router port from which the <b>n</b><b>e</b><b>x</b><b>t</b><b>h</b><b>o</b><b>p</b> is reachable.

     <u>I</u><u>n</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>1</u><u>4</u><u>:</u> <u>A</u><u>R</u><u>P</u><u>/</u><u>N</u><u>D</u> <u>R</u><u>e</u><u>s</u><u>o</u><u>l</u><u>u</u><u>t</u><u>i</u><u>o</u><u>n</u>

       Any  packet that reaches this table is an IP packet whose next-hop IPv4
       address is in <b>r</b><b>e</b><b>g</b><b>0</b> or IPv6 address is in <b>x</b><b>x</b><b>r</b><b>e</b><b>g</b><b>0</b>.  (<b>i</b><b>p</b><b>4</b><b>.</b><b>d</b><b>s</b><b>t</b>  or  <b>i</b><b>p</b><b>6</b><b>.</b><b>d</b><b>s</b><b>t</b>
       contains  the final destination.) This table resolves the IP address in
       <b>r</b><b>e</b><b>g</b><b>0</b> (or <b>x</b><b>x</b><b>r</b><b>e</b><b>g</b><b>0</b>) into an output port in <b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b> and an Ethernet address
       in <b>e</b><b>t</b><b>h</b><b>.</b><b>d</b><b>s</b><b>t</b>, using the following flows:

              ·      A  priority-500  flow  that  matches IP multicast traffic
                     that was allowed in the routing pipeline. For  this  kind
                     of  traffic  the <b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b> was already set so the flow just
                     advances to the next table.

              ·      Static MAC bindings. MAC bindings can be known statically
                     based  on data in the <b>O</b><b>V</b><b>N</b><b>_</b><b>N</b><b>o</b><b>r</b><b>t</b><b>h</b><b>b</b><b>o</b><b>u</b><b>n</b><b>d</b> database. For router
                     ports connected to logical switches, MAC bindings can  be
                     known  statically  from the <b>a</b><b>d</b><b>d</b><b>r</b><b>e</b><b>s</b><b>s</b><b>e</b><b>s</b> column in the <b>L</b><b>o</b><b>g</b><b>i</b><b>‐</b>
                     <b>c</b><b>a</b><b>l</b><b>_</b><b>S</b><b>w</b><b>i</b><b>t</b><b>c</b><b>h</b><b>_</b><b>P</b><b>o</b><b>r</b><b>t</b> table.  For  router  ports  connected  to
                     other  logical  routers, MAC bindings can be known stati‐
                     cally from the <b>m</b><b>a</b><b>c</b>  and  <b>n</b><b>e</b><b>t</b><b>w</b><b>o</b><b>r</b><b>k</b><b>s</b>  column  in  the  <b>L</b><b>o</b><b>g</b><b>i</b><b>‐</b>
                     <b>c</b><b>a</b><b>l</b><b>_</b><b>R</b><b>o</b><b>u</b><b>t</b><b>e</b><b>r</b><b>_</b><b>P</b><b>o</b><b>r</b><b>t</b>  table.  (Note: the flow is NOT installed
                     for the IP addresses that belong to  a  neighbor  logical
                     router    port    if   the   current   router   has   the
                     <b>o</b><b>p</b><b>t</b><b>i</b><b>o</b><b>n</b><b>s</b><b>:</b><b>d</b><b>y</b><b>n</b><b>a</b><b>m</b><b>i</b><b>c</b><b>_</b><b>n</b><b>e</b><b>i</b><b>g</b><b>h</b><b>_</b><b>r</b><b>o</b><b>u</b><b>t</b><b>e</b><b>r</b><b>s</b> set to <b>t</b><b>r</b><b>u</b><b>e</b>)

                     For each IPv4 address <u>A</u> whose host is known to have  Eth‐
                     ernet  address  <u>E</u>  on  router port <u>P</u>, a priority-100 flow
                     with match <b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b> <b>=</b><b>=</b><b>=</b> <u>P</u> &amp;&amp;&amp;&amp; <b>r</b><b>e</b><b>g</b><b>0</b> <b>=</b><b>=</b> <u>A</u> has actions <b>e</b><b>t</b><b>h</b><b>.</b><b>d</b><b>s</b><b>t</b>
                     <b>=</b> <u>E</u><b>;</b> <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>.

                     For  each  virtual  ip  <u>A</u> configured on a logical port of
                     type <b>v</b><b>i</b><b>r</b><b>t</b><b>u</b><b>a</b><b>l</b> and its virtual parent  set  in  its  corre‐
                     sponding  <b>P</b><b>o</b><b>r</b><b>t</b><b>_</b><b>B</b><b>i</b><b>n</b><b>d</b><b>i</b><b>n</b><b>g</b> record and the virtual parent with
                     the Ethernet address <u>E</u> and the virtual  ip  is  reachable
                     via  the  router  port  <u>P</u>, a priority-100 flow with match
                     <b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b> <b>=</b><b>=</b><b>=</b> <u>P</u> &amp;&amp;&amp;&amp; <b>r</b><b>e</b><b>g</b><b>0</b> <b>=</b><b>=</b>  <u>A</u>  has  actions  <b>e</b><b>t</b><b>h</b><b>.</b><b>d</b><b>s</b><b>t</b>  <b>=</b>  <u>E</u><b>;</b>
                     <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>.

                     For  each  virtual  ip  <u>A</u> configured on a logical port of
                     type <b>v</b><b>i</b><b>r</b><b>t</b><b>u</b><b>a</b><b>l</b> and its virtual parent <b>n</b><b>o</b><b>t</b> set in its corre‐
                     sponding  <b>P</b><b>o</b><b>r</b><b>t</b><b>_</b><b>B</b><b>i</b><b>n</b><b>d</b><b>i</b><b>n</b><b>g</b>  record  and  the  virtual ip <u>A</u> is
                     reachable via the router port <u>P</u>, a priority-100 flow with
                     match  <b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b>  <b>=</b><b>=</b><b>=</b>  <u>P</u> &amp;&amp;&amp;&amp; <b>r</b><b>e</b><b>g</b><b>0</b> <b>=</b><b>=</b> <u>A</u> has actions <b>e</b><b>t</b><b>h</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b>
                     <u>0</u><u>0</u><u>:</u><u>0</u><u>0</u><u>:</u><u>0</u><u>0</u><u>:</u><u>0</u><u>0</u><u>:</u><u>0</u><u>0</u><u>:</u><u>0</u><u>0</u><b>;</b> <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>. This flow is added so that  the
                     ARP is always resolved for the virtual ip <u>A</u> by generating
                     ARP request and <b>n</b><b>o</b><b>t</b> consulting the MAC_Binding  table  as
                     it can have incorrect value for the virtual ip <u>A</u>.

                     For  each IPv6 address <u>A</u> whose host is known to have Eth‐
                     ernet address <u>E</u> on router port  <u>P</u>,  a  priority-100  flow
                     with  match  <b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b>  <b>=</b><b>=</b><b>=</b>  <u>P</u>  &amp;&amp;&amp;&amp;  <b>x</b><b>x</b><b>r</b><b>e</b><b>g</b><b>0</b> <b>=</b><b>=</b> <u>A</u> has actions
                     <b>e</b><b>t</b><b>h</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b> <u>E</u><b>;</b> <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>.

                     For each logical router port with an IPv4 address <u>A</u> and a
                     mac  address of <u>E</u> that is reachable via a different logi‐
                     cal router port <u>P</u>, a priority-100 flow with match <b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b>
                     <b>=</b><b>=</b><b>=</b> <u>P</u> &amp;&amp;&amp;&amp; <b>r</b><b>e</b><b>g</b><b>0</b> <b>=</b><b>=</b> <u>A</u> has actions <b>e</b><b>t</b><b>h</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b> <u>E</u><b>;</b> <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>.

                     For each logical router port with an IPv6 address <u>A</u> and a
                     mac address of <u>E</u> that is reachable via a different  logi‐
                     cal router port <u>P</u>, a priority-100 flow with match <b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b>
                     <b>=</b><b>=</b><b>=</b> <u>P</u> &amp;&amp;&amp;&amp; <b>x</b><b>x</b><b>r</b><b>e</b><b>g</b><b>0</b> <b>=</b><b>=</b> <u>A</u> has actions <b>e</b><b>t</b><b>h</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b> <u>E</u><b>;</b> <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>.

              ·      Static MAC bindings from NAT entries.  MAC  bindings  can
                     also  be  known  for  the entries in the <b>N</b><b>A</b><b>T</b> table. Below
                     flows are programmed for distributed logical routers  i.e
                     with a distributed router port.

                     For  each row in the <b>N</b><b>A</b><b>T</b> table with IPv4 address <u>A</u> in the
                     <b>e</b><b>x</b><b>t</b><b>e</b><b>r</b><b>n</b><b>a</b><b>l</b><b>_</b><b>i</b><b>p</b> column of <b>N</b><b>A</b><b>T</b> table, a priority-100 flow with
                     the  match <b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b> <b>=</b><b>=</b><b>=</b> <u>P</u> &amp;&amp;&amp;&amp; <b>r</b><b>e</b><b>g</b><b>0</b> <b>=</b><b>=</b> <u>A</u> has actions <b>e</b><b>t</b><b>h</b><b>.</b><b>d</b><b>s</b><b>t</b>
                     <b>=</b> <u>E</u><b>;</b> <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>, where <b>P</b> is  the  distributed  logical  router
                     port,  <u>E</u>  is  the  Ethernet  address if set in the <b>e</b><b>x</b><b>t</b><b>e</b><b>r</b><b>‐</b>
                     <b>n</b><b>a</b><b>l</b><b>_</b><b>m</b><b>a</b><b>c</b> column of <b>N</b><b>A</b><b>T</b> table for  of  type  <b>d</b><b>n</b><b>a</b><b>t</b><b>_</b><b>a</b><b>n</b><b>d</b><b>_</b><b>s</b><b>n</b><b>a</b><b>t</b>,
                     otherwise the Ethernet address of the distributed logical
                     router port.

                     For IPv6 NAT entries, same flows are added, but using the
                     register <b>x</b><b>x</b><b>r</b><b>e</b><b>g</b><b>0</b> for the match.

              ·      Traffic  with  IP  destination  an  address  owned by the
                     router  should  be  dropped.  Such  traffic  is  normally
                     dropped in ingress table <b>I</b><b>P</b> <b>I</b><b>n</b><b>p</b><b>u</b><b>t</b> except for IPs that are
                     also shared with SNAT rules. However,  if  there  was  no
                     unSNAT  operation  that  happened successfully until this
                     point in the pipeline  and  the  destination  IP  of  the
                     packet  is  still  a  router owned IP, the packets can be
                     safely dropped.

                     A priority-1 logical  flow  with  match  <b>i</b><b>p</b><b>4</b><b>.</b><b>d</b><b>s</b><b>t</b>  <b>=</b>  <b>{</b><b>.</b><b>.</b><b>}</b>
                     matches   on   traffic  destined  to  router  owned  IPv4
                     addresses which are also SNAT IPs. This flow  has  action
                     <b>d</b><b>r</b><b>o</b><b>p</b><b>;</b>.

                     A  priority-1  logical  flow  with  match  <b>i</b><b>p</b><b>6</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b> <b>{</b><b>.</b><b>.</b><b>}</b>
                     matches  on  traffic  destined  to  router   owned   IPv6
                     addresses  which  are also SNAT IPs. This flow has action
                     <b>d</b><b>r</b><b>o</b><b>p</b><b>;</b>.

              ·      Dynamic MAC bindings. These flows resolve MAC-to-IP bind‐
                     ings  that  have  become known dynamically through ARP or
                     neighbor discovery. (The ingress table <b>A</b><b>R</b><b>P</b>  <b>R</b><b>e</b><b>q</b><b>u</b><b>e</b><b>s</b><b>t</b>  will
                     issue  an  ARP or neighbor solicitation request for cases
                     where the binding is not yet known.)

                     A priority-0 logical flow  with  match  <b>i</b><b>p</b><b>4</b>  has  actions
                     <b>g</b><b>e</b><b>t</b><b>_</b><b>a</b><b>r</b><b>p</b><b>(</b><b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b><b>,</b> <b>r</b><b>e</b><b>g</b><b>0</b><b>)</b><b>;</b> <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>.

                     A  priority-0  logical  flow  with  match <b>i</b><b>p</b><b>6</b> has actions
                     <b>g</b><b>e</b><b>t</b><b>_</b><b>n</b><b>d</b><b>(</b><b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b><b>,</b> <b>x</b><b>x</b><b>r</b><b>e</b><b>g</b><b>0</b><b>)</b><b>;</b> <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>.

              ·      For a distributed gateway LRP with <b>r</b><b>e</b><b>d</b><b>i</b><b>r</b><b>e</b><b>c</b><b>t</b><b>-</b><b>t</b><b>y</b><b>p</b><b>e</b>  set  to
                     <b>b</b><b>r</b><b>i</b><b>d</b><b>g</b><b>e</b><b>d</b>,   a  priority-50  flow  will  match  <b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b>  <b>=</b><b>=</b>
                     <b>"</b><b>R</b><b>O</b><b>U</b><b>T</b><b>E</b><b>R</b><b>_</b><b>P</b><b>O</b><b>R</b><b>T</b><b>"</b> <b>a</b><b>n</b><b>d</b> <b>!</b><b>i</b><b>s</b><b>_</b><b>c</b><b>h</b><b>a</b><b>s</b><b>s</b><b>i</b><b>s</b><b>_</b><b>r</b><b>e</b><b>s</b><b>i</b><b>d</b><b>e</b><b>n</b><b>t</b> <b>(</b><b>"</b><b>c</b><b>r</b><b>-</b><b>R</b><b>O</b><b>U</b><b>T</b><b>E</b><b>R</b><b>_</b><b>P</b><b>O</b><b>R</b><b>T</b><b>"</b><b>)</b>
                     has  actions  <b>e</b><b>t</b><b>h</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b> <u>E</u><b>;</b> <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>, where <u>E</u> is the ethernet
                     address of the logical router port.

     <u>I</u><u>n</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>1</u><u>5</u><u>:</u> <u>C</u><u>h</u><u>e</u><u>c</u><u>k</u> <u>p</u><u>a</u><u>c</u><u>k</u><u>e</u><u>t</u> <u>l</u><u>e</u><u>n</u><u>g</u><u>t</u><u>h</u>

       For distributed logical routers with distributed gateway  port  config‐
       ured with <b>o</b><b>p</b><b>t</b><b>i</b><b>o</b><b>n</b><b>s</b><b>:</b><b>g</b><b>a</b><b>t</b><b>e</b><b>w</b><b>a</b><b>y</b><b>_</b><b>m</b><b>t</b><b>u</b> to a valid integer value, this table adds
       a priority-50 logical flow with the match <b>i</b><b>p</b><b>4</b>  &amp;&amp;&amp;&amp;  <b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b>  <b>=</b><b>=</b>  <u>G</u><u>W</u><b>_</b><u>P</u><u>O</u><u>R</u><u>T</u>
       where  <u>G</u><u>W</u><b>_</b><u>P</u><u>O</u><u>R</u><u>T</u>  is  the distributed gateway router port and applies the
       action <b>c</b><b>h</b><b>e</b><b>c</b><b>k</b><b>_</b><b>p</b><b>k</b><b>t</b><b>_</b><b>l</b><b>a</b><b>r</b><b>g</b><b>e</b><b>r</b> and advances the packet to the next table.

       <b>R</b><b>E</b><b>G</b><b>B</b><b>I</b><b>T</b><b>_</b><b>P</b><b>K</b><b>T</b><b>_</b><b>L</b><b>A</b><b>R</b><b>G</b><b>E</b><b>R</b> <b>=</b> <b>c</b><b>h</b><b>e</b><b>c</b><b>k</b><b>_</b><b>p</b><b>k</b><b>t</b><b>_</b><b>l</b><b>a</b><b>r</b><b>g</b><b>e</b><b>r</b><b>(</b><u>L</u>); next;


       where <u>L</u> is the packet length to check for. If the packet is larger than
       <u>L</u>, it stores 1 in the register bit <b>R</b><b>E</b><b>G</b><b>B</b><b>I</b><b>T</b><b>_</b><b>P</b><b>K</b><b>T</b><b>_</b><b>L</b><b>A</b><b>R</b><b>G</b><b>E</b><b>R</b>. The value of <u>L</u> is
       taken from <b>o</b><b>p</b><b>t</b><b>i</b><b>o</b><b>n</b><b>s</b><b>:</b><b>g</b><b>a</b><b>t</b><b>e</b><b>w</b><b>a</b><b>y</b><b>_</b><b>m</b><b>t</b><b>u</b> column of <b>L</b><b>o</b><b>g</b><b>i</b><b>c</b><b>a</b><b>l</b><b>_</b><b>R</b><b>o</b><b>u</b><b>t</b><b>e</b><b>r</b><b>_</b><b>P</b><b>o</b><b>r</b><b>t</b> row.

       This table adds one priority-0 fallback flow that matches  all  packets
       and advances to the next table.

     <u>I</u><u>n</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>1</u><u>6</u><u>:</u> <u>H</u><u>a</u><u>n</u><u>d</u><u>l</u><u>e</u> <u>l</u><u>a</u><u>r</u><u>g</u><u>e</u><u>r</u> <u>p</u><u>a</u><u>c</u><u>k</u><u>e</u><u>t</u><u>s</u>

       For  distributed  logical routers with distributed gateway port config‐
       ured with <b>o</b><b>p</b><b>t</b><b>i</b><b>o</b><b>n</b><b>s</b><b>:</b><b>g</b><b>a</b><b>t</b><b>e</b><b>w</b><b>a</b><b>y</b><b>_</b><b>m</b><b>t</b><b>u</b> to a valid integer value, this table adds
       the  following  priority-50  logical  flow for each logical router port
       with  the  match  <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b>  <b>=</b><b>=</b>  <u>L</u><u>R</u><u>P</u>  &amp;&amp;&amp;&amp;  <b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b>  <b>=</b><b>=</b>  <u>G</u><u>W</u><b>_</b><u>P</u><u>O</u><u>R</u><u>T</u>   &amp;&amp;&amp;&amp;   <b>R</b><b>E</b><b>G</b><b>‐</b>
       <b>B</b><b>I</b><b>T</b><b>_</b><b>P</b><b>K</b><b>T</b><b>_</b><b>L</b><b>A</b><b>R</b><b>G</b><b>E</b><b>R</b>, where <u>L</u><u>R</u><u>P</u> is the logical router port and <u>G</u><u>W</u><b>_</b><u>P</u><u>O</u><u>R</u><u>T</u> is the
       distributed gateway router port and applies the  following  action  for
       ipv4 and ipv6 respectively:

       <b>i</b><b>c</b><b>m</b><b>p</b><b>4</b> <b>{</b>
           <b>i</b><b>c</b><b>m</b><b>p</b><b>4</b><b>.</b><b>t</b><b>y</b><b>p</b><b>e</b> <b>=</b> <b>3</b><b>;</b> <b>/</b><b>*</b> <b>D</b><b>e</b><b>s</b><b>t</b><b>i</b><b>n</b><b>a</b><b>t</b><b>i</b><b>o</b><b>n</b> <b>U</b><b>n</b><b>r</b><b>e</b><b>a</b><b>c</b><b>h</b><b>a</b><b>b</b><b>l</b><b>e</b><b>.</b> <b>*</b><b>/</b>
           <b>i</b><b>c</b><b>m</b><b>p</b><b>4</b><b>.</b><b>c</b><b>o</b><b>d</b><b>e</b> <b>=</b> <b>4</b><b>;</b>  <b>/</b><b>*</b> <b>F</b><b>r</b><b>a</b><b>g</b> <b>N</b><b>e</b><b>e</b><b>d</b><b>e</b><b>d</b> <b>a</b><b>n</b><b>d</b> <b>D</b><b>F</b> <b>w</b><b>a</b><b>s</b> <b>S</b><b>e</b><b>t</b><b>.</b> <b>*</b><b>/</b>
           <b>i</b><b>c</b><b>m</b><b>p</b><b>4</b><b>.</b><b>f</b><b>r</b><b>a</b><b>g</b><b>_</b><b>m</b><b>t</b><b>u</b> <b>=</b> <u>M</u>;
           <b>e</b><b>t</b><b>h</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b> <u>E</u>;
           <b>i</b><b>p</b><b>4</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b> <b>i</b><b>p</b><b>4</b><b>.</b><b>s</b><b>r</b><b>c</b><b>;</b>
           <b>i</b><b>p</b><b>4</b><b>.</b><b>s</b><b>r</b><b>c</b> <b>=</b> <u>I</u>;
           <b>i</b><b>p</b><b>.</b><b>t</b><b>t</b><b>l</b> <b>=</b> <b>2</b><b>5</b><b>5</b><b>;</b>
           <b>R</b><b>E</b><b>G</b><b>B</b><b>I</b><b>T</b><b>_</b><b>E</b><b>G</b><b>R</b><b>E</b><b>S</b><b>S</b><b>_</b><b>L</b><b>O</b><b>O</b><b>P</b><b>B</b><b>A</b><b>C</b><b>K</b> <b>=</b> <b>1</b><b>;</b>
           <b>n</b><b>e</b><b>x</b><b>t</b><b>(</b><b>p</b><b>i</b><b>p</b><b>e</b><b>l</b><b>i</b><b>n</b><b>e</b><b>=</b><b>i</b><b>n</b><b>g</b><b>r</b><b>e</b><b>s</b><b>s</b><b>,</b> <b>t</b><b>a</b><b>b</b><b>l</b><b>e</b><b>=</b><b>0</b><b>)</b><b>;</b>
       <b>}</b><b>;</b>
       <b>i</b><b>c</b><b>m</b><b>p</b><b>6</b> <b>{</b>
           <b>i</b><b>c</b><b>m</b><b>p</b><b>6</b><b>.</b><b>t</b><b>y</b><b>p</b><b>e</b> <b>=</b> <b>2</b><b>;</b>
           <b>i</b><b>c</b><b>m</b><b>p</b><b>6</b><b>.</b><b>c</b><b>o</b><b>d</b><b>e</b> <b>=</b> <b>0</b><b>;</b>
           <b>i</b><b>c</b><b>m</b><b>p</b><b>6</b><b>.</b><b>f</b><b>r</b><b>a</b><b>g</b><b>_</b><b>m</b><b>t</b><b>u</b> <b>=</b> <u>M</u>;
           <b>e</b><b>t</b><b>h</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b> <u>E</u>;
           <b>i</b><b>p</b><b>6</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b> <b>i</b><b>p</b><b>6</b><b>.</b><b>s</b><b>r</b><b>c</b><b>;</b>
           <b>i</b><b>p</b><b>6</b><b>.</b><b>s</b><b>r</b><b>c</b> <b>=</b> <u>I</u>;
           <b>i</b><b>p</b><b>.</b><b>t</b><b>t</b><b>l</b> <b>=</b> <b>2</b><b>5</b><b>5</b><b>;</b>
           <b>R</b><b>E</b><b>G</b><b>B</b><b>I</b><b>T</b><b>_</b><b>E</b><b>G</b><b>R</b><b>E</b><b>S</b><b>S</b><b>_</b><b>L</b><b>O</b><b>O</b><b>P</b><b>B</b><b>A</b><b>C</b><b>K</b> <b>=</b> <b>1</b><b>;</b>
           <b>n</b><b>e</b><b>x</b><b>t</b><b>(</b><b>p</b><b>i</b><b>p</b><b>e</b><b>l</b><b>i</b><b>n</b><b>e</b><b>=</b><b>i</b><b>n</b><b>g</b><b>r</b><b>e</b><b>s</b><b>s</b><b>,</b> <b>t</b><b>a</b><b>b</b><b>l</b><b>e</b><b>=</b><b>0</b><b>)</b><b>;</b>
       <b>}</b><b>;</b>


              ·      Where  <u>M</u>  is the (fragment MTU - 58) whose value is taken
                     from <b>o</b><b>p</b><b>t</b><b>i</b><b>o</b><b>n</b><b>s</b><b>:</b><b>g</b><b>a</b><b>t</b><b>e</b><b>w</b><b>a</b><b>y</b><b>_</b><b>m</b><b>t</b><b>u</b>  column  of  <b>L</b><b>o</b><b>g</b><b>i</b><b>c</b><b>a</b><b>l</b><b>_</b><b>R</b><b>o</b><b>u</b><b>t</b><b>e</b><b>r</b><b>_</b><b>P</b><b>o</b><b>r</b><b>t</b>
                     row.

              ·      <u>E</u> is the Ethernet address of the logical router port.

              ·      <u>I</u> is the IPv4/IPv6 address of the logical router port.

       This  table  adds one priority-0 fallback flow that matches all packets
       and advances to the next table.

     <u>I</u><u>n</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>1</u><u>7</u><u>:</u> <u>G</u><u>a</u><u>t</u><u>e</u><u>w</u><u>a</u><u>y</u> <u>R</u><u>e</u><u>d</u><u>i</u><u>r</u><u>e</u><u>c</u><u>t</u>

       For distributed logical routers where one of the logical  router  ports
       specifies  a  gateway  chassis, this table redirects certain packets to
       the distributed gateway port instance on the gateway chassis. This  ta‐
       ble has the following flows:

              ·      For each NAT rule in the OVN Northbound database that can
                     be handled in a distributed manner, a priority-100  logi‐
                     cal  flow  with  match  <b>i</b><b>p</b><b>4</b><b>.</b><b>s</b><b>r</b><b>c</b>  <b>=</b><b>=</b> <u>B</u> &amp;&amp;&amp;&amp; <b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b> <b>=</b><b>=</b> <u>G</u><u>W</u> &amp;&amp;
                     is_chassis_resident(<u>P</u>), where <u>G</u><u>W</u> is  the  logical  router
                     distributed  gateway  port and <u>P</u> is the NAT logical port.
                     IP traffic  matching  the  above  rule  will  be  managed
                     locally  setting  <b>r</b><b>e</b><b>g</b><b>1</b>  to <u>C</u> and <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b> to <u>D</u>, where <u>C</u> is
                     NAT external ip and <u>D</u> is NAT external mac.

              ·      A priority-50 logical flow with match <b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b> <b>=</b><b>=</b>  <u>G</u><u>W</u>  has
                     actions  <b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b>  <b>=</b>  <u>C</u><u>R</u><b>;</b>  <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>,  where <u>G</u><u>W</u> is the logical
                     router distributed gateway  port  and  <u>C</u><u>R</u>  is  the  <b>c</b><b>h</b><b>a</b><b>s</b><b>‐</b>
                     <b>s</b><b>i</b><b>s</b><b>r</b><b>e</b><b>d</b><b>i</b><b>r</b><b>e</b><b>c</b><b>t</b> port representing the instance of the logical
                     router distributed gateway port on the gateway chassis.

              ·      A priority-0 logical flow with match <b>1</b> has actions <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>.

     <u>I</u><u>n</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>1</u><u>8</u><u>:</u> <u>A</u><u>R</u><u>P</u> <u>R</u><u>e</u><u>q</u><u>u</u><u>e</u><u>s</u><u>t</u>

       In the common case where the Ethernet destination  has  been  resolved,
       this  table outputs the packet. Otherwise, it composes and sends an ARP
       or IPv6 Neighbor Solicitation request. It holds the following flows:

              ·      Unknown MAC address. A priority-100 flow for IPv4 packets
                     with match <b>e</b><b>t</b><b>h</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b><b>=</b> <b>0</b><b>0</b><b>:</b><b>0</b><b>0</b><b>:</b><b>0</b><b>0</b><b>:</b><b>0</b><b>0</b><b>:</b><b>0</b><b>0</b><b>:</b><b>0</b><b>0</b> has the following
                     actions:

                     <b>a</b><b>r</b><b>p</b> <b>{</b>
                         <b>e</b><b>t</b><b>h</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b> <b>f</b><b>f</b><b>:</b><b>f</b><b>f</b><b>:</b><b>f</b><b>f</b><b>:</b><b>f</b><b>f</b><b>:</b><b>f</b><b>f</b><b>:</b><b>f</b><b>f</b><b>;</b>
                         <b>a</b><b>r</b><b>p</b><b>.</b><b>s</b><b>p</b><b>a</b> <b>=</b> <b>r</b><b>e</b><b>g</b><b>1</b><b>;</b>
                         <b>a</b><b>r</b><b>p</b><b>.</b><b>t</b><b>p</b><b>a</b> <b>=</b> <b>r</b><b>e</b><b>g</b><b>0</b><b>;</b>
                         <b>a</b><b>r</b><b>p</b><b>.</b><b>o</b><b>p</b> <b>=</b> <b>1</b><b>;</b>  <b>/</b><b>*</b> <b>A</b><b>R</b><b>P</b> <b>r</b><b>e</b><b>q</b><b>u</b><b>e</b><b>s</b><b>t</b><b>.</b> <b>*</b><b>/</b>
                         <b>o</b><b>u</b><b>t</b><b>p</b><b>u</b><b>t</b><b>;</b>
                     <b>}</b><b>;</b>


                     Unknown MAC address. For each IPv6 static  route  associ‐
                     ated  with  the  router  with the nexthop IP: <u>G</u>, a prior‐
                     ity-200 flow for  IPv6  packets  with  match  <b>e</b><b>t</b><b>h</b><b>.</b><b>d</b><b>s</b><b>t</b>  <b>=</b><b>=</b>
                     <b>0</b><b>0</b><b>:</b><b>0</b><b>0</b><b>:</b><b>0</b><b>0</b><b>:</b><b>0</b><b>0</b><b>:</b><b>0</b><b>0</b><b>:</b><b>0</b><b>0</b>  &amp;&amp;&amp;&amp;  <b>x</b><b>x</b><b>r</b><b>e</b><b>g</b><b>0</b>  <b>=</b><b>=</b>  <u>G</u>  with  the following
                     actions is added:

                     <b>n</b><b>d</b><b>_</b><b>n</b><b>s</b> <b>{</b>
                         <b>e</b><b>t</b><b>h</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b> <u>E</u>;
                         <b>i</b><b>p</b><b>6</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b> <u>I</u>
                         <b>n</b><b>d</b><b>.</b><b>t</b><b>a</b><b>r</b><b>g</b><b>e</b><b>t</b> <b>=</b> <u>G</u>;
                         <b>o</b><b>u</b><b>t</b><b>p</b><b>u</b><b>t</b><b>;</b>
                     <b>}</b><b>;</b>


                     Where <u>E</u> is the multicast mac derived from the Gateway IP,
                     <u>I</u>  is  the solicited-node multicast address corresponding
                     to the target address <u>G</u>.

                     Unknown MAC address. A priority-100 flow for IPv6 packets
                     with match <b>e</b><b>t</b><b>h</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b><b>=</b> <b>0</b><b>0</b><b>:</b><b>0</b><b>0</b><b>:</b><b>0</b><b>0</b><b>:</b><b>0</b><b>0</b><b>:</b><b>0</b><b>0</b><b>:</b><b>0</b><b>0</b> has the following
                     actions:

                     <b>n</b><b>d</b><b>_</b><b>n</b><b>s</b> <b>{</b>
                         <b>n</b><b>d</b><b>.</b><b>t</b><b>a</b><b>r</b><b>g</b><b>e</b><b>t</b> <b>=</b> <b>x</b><b>x</b><b>r</b><b>e</b><b>g</b><b>0</b><b>;</b>
                         <b>o</b><b>u</b><b>t</b><b>p</b><b>u</b><b>t</b><b>;</b>
                     <b>}</b><b>;</b>


                     (Ingress table <b>I</b><b>P</b> <b>R</b><b>o</b><b>u</b><b>t</b><b>i</b><b>n</b><b>g</b> initialized <b>r</b><b>e</b><b>g</b><b>1</b>  with  the  IP
                     address  owned  by <b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b> and <b>(</b><b>x</b><b>x</b><b>)</b><b>r</b><b>e</b><b>g</b><b>0</b> with the next-hop
                     IP address)

                     The IP packet that triggers the ARP/IPv6  NS  request  is
                     dropped.

              ·      Known  MAC  address.  A  priority-0 flow with match <b>1</b> has
                     actions <b>o</b><b>u</b><b>t</b><b>p</b><b>u</b><b>t</b><b>;</b>.

     <u>E</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>0</u><u>:</u> <u>U</u><u>N</u><u>D</u><u>N</u><u>A</u><u>T</u>

       This is for already established  connections’  reverse  traffic.  i.e.,
       DNAT  has  already been done in ingress pipeline and now the packet has
       entered the egress pipeline as part of a reply. For NAT on  a  distrib‐
       uted router, it is unDNATted here. For Gateway routers, the unDNAT pro‐
       cessing is carried out in the ingress DNAT table.

              ·      For all the configured load balancing rules for a  router
                     with   gateway   port  in  <b>O</b><b>V</b><b>N</b><b>_</b><b>N</b><b>o</b><b>r</b><b>t</b><b>h</b><b>b</b><b>o</b><b>u</b><b>n</b><b>d</b>  database  that
                     includes an IPv4 address  <b>V</b><b>I</b><b>P</b>,  for  every  backend  IPv4
                     address <u>B</u> defined for the <b>V</b><b>I</b><b>P</b> a priority-120 flow is pro‐
                     grammed on gateway chassis that matches <b>i</b><b>p</b> &amp;&amp;&amp;&amp; <b>i</b><b>p</b><b>4</b><b>.</b><b>s</b><b>r</b><b>c</b>  <b>=</b><b>=</b>
                     <u>B</u>  &amp;&amp;&amp;&amp; <b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b> <b>=</b><b>=</b> <u>G</u><u>W</u>, where <u>G</u><u>W</u> is the logical router gate‐
                     way port with an action <b>c</b><b>t</b><b>_</b><b>d</b><b>n</b><b>a</b><b>t</b><b>;</b>.  If  the  backend  IPv4
                     address  <u>B</u> is also configured with L4 port <u>P</u><u>O</u><u>R</u><u>T</u> of proto‐
                     col <u>P</u>, then the match also includes <b>P</b><b>.</b><b>s</b><b>r</b><b>c</b> == <u>P</u><u>O</u><u>R</u><u>T</u>.  These
                     flows are not added for load balancers with IPv6 <u>V</u><u>I</u><u>P</u><u>s</u>.

                     If  the  router is configured to force SNAT any load-bal‐
                     anced  packets,  above  action  will   be   replaced   by
                     <b>f</b><b>l</b><b>a</b><b>g</b><b>s</b><b>.</b><b>f</b><b>o</b><b>r</b><b>c</b><b>e</b><b>_</b><b>s</b><b>n</b><b>a</b><b>t</b><b>_</b><b>f</b><b>o</b><b>r</b><b>_</b><b>l</b><b>b</b> <b>=</b> <b>1</b><b>;</b> <b>c</b><b>t</b><b>_</b><b>d</b><b>n</b><b>a</b><b>t</b><b>;</b>.

              ·      For  each  configuration  in  the OVN Northbound database
                     that asks to change  the  destination  IP  address  of  a
                     packet  from an IP address of <u>A</u> to <u>B</u>, a priority-100 flow
                     matches <b>i</b><b>p</b> &amp;&amp;&amp;&amp; <b>i</b><b>p</b><b>4</b><b>.</b><b>s</b><b>r</b><b>c</b> <b>=</b><b>=</b> <u>B</u> &amp;&amp;&amp;&amp; <b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b> <b>=</b><b>=</b> <u>G</u><u>W</u>, where <u>G</u><u>W</u>  is
                     the logical router gateway port, with an action <b>c</b><b>t</b><b>_</b><b>d</b><b>n</b><b>a</b><b>t</b><b>;</b>.
                     If the NAT rule is of type dnat_and_snat and  has  <b>s</b><b>t</b><b>a</b><b>t</b><b>e</b><b>‐</b>
                     <b>l</b><b>e</b><b>s</b><b>s</b><b>=</b><b>t</b><b>r</b><b>u</b><b>e</b>  in  the  options,  then  the  action  would be
                     <b>i</b><b>p</b><b>4</b><b>/</b><b>6</b><b>.</b><b>s</b><b>r</b><b>c</b><b>=</b> <b>(</b><u>B</u><b>)</b>.

                     If the NAT rule cannot be handled in a  distributed  man‐
                     ner,  then the priority-100 flow above is only programmed
                     on the gateway chassis.

                     If the NAT rule can be handled in a  distributed  manner,
                     then  there  is an additional action <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b> <b>=</b> <u>E</u><u>A</u><b>;</b>, where
                     <u>E</u><u>A</u> is the ethernet address associated with the IP address
                     <u>A</u>  in  the NAT rule. This allows upstream MAC learning to
                     point to the correct chassis.

              ·      A priority-0 logical flow with match <b>1</b> has actions <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>.

     <u>E</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>1</u><u>:</u> <u>S</u><u>N</u><u>A</u><u>T</u>

       Packets that are configured to be SNATed get their  source  IP  address
       changed based on the configuration in the OVN Northbound database.

              ·      A  priority-120 flow to advance the IPv6 Neighbor solici‐
                     tation packet to next table to skip  SNAT.  In  the  case
                     where  ovn-controller  injects an IPv6 Neighbor Solicita‐
                     tion packet (for <b>n</b><b>d</b><b>_</b><b>n</b><b>s</b> action) we don’t want  the  packet
                     to go throught conntrack.

       Egress Table 1: SNAT on Gateway Routers

              ·      If  the Gateway router in the OVN Northbound database has
                     been configured to force SNAT a  packet  (that  has  been
                     previously  DNATted)  to  <u>B</u>,  a priority-100 flow matches
                     <b>f</b><b>l</b><b>a</b><b>g</b><b>s</b><b>.</b><b>f</b><b>o</b><b>r</b><b>c</b><b>e</b><b>_</b><b>s</b><b>n</b><b>a</b><b>t</b><b>_</b><b>f</b><b>o</b><b>r</b><b>_</b><b>d</b><b>n</b><b>a</b><b>t</b> <b>=</b><b>=</b>  <b>1</b>  &amp;&amp;&amp;&amp;  <b>i</b><b>p</b>  with  an  action
                     <b>c</b><b>t</b><b>_</b><b>s</b><b>n</b><b>a</b><b>t</b><b>(</b><u>B</u><b>)</b><b>;</b>.

              ·      If  a  load  balancer  configured  to  skip snat has been
                     applied to the Gateway router  pipeline,  a  priority-120
                     flow  matches  <b>f</b><b>l</b><b>a</b><b>g</b><b>s</b><b>.</b><b>s</b><b>k</b><b>i</b><b>p</b><b>_</b><b>s</b><b>n</b><b>a</b><b>t</b><b>_</b><b>f</b><b>o</b><b>r</b><b>_</b><b>l</b><b>b</b>  <b>=</b><b>=</b> <b>1</b> &amp;&amp;&amp;&amp; <b>i</b><b>p</b> with an
                     action <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>.

              ·      If the Gateway router in the OVN Northbound database  has
                     been  configured  to  force  SNAT a packet (that has been
                     previously   load-balanced)   using   router   IP    (i.e
                     <b>o</b><b>p</b><b>t</b><b>i</b><b>o</b><b>n</b><b>s</b>:lb_force_snat_ip=router_ip),  then for each logi‐
                     cal router port <u>P</u> attached to the Gateway router, a  pri‐
                     ority-110  flow  matches  <b>f</b><b>l</b><b>a</b><b>g</b><b>s</b><b>.</b><b>f</b><b>o</b><b>r</b><b>c</b><b>e</b><b>_</b><b>s</b><b>n</b><b>a</b><b>t</b><b>_</b><b>f</b><b>o</b><b>r</b><b>_</b><b>l</b><b>b</b> <b>=</b><b>=</b> <b>1</b> &amp;&amp;&amp;&amp;
                     <b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b> <b>=</b><b>=</b> <u>P</u>
                      with an action <b>c</b><b>t</b><b>_</b><b>s</b><b>n</b><b>a</b><b>t</b><b>(</b><u>R</u><b>)</b><b>;</b> where <u>R</u> is the IP  configured
                     on  the  router  port.  If  <b>R</b> is an IPv4 address then the
                     match will also include <b>i</b><b>p</b><b>4</b> and if it is an IPv6 address,
                     then the match will also include <b>i</b><b>p</b><b>6</b>.

                     If  the logical router port <u>P</u> is configured with multiple
                     IPv4 and multiple IPv6 addresses, only the first IPv4 and
                     first IPv6 address is considered.

              ·      If  the Gateway router in the OVN Northbound database has
                     been configured to force SNAT a  packet  (that  has  been
                     previously  load-balanced)  to  <u>B</u>,  a  priority-100  flow
                     matches <b>f</b><b>l</b><b>a</b><b>g</b><b>s</b><b>.</b><b>f</b><b>o</b><b>r</b><b>c</b><b>e</b><b>_</b><b>s</b><b>n</b><b>a</b><b>t</b><b>_</b><b>f</b><b>o</b><b>r</b><b>_</b><b>l</b><b>b</b> <b>=</b><b>=</b> <b>1</b> &amp;&amp;&amp;&amp; <b>i</b><b>p</b> with an action
                     <b>c</b><b>t</b><b>_</b><b>s</b><b>n</b><b>a</b><b>t</b><b>(</b><u>B</u><b>)</b><b>;</b>.

              ·      For  each  configuration  in the OVN Northbound database,
                     that asks to change the source IP  address  of  a  packet
                     from  an  IP  address  of  <u>A</u>  or  to change the source IP
                     address of a packet that belongs to network  <u>A</u>  to  <u>B</u>,  a
                     flow   matches   <b>i</b><b>p</b>  &amp;&amp;&amp;&amp;  <b>i</b><b>p</b><b>4</b><b>.</b><b>s</b><b>r</b><b>c</b>  <b>=</b><b>=</b>  <u>A</u>  with  an  action
                     <b>c</b><b>t</b><b>_</b><b>s</b><b>n</b><b>a</b><b>t</b><b>(</b><u>B</u><b>)</b><b>;</b>. The priority of the flow is calculated based
                     on  the  mask of <u>A</u>, with matches having larger masks get‐
                     ting higher priorities.  If  the  NAT  rule  is  of  type
                     dnat_and_snat and has <b>s</b><b>t</b><b>a</b><b>t</b><b>e</b><b>l</b><b>e</b><b>s</b><b>s</b><b>=</b><b>t</b><b>r</b><b>u</b><b>e</b> in the options, then
                     the action would be <b>i</b><b>p</b><b>4</b><b>/</b><b>6</b><b>.</b><b>s</b><b>r</b><b>c</b><b>=</b> <b>(</b><u>B</u><b>)</b>.

              ·      If the NAT  rule  has  <b>a</b><b>l</b><b>l</b><b>o</b><b>w</b><b>e</b><b>d</b><b>_</b><b>e</b><b>x</b><b>t</b><b>_</b><b>i</b><b>p</b><b>s</b>  configured,  then
                     there is an additional match <b>i</b><b>p</b><b>4</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b><b>=</b> <u>a</u><u>l</u><u>l</u><u>o</u><u>w</u><u>e</u><u>d</u><b>_</b><u>e</u><u>x</u><u>t</u><b>_</b><u>i</u><u>p</u><u>s</u> .
                     Similarly,  for  IPV6,  match   would   be   <b>i</b><b>p</b><b>6</b><b>.</b><b>d</b><b>s</b><b>t</b>   <b>=</b><b>=</b>
                     <u>a</u><u>l</u><u>l</u><u>o</u><u>w</u><u>e</u><u>d</u><b>_</b><u>e</u><u>x</u><u>t</u><b>_</b><u>i</u><u>p</u><u>s</u>.

              ·      If  the  NAT rule has <b>e</b><b>x</b><b>e</b><b>m</b><b>p</b><b>t</b><b>e</b><b>d</b><b>_</b><b>e</b><b>x</b><b>t</b><b>_</b><b>i</b><b>p</b><b>s</b> set, then there is
                     an additional flow configured at the priority + 1 of cor‐
                     responding  NAT  rule. The flow matches if destination ip
                     is an <b>e</b><b>x</b><b>e</b><b>m</b><b>p</b><b>t</b><b>e</b><b>d</b><b>_</b><b>e</b><b>x</b><b>t</b><b>_</b><b>i</b><b>p</b> and the action is <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b> . This flow
                     is  used  to bypass the ct_snat action for a packet which
                     is destinted to <b>e</b><b>x</b><b>e</b><b>m</b><b>p</b><b>t</b><b>e</b><b>d</b><b>_</b><b>e</b><b>x</b><b>t</b><b>_</b><b>i</b><b>p</b><b>s</b>.

              ·      A priority-0 logical flow with match <b>1</b> has actions <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>.

       Egress Table 1: SNAT on Distributed Routers

              ·      For each configuration in the  OVN  Northbound  database,
                     that  asks  to  change  the source IP address of a packet
                     from an IP address of  <u>A</u>  or  to  change  the  source  IP
                     address  of  a  packet  that belongs to network <u>A</u> to <u>B</u>, a
                     flow matches <b>i</b><b>p</b> &amp;&amp;&amp;&amp; <b>i</b><b>p</b><b>4</b><b>.</b><b>s</b><b>r</b><b>c</b> <b>=</b><b>=</b> <u>A</u> &amp;&amp;&amp;&amp; <b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b> <b>=</b><b>=</b>  <u>G</u><u>W</u>,  where
                     <u>G</u><u>W</u>  is  the  logical  router gateway port, with an action
                     <b>c</b><b>t</b><b>_</b><b>s</b><b>n</b><b>a</b><b>t</b><b>(</b><u>B</u><b>)</b><b>;</b>. The priority of the flow is calculated based
                     on  the  mask of <u>A</u>, with matches having larger masks get‐
                     ting higher priorities.  If  the  NAT  rule  is  of  type
                     dnat_and_snat and has <b>s</b><b>t</b><b>a</b><b>t</b><b>e</b><b>l</b><b>e</b><b>s</b><b>s</b><b>=</b><b>t</b><b>r</b><b>u</b><b>e</b> in the options, then
                     the action would be <b>i</b><b>p</b><b>4</b><b>/</b><b>6</b><b>.</b><b>s</b><b>r</b><b>c</b><b>=</b> <b>(</b><u>B</u><b>)</b>.

                     If the NAT rule cannot be handled in a  distributed  man‐
                     ner,  then the flow above is only programmed on the gate‐
                     way chassis increasing flow priority by 128 in  order  to
                     be run first

                     If  the  NAT rule can be handled in a distributed manner,
                     then there is an additional action <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b> <b>=</b>  <u>E</u><u>A</u><b>;</b>,  where
                     <u>E</u><u>A</u> is the ethernet address associated with the IP address
                     <u>A</u> in the NAT rule. This allows upstream MAC  learning  to
                     point to the correct chassis.

                     If  the  NAT  rule  has  <b>a</b><b>l</b><b>l</b><b>o</b><b>w</b><b>e</b><b>d</b><b>_</b><b>e</b><b>x</b><b>t</b><b>_</b><b>i</b><b>p</b><b>s</b> configured, then
                     there is an additional match <b>i</b><b>p</b><b>4</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b><b>=</b> <u>a</u><u>l</u><u>l</u><u>o</u><u>w</u><u>e</u><u>d</u><b>_</b><u>e</u><u>x</u><u>t</u><b>_</b><u>i</u><u>p</u><u>s</u> .
                     Similarly,   for   IPV6,   match   would  be  <b>i</b><b>p</b><b>6</b><b>.</b><b>d</b><b>s</b><b>t</b>  <b>=</b><b>=</b>
                     <u>a</u><u>l</u><u>l</u><u>o</u><u>w</u><u>e</u><u>d</u><b>_</b><u>e</u><u>x</u><u>t</u><b>_</b><u>i</u><u>p</u><u>s</u>.

                     If the NAT rule has <b>e</b><b>x</b><b>e</b><b>m</b><b>p</b><b>t</b><b>e</b><b>d</b><b>_</b><b>e</b><b>x</b><b>t</b><b>_</b><b>i</b><b>p</b><b>s</b> set, then  there  is
                     an additional flow configured at the priority + 1 of cor‐
                     responding NAT rule. The flow matches if  destination  ip
                     is an <b>e</b><b>x</b><b>e</b><b>m</b><b>p</b><b>t</b><b>e</b><b>d</b><b>_</b><b>e</b><b>x</b><b>t</b><b>_</b><b>i</b><b>p</b> and the action is <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b> . This flow
                     is used to bypass the ct_snat action for a flow which  is
                     destinted to <b>e</b><b>x</b><b>e</b><b>m</b><b>p</b><b>t</b><b>e</b><b>d</b><b>_</b><b>e</b><b>x</b><b>t</b><b>_</b><b>i</b><b>p</b><b>s</b>.

              ·      A priority-0 logical flow with match <b>1</b> has actions <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>.

     <u>E</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>2</u><u>:</u> <u>E</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>L</u><u>o</u><u>o</u><u>p</u><u>b</u><u>a</u><u>c</u><u>k</u>

       For  distributed  logical routers where one of the logical router ports
       specifies a gateway chassis.

       While UNDNAT and SNAT processing have already occurred by  this  point,
       this  traffic  needs  to be forced through egress loopback on this dis‐
       tributed gateway port instance, in order for UNSNAT and DNAT processing
       to  be applied, and also for IP routing and ARP resolution after all of
       the NAT processing, so that the packet can be forwarded to the destina‐
       tion.

       This table has the following flows:

              ·      For  each  NAT  rule  in the OVN Northbound database on a
                     distributed router,  a  priority-100  logical  flow  with
                     match  <b>i</b><b>p</b><b>4</b><b>.</b><b>d</b><b>s</b><b>t</b>  <b>=</b><b>=</b> <u>E</u> &amp;&amp;&amp;&amp; <b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b> <b>=</b><b>=</b> <u>G</u><u>W</u> &amp;&amp;&amp;&amp; <b>i</b><b>s</b><b>_</b><b>c</b><b>h</b><b>a</b><b>s</b><b>s</b><b>i</b><b>s</b><b>_</b><b>r</b><b>e</b><b>s</b><b>i</b><b>‐</b>
                     <b>d</b><b>e</b><b>n</b><b>t</b><b>(</b><u>P</u><b>)</b>, where <u>E</u> is the external IP address specified  in
                     the  NAT rule, <u>G</u><u>W</u> is the logical router distributed gate‐
                     way port. For dnat_and_snat NAT rule, <u>P</u>  is  the  logical
                     port specified in the NAT rule. If <b>l</b><b>o</b><b>g</b><b>i</b><b>c</b><b>a</b><b>l</b><b>_</b><b>p</b><b>o</b><b>r</b><b>t</b> column of
                     <b>N</b><b>A</b><b>T</b> table is NOT set, then <u>P</u> is the <b>c</b><b>h</b><b>a</b><b>s</b><b>s</b><b>i</b><b>s</b><b>r</b><b>e</b><b>d</b><b>i</b><b>r</b><b>e</b><b>c</b><b>t</b>  <b>p</b><b>o</b><b>r</b><b>t</b>
                     of <u>G</u><u>W</u> with the following actions:

                     <b>c</b><b>l</b><b>o</b><b>n</b><b>e</b> <b>{</b>
                         <b>c</b><b>t</b><b>_</b><b>c</b><b>l</b><b>e</b><b>a</b><b>r</b><b>;</b>
                         <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b> <b>=</b> <b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b><b>;</b>
                         <b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b> <b>=</b> <b>"</b><b>"</b><b>;</b>
                         <b>f</b><b>l</b><b>a</b><b>g</b><b>s</b> <b>=</b> <b>0</b><b>;</b>
                         <b>f</b><b>l</b><b>a</b><b>g</b><b>s</b><b>.</b><b>l</b><b>o</b><b>o</b><b>p</b><b>b</b><b>a</b><b>c</b><b>k</b> <b>=</b> <b>1</b><b>;</b>
                         <b>r</b><b>e</b><b>g</b><b>0</b> <b>=</b> <b>0</b><b>;</b>
                         <b>r</b><b>e</b><b>g</b><b>1</b> <b>=</b> <b>0</b><b>;</b>
                         <b>.</b><b>.</b><b>.</b>
                         <b>r</b><b>e</b><b>g</b><b>9</b> <b>=</b> <b>0</b><b>;</b>
                         <b>R</b><b>E</b><b>G</b><b>B</b><b>I</b><b>T</b><b>_</b><b>E</b><b>G</b><b>R</b><b>E</b><b>S</b><b>S</b><b>_</b><b>L</b><b>O</b><b>O</b><b>P</b><b>B</b><b>A</b><b>C</b><b>K</b> <b>=</b> <b>1</b><b>;</b>
                         <b>n</b><b>e</b><b>x</b><b>t</b><b>(</b><b>p</b><b>i</b><b>p</b><b>e</b><b>l</b><b>i</b><b>n</b><b>e</b><b>=</b><b>i</b><b>n</b><b>g</b><b>r</b><b>e</b><b>s</b><b>s</b><b>,</b> <b>t</b><b>a</b><b>b</b><b>l</b><b>e</b><b>=</b><b>0</b><b>)</b><b>;</b>
                     <b>}</b><b>;</b>


                     <b>f</b><b>l</b><b>a</b><b>g</b><b>s</b><b>.</b><b>l</b><b>o</b><b>o</b><b>p</b><b>b</b><b>a</b><b>c</b><b>k</b>  is set since in_port is unchanged and the
                     packet may return back to that port after NAT processing.
                     <b>R</b><b>E</b><b>G</b><b>B</b><b>I</b><b>T</b><b>_</b><b>E</b><b>G</b><b>R</b><b>E</b><b>S</b><b>S</b><b>_</b><b>L</b><b>O</b><b>O</b><b>P</b><b>B</b><b>A</b><b>C</b><b>K</b>  is  set  to  indicate that egress
                     loopback has occurred, in order to  skip  the  source  IP
                     address check against the router address.

              ·      A priority-0 logical flow with match <b>1</b> has actions <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>.

     <u>E</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>3</u><u>:</u> <u>D</u><u>e</u><u>l</u><u>i</u><u>v</u><u>e</u><u>r</u><u>y</u>

       Packets that reach this table are ready for delivery. It contains:

              ·      Priority-110  logical flows that match IP multicast pack‐
                     ets on each enabled logical router port  and  modify  the
                     Ethernet  source  address  of the packets to the Ethernet
                     address of the port and then execute action <b>o</b><b>u</b><b>t</b><b>p</b><b>u</b><b>t</b><b>;</b>.

              ·      Priority-100 logical flows that  match  packets  on  each
                     enabled logical router port, with action <b>o</b><b>u</b><b>t</b><b>p</b><b>u</b><b>t</b><b>;</b>.



OVN 21.06.0                       ovn-northd                     ovn-northd(8)
</pre></body></html>
